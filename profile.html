<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Vivify</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
        }

        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 6rem 2rem 2rem 2rem;
            
        }

        /* Fix for dropdown z-index issue */
        .dropdown {
            position: relative;
            z-index: 1000;
        }

        .dropdown-content {
            z-index: 1001;
        }

        /* Ensure header has proper z-index */
        header {
            position: relative;
            z-index: 999;
        }

        .profile-header {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            border: 1px solid #333;
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            z-index: 1;
        }

        .profile-content {
            position: relative;
            z-index: 2;
            padding-top: 3rem;
        }

        .profile-picture-container {
            position: relative;
            display: inline-block;
            margin-bottom: 1.5rem;
        }

        .profile-picture {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid #fff;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #888;
            overflow: hidden;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .profile-picture img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-picture-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            background: #f39c12;
            color: #000;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }

        .profile-picture-upload:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }

        .profile-picture-input {
            display: none;
        }

        .profile-name {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 0.5rem 0;
            color: #ffffff;
        }

        .profile-details {
            color: #a0a0a0;
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #f39c12;
            display: block;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #a0a0a0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .profile-card {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 2rem;
            transition: transform 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .profile-card:hover {
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title i {
            color: #f39c12;
        }

        .edit-btn {
            background: transparent;
            border: 1px solid #f39c12;
            color: #f39c12;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #f39c12;
            color: #000;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #333;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        .info-value {
            color: #ffffff;
            font-weight: 500;
        }

        .editable-field {
            display: none;
        }

        .editable-field.active {
            display: block;
        }

        .editable-field input,
        .editable-field select {
            width: 100%;
            background: #333;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 0.75rem;
            color: #ffffff;
            font-size: 0.9rem;
            box-sizing: border-box;
            margin-bottom: 1rem;
        }

        .editable-field input:focus,
        .editable-field select:focus {
            outline: none;
            border-color: #f39c12;
        }

        .field-actions {
            display: flex;
            gap: 0.5rem;
        }

        .save-btn {
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .cancel-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .preferences-section {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .preference-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #333;
        }

        .preference-item:last-child {
            border-bottom: none;
        }

        .preference-info {
            flex: 1;
        }

        .preference-title {
            color: #ffffff;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .preference-description {
            color: #a0a0a0;
            font-size: 0.85rem;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #333;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: #f39c12;
        }

        .toggle-switch::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::before {
            transform: translateX(24px);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .achievement-badge {
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .achievement-badge.earned {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: #000;
            border-color: #f39c12;
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .achievement-name {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .danger-zone {
            background: linear-gradient(145deg, #2a1a1a 0%, #3a2222 100%);
            border: 1px solid #5a3333;
            border-radius: 16px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .danger-zone h3 {
            color: #e74c3c;
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .danger-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .danger-btn:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            margin: 10% auto;
            padding: 2rem;
            border: 1px solid #333;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .modal-title {
            color: #e74c3c;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-text {
            color: #a0a0a0;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .confirm-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
        }

        .cancel-modal-btn {
            background: #333;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .profile-container {
                padding: 5rem 1rem 2rem 1rem;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .profile-stats {
                gap: 1rem;
            }

            .achievements-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .profile-picture {
                width: 100px;
                height: 100px;
            }

            .profile-name {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .profile-header {
                padding: 2rem 1rem;
            }

            .profile-card {
                padding: 1.5rem;
            }

            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>

<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">

<!-- iOS PWA Support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Wellness Hub">
<link rel="apple-touch-icon" href="/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">

<!-- Microsoft Tiles -->
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<meta name="msapplication-TileColor" content="#f39c12">

<!-- Theme Color -->
<meta name="theme-color" content="#f39c12">

<!-- Viewport for PWA -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<!-- Preload PWA installer script -->
<link rel="preload" href="/pwa-install.js" as="script">
</head>
<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="left-nav">
                    <div class="logo">
                        <a href="index.html"><h1>Vivify</h1></a>
                    </div>
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li class="dropdown" id="categoryDropdown">
                            <a href="#" class="dropbtn">Categories</a>
                            <div class="dropdown-content">
                                <a href="fitness.html">Fitness</a>
                                <a href="nutrition.html">Nutrition</a>
                                <a href="mental-health.html">Mental Health</a>
                                <a href="life-lessons.html">Life Lessons</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="right-nav">
                    <ul>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="profile.html" class="active">Profile</a></li>
                        <li><a href="#" id="logoutLink">Logout</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <main class="profile-container">
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-content">
                    <div class="profile-picture-container">
                        <div class="profile-picture" id="profilePicture">
                            <i class="fas fa-user"></i>
                        </div>
                        <button class="profile-picture-upload" onclick="document.getElementById('profilePictureInput').click()">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" id="profilePictureInput" class="profile-picture-input" accept="image/*">
                    </div>
                    <h1 class="profile-name" id="profileName">Student Name</h1>
                    <div class="profile-details" id="profileDetails">
                        Year Level â€¢ School Name â€¢ Member since Date
                    </div>
                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="streakCount">0</span>
                            <span class="stat-label">Day Streak</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="wellnessScore">0</span>
                            <span class="stat-label">Wellness Score</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="activitiesCount">0</span>
                            <span class="stat-label">Activities</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Information Grid -->
            <div class="profile-grid">
                <!-- Personal Information -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-user"></i>
                            Personal Information
                        </h3>
                        <button class="edit-btn" onclick="toggleEdit('personal')">Edit</button>
                    </div>
                    <div id="personalInfo">
                        <div class="info-item">
                            <span class="info-label">Full Name</span>
                            <span class="info-value" id="displayName">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email</span>
                            <span class="info-value" id="displayEmail">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Year Level</span>
                            <span class="info-value" id="displayYearLevel">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">School</span>
                            <span class="info-value" id="displaySchool">-</span>
                        </div>
                    </div>
                    <div class="editable-field" id="personalEdit">
                        <input type="text" id="editName" placeholder="Full Name">
                        <input type="email" id="editEmail" placeholder="Email Address">
                        <select id="editYearLevel">
                            <option value="">Select Year Level</option>
                            <option value="7">Year 7</option>
                            <option value="8">Year 8</option>
                            <option value="9">Year 9</option>
                            <option value="10">Year 10</option>
                            <option value="11">Year 11</option>
                            <option value="12">Year 12</option>
                        </select>
                        <input type="text" id="editSchool" placeholder="School Name">
                        <div class="field-actions">
                            <button class="save-btn" onclick="savePersonalInfo()">Save</button>
                            <button class="cancel-btn" onclick="cancelEdit('personal')">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Account Settings -->
                <div class="profile-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-cog"></i>
                            Account Settings
                        </h3>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Member Since</span>
                        <span class="info-value" id="memberSince">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Account Status</span>
                        <span class="info-value" style="color: #27ae60;">âœ“ Verified</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Privacy Level</span>
                        <span class="info-value">Student</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Data Usage</span>
                        <span class="info-value">Standard</span>
                    </div>
                </div>
            </div>

            <!-- Preferences -->
            <div class="preferences-section">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-sliders-h"></i>
                        Preferences
                    </h3>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <div class="preference-title">Email Notifications</div>
                        <div class="preference-description">Receive updates about your wellness progress</div>
                    </div>
                    <div class="toggle-switch" id="emailNotifications" onclick="togglePreference('emailNotifications')"></div>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <div class="preference-title">Daily Reminders</div>
                        <div class="preference-description">Get reminded to log your daily activities</div>
                    </div>
                    <div class="toggle-switch active" id="dailyReminders" onclick="togglePreference('dailyReminders')"></div>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <div class="preference-title">Progress Sharing</div>
                        <div class="preference-description">Allow others to see your wellness achievements</div>
                    </div>
                    <div class="toggle-switch" id="progressSharing" onclick="togglePreference('progressSharing')"></div>
                </div>
                <div class="preference-item">
                    <div class="preference-info">
                        <div class="preference-title">Dark Mode</div>
                        <div class="preference-description">Use dark theme (currently active)</div>
                    </div>
                    <div class="toggle-switch active" id="darkMode" onclick="togglePreference('darkMode')"></div>
                </div>
            </div>

            <!-- Achievements -->
            <div class="profile-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-trophy"></i>
                        Achievements
                    </h3>
                </div>
                <div class="achievements-grid" id="achievementsList">
                    <!-- Achievements will be loaded here -->
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="danger-zone">
                <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
                <p style="color: #a0a0a0; margin-bottom: 1.5rem;">These actions cannot be undone. Please be careful.</p>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="danger-btn" onclick="showModal('reset')">Reset All Data</button>
                    <button class="danger-btn" onclick="showModal('delete')">Delete Account</button>
                </div>
            </div>
        </main>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <h3 class="modal-title" id="modalTitle">Confirm Action</h3>
                <p class="modal-text" id="modalText">Are you sure you want to perform this action?</p>
                <div class="modal-actions">
                    <button class="confirm-btn" id="confirmBtn">Confirm</button>
                    <button class="cancel-modal-btn" onclick="hideModal()">Cancel</button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 Vivify. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Profile data management
        let userProfile = {};
        let userPreferences = {
            emailNotifications: false,
            dailyReminders: true,
            progressSharing: false,
            darkMode: true
        };

        // Load profile data on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            if (!isLoggedIn) {
                window.location.href = 'login.html?redirect=profile';
                return;
            }

            loadProfileData();
            loadPreferences();
            loadWellnessStats();
            loadAchievements();

            // Handle logout
            document.getElementById('logoutLink').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('userLoggedIn');
                localStorage.removeItem('authToken');
                window.location.href = 'index.html';
            });

            // Profile picture upload
            document.getElementById('profilePictureInput').addEventListener('change', handleProfilePictureUpload);
        });

        function loadProfileData() {
            userProfile = JSON.parse(localStorage.getItem('userProfile') || '{}');
            
            if (userProfile.name) {
                document.getElementById('profileName').textContent = userProfile.name;
                document.getElementById('displayName').textContent = userProfile.name;
                document.getElementById('displayEmail').textContent = userProfile.email || '-';
                document.getElementById('displayYearLevel').textContent = userProfile.yearLevel ? `Year ${userProfile.yearLevel}` : '-';
                document.getElementById('displaySchool').textContent = userProfile.school || '-';
                
                // Update profile details
                const joinDate = userProfile.joinDate ? new Date(userProfile.joinDate).toLocaleDateString() : 'Unknown';
                const yearText = userProfile.yearLevel ? `Year ${userProfile.yearLevel}` : 'Student';
                const schoolText = userProfile.school || 'School';
                document.getElementById('profileDetails').textContent = `${yearText} â€¢ ${schoolText} â€¢ Member since ${joinDate}`;
                document.getElementById('memberSince').textContent = joinDate;
                
                // Load saved profile picture
                const savedProfilePicture = localStorage.getItem('profilePicture');
                if (savedProfilePicture) {
                    const profilePictureElement = document.getElementById('profilePicture');
                    profilePictureElement.innerHTML = `<img src="${savedProfilePicture}" alt="Profile Picture">`;
                }
            }
        }

        function loadPreferences() {
            const savedPreferences = JSON.parse(localStorage.getItem('userPreferences') || '{}');
            userPreferences = { ...userPreferences, ...savedPreferences };
            
            // Update toggle switches
            Object.keys(userPreferences).forEach(key => {
                const toggle = document.getElementById(key);
                if (toggle) {
                    if (userPreferences[key]) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            });
        }

        function loadWellnessStats() {
            const wellnessData = JSON.parse(localStorage.getItem('wellnessData') || '{}');
            
            // Update stats
            document.getElementById('streakCount').textContent = wellnessData.streaks?.currentStreak || 0;
            document.getElementById('wellnessScore').textContent = wellnessData.scores?.overall || 0;
            document.getElementById('activitiesCount').textContent = wellnessData.activities?.length || 0;
        }

        function loadAchievements() {
            const wellnessData = JSON.parse(localStorage.getItem('wellnessData') || '{}');
            const achievements = wellnessData.achievements || {};
            
            const achievementsList = [
                { id: 'first_login', name: 'Welcome', icon: 'fas fa-star', description: 'First time using Vivify' },
                { id: 'week_streak', name: 'Consistent', icon: 'fas fa-calendar-check', description: 'Active for 7 days' },
                { id: 'fitness_enthusiast', name: 'Fitness', icon: 'fas fa-dumbbell', description: '5 workouts in a week' },
                { id: 'mindful_student', name: 'Mindful', icon: 'fas fa-leaf', description: '3 meditation sessions' },
                { id: 'budget_master', name: 'Financial', icon: 'fas fa-piggy-bank', description: 'Track expenses for 7 days' },
                { id: 'wellness_warrior', name: 'Warrior', icon: 'fas fa-trophy', description: 'Achieve 75+ wellness score' }
            ];

            const container = document.getElementById('achievementsList');
            container.innerHTML = achievementsList.map(achievement => {
                const earned = achievements[achievement.id];
                return `
                    <div class="achievement-badge ${earned ? 'earned' : ''}" title="${achievement.description}">
                        <i class="${achievement.icon} achievement-icon"></i>
                        <div class="achievement-name">${achievement.name}</div>
                    </div>
                `;
            }).join('');
        }

        function toggleEdit(section) {
            const info = document.getElementById(`${section}Info`);
            const edit = document.getElementById(`${section}Edit`);
            
            if (edit.classList.contains('active')) {
                cancelEdit(section);
            } else {
                info.style.display = 'none';
                edit.classList.add('active');
                
                // Pre-fill form with current data
                if (section === 'personal') {
                    document.getElementById('editName').value = userProfile.name || '';
                    document.getElementById('editEmail').value = userProfile.email || '';
                    document.getElementById('editYearLevel').value = userProfile.yearLevel || '';
                    document.getElementById('editSchool').value = userProfile.school || '';
                }
            }
        }

        function cancelEdit(section) {
            const info = document.getElementById(`${section}Info`);
            const edit = document.getElementById(`${section}Edit`);
            
            info.style.display = 'block';
            edit.classList.remove('active');
        }

        function savePersonalInfo() {
            const name = document.getElementById('editName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const yearLevel = document.getElementById('editYearLevel').value;
            const school = document.getElementById('editSchool').value.trim();
            
            if (!name || !email || !yearLevel || !school) {
                alert('Please fill in all fields');
                return;
            }
            
            // Update user profile
            userProfile.name = name;
            userProfile.email = email;
            userProfile.yearLevel = parseInt(yearLevel);
            userProfile.school = school;
            // Save to localStorage
           localStorage.setItem('userProfile', JSON.stringify(userProfile));
           
           // Update display
           loadProfileData();
           cancelEdit('personal');
           
           // Show success message
           alert('Profile updated successfully!');
       }

       function togglePreference(preferenceId) {
           const toggle = document.getElementById(preferenceId);
           const isActive = toggle.classList.contains('active');
           
           if (isActive) {
               toggle.classList.remove('active');
               userPreferences[preferenceId] = false;
           } else {
               toggle.classList.add('active');
               userPreferences[preferenceId] = true;
           }
           
           // Save preferences
           localStorage.setItem('userPreferences', JSON.stringify(userPreferences));
           
           // Handle special preferences
           if (preferenceId === 'darkMode') {
               // In a real app, this would toggle the theme
               console.log('Dark mode toggled:', userPreferences[preferenceId]);
           }
       }

       function handleProfilePictureUpload(event) {
           const file = event.target.files[0];
           if (!file) return;
           
           // Check file type
           if (!file.type.startsWith('image/')) {
               alert('Please select an image file');
               return;
           }
           
           // Check file size (max 5MB)
           if (file.size > 5 * 1024 * 1024) {
               alert('Image must be smaller than 5MB');
               return;
           }
           
           const reader = new FileReader();
           reader.onload = function(e) {
               const imageData = e.target.result;
               
               // Update profile picture display
               const profilePictureElement = document.getElementById('profilePicture');
               profilePictureElement.innerHTML = `<img src="${imageData}" alt="Profile Picture">`;
               
               // Save to localStorage
               localStorage.setItem('profilePicture', imageData);
               
               // Update user profile
               userProfile.profilePicture = imageData;
               localStorage.setItem('userProfile', JSON.stringify(userProfile));
           };
           reader.readAsDataURL(file);
       }

       function showModal(action) {
           const modal = document.getElementById('confirmModal');
           const title = document.getElementById('modalTitle');
           const text = document.getElementById('modalText');
           const confirmBtn = document.getElementById('confirmBtn');
           
           if (action === 'reset') {
               title.textContent = 'Reset All Data';
               text.textContent = 'This will permanently delete all your wellness data, activities, and progress. This action cannot be undone.';
               confirmBtn.onclick = resetAllData;
           } else if (action === 'delete') {
               title.textContent = 'Delete Account';
               text.textContent = 'This will permanently delete your account and all associated data. You will not be able to recover this information.';
               confirmBtn.onclick = deleteAccount;
           }
           
           modal.style.display = 'block';
       }

       function hideModal() {
           document.getElementById('confirmModal').style.display = 'none';
       }

       function resetAllData() {
           // Clear wellness data but keep profile
           localStorage.removeItem('wellnessData');
           localStorage.removeItem('expenses');
           localStorage.removeItem('monthlyBudget');
           
           hideModal();
           alert('All wellness data has been reset. Your profile information remains intact.');
           
           // Reload stats
           loadWellnessStats();
           loadAchievements();
       }

       function deleteAccount() {
           // Clear all user data
           localStorage.removeItem('userProfile');
           localStorage.removeItem('userLoggedIn');
           localStorage.removeItem('authToken');
           localStorage.removeItem('wellnessData');
           localStorage.removeItem('userPreferences');
           localStorage.removeItem('profilePicture');
           localStorage.removeItem('expenses');
           localStorage.removeItem('monthlyBudget');
           
           // Remove from users list
           const users = JSON.parse(localStorage.getItem('vivifyUsers') || '[]');
           const updatedUsers = users.filter(user => user.email !== userProfile.email);
           localStorage.setItem('vivifyUsers', JSON.stringify(updatedUsers));
           
           hideModal();
           alert('Your account has been deleted. You will now be redirected to the home page.');
           
           // Redirect to home
           window.location.href = 'index.html';
       }

       // Close modal when clicking outside
       window.onclick = function(event) {
           const modal = document.getElementById('confirmModal');
           if (event.target === modal) {
               hideModal();
           }
       }

       // Update profile picture in header if it exists
       function updateHeaderProfilePic() {
           const savedProfilePicture = localStorage.getItem('profilePicture');
           const headerProfilePic = document.querySelector('nav .profile-pic');
           
           if (savedProfilePicture && headerProfilePic) {
               headerProfilePic.src = savedProfilePicture;
               headerProfilePic.style.display = 'block';
           }
       }

       // Call on page load
       updateHeaderProfilePic();

       // Add some profile enhancement features
       function generateProfileStats() {
           const wellnessData = JSON.parse(localStorage.getItem('wellnessData') || '{}');
           const expenses = JSON.parse(localStorage.getItem('expenses') || '[]');
           
           // Calculate additional stats
           const totalActivities = wellnessData.activities?.length || 0;
           const totalExpenses = expenses.length;
           const avgWellnessScore = wellnessData.scores?.overall || 0;
           const longestStreak = wellnessData.streaks?.longestStreak || 0;
           
           // Add more detailed stats to profile
           const additionalStats = document.createElement('div');
           additionalStats.innerHTML = `
               <div class="profile-stats" style="margin-top: 1rem; border-top: 1px solid #333; padding-top: 1rem;">
                   <div class="stat-item">
                       <span class="stat-value">${longestStreak}</span>
                       <span class="stat-label">Longest Streak</span>
                   </div>
                   <div class="stat-item">
                       <span class="stat-value">${totalExpenses}</span>
                       <span class="stat-label">Expenses Tracked</span>
                   </div>
                   <div class="stat-item">
                       <span class="stat-value">${avgWellnessScore}%</span>
                       <span class="stat-label">Avg Score</span>
                   </div>
               </div>
           `;
           
           // Find existing stats and add additional ones
           const existingStats = document.querySelector('.profile-stats');
           if (existingStats && !document.querySelector('.profile-stats + .profile-stats')) {
               existingStats.parentNode.appendChild(additionalStats);
           }
       }

       // Generate additional stats
       setTimeout(generateProfileStats, 1000);

       // Add profile completion percentage
       function calculateProfileCompletion() {
           let completion = 0;
           const fields = ['name', 'email', 'school', 'yearLevel'];
           
           fields.forEach(field => {
               if (userProfile[field]) completion += 20;
           });
           
           if (localStorage.getItem('profilePicture')) completion += 20;
           
           return completion;
       }

       function showProfileCompletion() {
           const completion = calculateProfileCompletion();
           const completionBar = document.createElement('div');
           completionBar.innerHTML = `
               <div style="margin: 1rem 0; padding: 1rem; background: #2a2a2a; border-radius: 10px; border: 1px solid #333;">
                   <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                       <span style="color: #ffffff; font-weight: 500;">Profile Completion</span>
                       <span style="color: #f39c12; font-weight: 600;">${completion}%</span>
                   </div>
                   <div style="height: 8px; background: #333; border-radius: 4px; overflow: hidden;">
                       <div style="height: 100%; background: linear-gradient(90deg, #f39c12, #e67e22); width: ${completion}%; border-radius: 4px; transition: width 0.3s ease;"></div>
                   </div>
                   ${completion < 100 ? '<p style="color: #a0a0a0; font-size: 0.85rem; margin: 0.5rem 0 0 0;">Complete your profile to unlock all features!</p>' : '<p style="color: #27ae60; font-size: 0.85rem; margin: 0.5rem 0 0 0;">âœ“ Profile complete! You have access to all features.</p>'}
               </div>
           `;
           
           // Add to profile header
           const profileContent = document.querySelector('.profile-content');
           if (profileContent && !document.querySelector('.profile-completion')) {
               completionBar.className = 'profile-completion';
               profileContent.appendChild(completionBar);
           }
       }

       // Show profile completion
       setTimeout(showProfileCompletion, 1500);

       // Add quick actions
       function addQuickActions() {
           const quickActions = document.createElement('div');
           quickActions.innerHTML = `
               <div class="profile-card" style="margin-top: 2rem;">
                   <div class="card-header">
                       <h3 class="card-title">
                           <i class="fas fa-bolt"></i>
                           Quick Actions
                       </h3>
                   </div>
                   <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                       <a href="dashboard.html" style="text-decoration: none; color: inherit;">
                           <div style="background: #333; padding: 1rem; border-radius: 10px; text-align: center; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='#444'" onmouseout="this.style.background='#333'">
                               <i class="fas fa-chart-line" style="color: #f39c12; font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
                               <span style="font-size: 0.9rem; font-weight: 500;">View Dashboard</span>
                           </div>
                       </a>
                       <a href="expense-tracker.html" style="text-decoration: none; color: inherit;">
                           <div style="background: #333; padding: 1rem; border-radius: 10px; text-align: center; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='#444'" onmouseout="this.style.background='#333'">
                               <i class="fas fa-wallet" style="color: #f39c12; font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
                               <span style="font-size: 0.9rem; font-weight: 500;">Track Expenses</span>
                           </div>
                       </a>
                       <div onclick="downloadData()" style="background: #333; padding: 1rem; border-radius: 10px; text-align: center; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='#444'" onmouseout="this.style.background='#333'">
                           <i class="fas fa-download" style="color: #f39c12; font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
                           <span style="font-size: 0.9rem; font-weight: 500;">Export Data</span>
                       </div>
                       <div onclick="shareProfile()" style="background: #333; padding: 1rem; border-radius: 10px; text-align: center; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.background='#444'" onmouseout="this.style.background='#333'">
                           <i class="fas fa-share" style="color: #f39c12; font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
                           <span style="font-size: 0.9rem; font-weight: 500;">Share Progress</span>
                       </div>
                   </div>
               </div>
           `;
           
           // Add before danger zone
           const dangerZone = document.querySelector('.danger-zone');
           if (dangerZone) {
               dangerZone.parentNode.insertBefore(quickActions, dangerZone);
           }
       }

       function downloadData() {
           const allData = {
               profile: userProfile,
               wellnessData: JSON.parse(localStorage.getItem('wellnessData') || '{}'),
               preferences: userPreferences,
               expenses: JSON.parse(localStorage.getItem('expenses') || '[]'),
               exportDate: new Date().toISOString()
           };
           
           const dataStr = JSON.stringify(allData, null, 2);
           const dataBlob = new Blob([dataStr], {type: 'application/json'});
           const url = URL.createObjectURL(dataBlob);
           
           const link = document.createElement('a');
           link.href = url;
           link.download = `vivify-data-${new Date().toISOString().split('T')[0]}.json`;
           link.click();
           
           URL.revokeObjectURL(url);
           alert('Your data has been downloaded successfully!');
       }

       function shareProfile() {
           const wellnessData = JSON.parse(localStorage.getItem('wellnessData') || '{}');
           const stats = {
               name: userProfile.name,
               school: userProfile.school,
               yearLevel: userProfile.yearLevel,
               streak: wellnessData.streaks?.currentStreak || 0,
               wellnessScore: wellnessData.scores?.overall || 0,
               activities: wellnessData.activities?.length || 0
           };
           
           const shareText = `Check out my wellness progress on Vivify! ðŸŒŸ  ` +
                            `ðŸ“š ${stats.name} - Year ${stats.yearLevel} ` +
                            `ðŸ« ${stats.school} ` +
                            `ðŸ”¥ ${stats.streak} day streak ` +
                            `ðŸ“Š ${stats.wellnessScore}% wellness score ` +
                            `âœ… ${stats.activities} activities completed  ` +
                            `Join me on Vivify for a healthier student life!`;
           
           if (navigator.share) {
               navigator.share({
                   title: 'My Vivify Progress',
                   text: shareText
               });
           } else {
               // Fallback - copy to clipboard
               navigator.clipboard.writeText(shareText).then(() => {
                   alert('Progress copied to clipboard! Share it with your friends.');
               }).catch(() => {
                   alert('Unable to copy to clipboard. Please copy manually:  ' + shareText);
               });
           }
       }

       // Add quick actions after page loads
       setTimeout(addQuickActions, 2000);
   </script>

<!-- PWA Scripts -->
<script src="/pwa-install.js"></script>

<script>
// Additional PWA features for each page
document.addEventListener('DOMContentLoaded', function() {
    // Add PWA-specific styles
    if (window.matchMedia('(display-mode: standalone)').matches) {
        document.body.classList.add('pwa-mode');
        
        // Hide address bar on mobile when in PWA mode
        window.scrollTo(0, 1);
    }
    
    // Handle network status
    function updateOnlineStatus() {
        const statusElement = document.getElementById('network-status');
        if (statusElement) {
            if (navigator.onLine) {
                statusElement.textContent = 'Online';
                statusElement.className = 'online';
            } else {
                statusElement.textContent = 'Offline';
                statusElement.className = 'offline';
            }
        }
    }
    
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();
    
    // Add network status indicator if it doesn't exist
    if (!document.getElementById('network-status')) {
        const statusDiv = document.createElement('div');
        statusDiv.id = 'network-status';
        statusDiv.style.cssText = `
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s ease;
        `;
        document.body.appendChild(statusDiv);
        updateOnlineStatus();
    }
});
</script>
<script src="class-management.js"></script> </body>
</html>