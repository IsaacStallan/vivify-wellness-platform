<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Plan Generator - Vivify</title>
    
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Add Font Awesome for icons -->
    
    <style>
        /* Footer styles to ensure it stays at bottom */
        footer {
            background-color: #000;
            color: white;
            text-align: center;
            padding: 2rem 0;
            width: 100%;
            margin-top: auto;
            border-top: 1px solid #333;
        }

        footer .footer-links {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1rem 0 0 0;
            padding: 0;
        }

        footer .footer-links a {
            color: #a0a0a0;
            text-decoration: none;
            transition: color 0.3s;
        }

        footer .footer-links a:hover {
            color: #f39c12;
        }
        
        /* Meal Plan Generator Specific Styles */
        .generator-hero {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://images.unsplash.com/photo-1543352634-a1c51d9f1fa7?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 6rem 2rem;
            text-align: center;
        }

        .generator-hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .generator-hero p {
            font-size: 1.25rem;
            max-width: 800px;
            margin: 0 auto 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .section-title {
            color: #f39c12;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #333;
        }

        .generator-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .generator-form {
            flex: 1;
            min-width: 300px;
            background-color: #222;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .generator-form h3 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #ddd;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            background-color: #333;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #f39c12;
            box-shadow: 0 0 5px rgba(243, 156, 18, 0.3);
        }

        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            background-color: #333;
            border: 1px solid #444;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
            box-sizing: border-box;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            color: #ddd;
            cursor: pointer;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            color: #ddd;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin-right: 0.5rem;
            cursor: pointer;
        }

        .form-help {
            margin-top: 0.5rem;
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-help a {
            color: #f39c12;
            text-decoration: none;
        }

        .form-help a:hover {
            text-decoration: underline;
        }

        .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background-color: #f39c12;
            color: black;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }

        .generate-btn {
            margin-top: 1.5rem;
            padding: 1rem;
            font-size: 1.1rem;
        }

        .results-container {
            flex: 1;
            min-width: 300px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            background-color: #222;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .loading.active {
            display: block;
        }

        .loading p {
            color: #ddd;
            margin-top: 1rem;
        }

        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-radius: 50%;
            border-top-color: #f39c12;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .meal-plan {
            background-color: #222;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: none;
        }

        .meal-plan.active {
            display: block;
        }

        .meal-plan h3 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }

        .nutrition-summary {
            background-color: #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .nutrition-summary h4 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1rem;
            text-align: center;
        }

        .nutrition-summary p {
            color: #ddd;
            text-align: center;
            margin-bottom: 1rem;
        }

        .macro-summary {
            display: flex;
            justify-content: space-between;
            margin: 1.5rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .macro-item {
            flex: 1;
            min-width: 120px;
            text-align: center;
        }

        .macro-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #f39c12;
            margin-bottom: 0.3rem;
        }

        .macro-label {
            color: #ddd;
            font-size: 0.9rem;
        }

        .daily-meals {
            margin-bottom: 2rem;
        }

        .day-header {
            background-color: #333;
            color: #f39c12;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            margin: 1.5rem 0 1rem;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .day-header:hover {
            background-color: #444;
        }

        .day-header::after {
            content: '\f078';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            transition: transform 0.3s;
        }

        .day-header.collapsed::after {
            transform: rotate(-90deg);
        }

        .day-meals {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .meal-card {
            background-color: #333;
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.3s;
        }

        .meal-card:hover {
            transform: translateY(-2px);
        }

        .meal-card h5 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #444;
            font-size: 1.1rem;
        }

        .meal-card ul {
            list-style-type: none;
            padding: 0;
            margin-bottom: 1rem;
        }

        .meal-card li {
            color: #ddd;
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .meal-card li::before {
            content: '\f111';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            font-size: 0.4rem;
            color: #f39c12;
            position: absolute;
            left: 0;
            top: 0.5rem;
        }

        .meal-macros {
            display: flex;
            justify-content: space-between;
            background-color: #444;
            padding: 0.5rem 0.8rem;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #ddd;
        }

        .meal-macros span {
            color: #f39c12;
            font-weight: 500;
        }

        .shopping-list {
            background-color: #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .shopping-list h4 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1rem;
            text-align: center;
        }

        .shopping-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .shopping-category {
            margin-bottom: 1rem;
        }

        .shopping-category h5 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 0.8rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #444;
        }

        .shopping-category ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .shopping-category li {
            color: #ddd;
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .shopping-category li::before {
            content: '\f14a';
            font-family: 'Font Awesome 5 Free';
            font-weight: 400;
            color: #f39c12;
            position: absolute;
            left: 0;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            flex: 1;
            min-width: 150px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .meal-prep-tips {
            background-color: #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .meal-prep-tips h4 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1rem;
            text-align: center;
        }

        .meal-prep-tips ul {
            color: #ddd;
            padding-left: 1.5rem;
            line-height: 1.6;
        }

        .meal-prep-tips li {
            margin-bottom: 0.8rem;
        }

        .error-message {
            background-color: #d32f2f;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            display: none;
        }

        .success-message {
            background-color: #2e7d32;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            display: none;
        }

        .form-validation-error {
            border-color: #d32f2f !important;
            box-shadow: 0 0 5px rgba(211, 47, 47, 0.3) !important;
        }

        .info-card {
            background-color: #222;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .info-card h3 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .info-card p {
            color: #ddd;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .tips-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .tip-card {
            background-color: #333;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .tip-card h4 {
            color: #f39c12;
            margin-top: 0;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .tip-card h4 i {
            margin-right: 0.8rem;
        }

        .tip-card p {
            color: #ddd;
            line-height: 1.6;
            margin-bottom: 0;
        }

        /* Responsive improvements */
        @media (max-width: 768px) {
            .generator-hero h1 {
                font-size: 2.5rem;
            }

            .section-title {
                font-size: 2rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }

            .day-meals {
                grid-template-columns: 1fr;
            }

            .shopping-categories {
                grid-template-columns: 1fr;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .macro-summary {
                flex-direction: column;
                gap: 0.5rem;
            }

            .macro-item {
                min-width: auto;
            }
        }

        /* Print styles */
        @media print {
            .generator-form,
            .action-buttons,
            .footer,
            header,
            .generator-hero {
                display: none !important;
            }

            .meal-plan {
                display: block !important;
                background: white !important;
                color: black !important;
                box-shadow: none !important;
            }

            .day-header {
                background-color: #f5f5f5 !important;
                color: black !important;
                page-break-after: avoid;
            }

            .meal-card {
                background-color: #f9f9f9 !important;
                color: black !important;
                page-break-inside: avoid;
            }

            .shopping-list,
            .meal-prep-tips {
                background-color: #f9f9f9 !important;
                color: black !important;
            }
        }
    @media (max-width: 768px) {
            /* FORCE hide all desktop navigation */
            nav ul,
            nav li,
            .left-nav ul,
            .right-nav ul,
            .left-nav li,
            .right-nav li,
            .left-nav > ul,
            .right-nav > ul {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Ensure nav container works properly */
            nav {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 1rem !important;
                flex-wrap: nowrap !important;
            }
            
            /* Keep logo visible */
            .logo,
            .logo a {
                display: block !important;
                visibility: visible !important;
                font-size: 1.5rem !important;
                white-space: nowrap !important;
            }
            
            /* Force show mobile button if it exists */
            .mobile-menu-btn {
                display: flex !important;
                visibility: visible !important;
                flex-direction: column;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0.5rem;
                z-index: 1001;
            }
            
            /* Mobile button styles */
            .mobile-menu-btn .hamburger {
                width: 25px;
                height: 3px;
                background: #ffffff;
                margin: 3px 0;
                transition: 0.3s;
                border-radius: 2px;
            }
            
            /* Ensure right-nav container shows mobile button */
            .right-nav {
                display: flex !important;
                align-items: center !important;
                visibility: visible !important;
            }
        }

        /* If no mobile button exists, add this emergency button */
        @media (max-width: 768px) {
            nav:not(:has(.mobile-menu-btn))::after {
                content: "☰";
                position: absolute;
                right: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
            }
        }
        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 2rem;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .mobile-menu-link {
            color: #ffffff;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .mobile-menu-link:hover {
            color: #f39c12;
            padding-left: 1rem;
        }

        .mobile-menu-link.mobile-cta {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000 !important;
            border-radius: 12px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
            border: none;
        }

        .mobile-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 1rem 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .mobile-menu-btn.active .hamburger:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        /* Add this to your CSS to ensure mobile elements are hidden on desktop */
        @media (min-width: 769px) {
            .mobile-menu,
            .mobile-menu-btn {
                display: none !important;
                visibility: hidden !important;
            }
        }
    </style>
    <script>
        // Authentication-aware mobile menu
function createMobileMenu() {
    // Only create mobile menu on mobile devices
    if (window.innerWidth > 768) {
        return; // Exit early on desktop
    }
    
    // Check authentication status
    const authToken = localStorage.getItem('authToken');
    const userLoggedIn = localStorage.getItem('userLoggedIn');
    const isLoggedIn = !!(authToken || userLoggedIn === 'true');
    const username = localStorage.getItem('username') || 'User';
    
    console.log('Auth check:', { authToken, userLoggedIn, isLoggedIn, username }); // Debug log
    
    // Create mobile menu if it doesn't exist
    if (!document.getElementById('mobile-menu')) {
        const header = document.querySelector('header');
        const mobileMenu = document.createElement('div');
        mobileMenu.id = 'mobile-menu';
        mobileMenu.className = 'mobile-menu';
        
        // Generate auth-specific menu items
        let authMenuItems = '';
        if (isLoggedIn) {
            authMenuItems = `
                <div class="mobile-menu-divider"></div>
                <div class="mobile-user-info">
                    <span style="color: #f39c12; font-weight: 600; padding: 0.5rem 0;">Welcome, ${username}!</span>
                </div>
                <a href="dashboard.html" class="mobile-menu-link mobile-cta">Dashboard</a>
                <a href="profile.html" class="mobile-menu-link">Profile</a>
                <a href="#" class="mobile-menu-link" onclick="handleMobileLogout(event)">Logout</a>
            `;
        } else {
            authMenuItems = `
                <div class="mobile-menu-divider"></div>
                <a href="login.html" class="mobile-menu-link">Login</a>
                <a href="signup.html" class="mobile-menu-link mobile-cta">Start Training</a>
            `;
        }
        
        mobileMenu.innerHTML = `
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <div class="logo"><a href="index.html">Vivify</a></div>
                    <button class="mobile-menu-close" onclick="closeMobileMenu()">×</button>
                </div>
                <div class="mobile-menu-links">
                    <a href="index.html" class="mobile-menu-link">Home</a>
                    <a href="index.html#training" class="mobile-menu-link">Training Areas</a>
                    <a href="index.html#habits" class="mobile-menu-link">Habits & Challenges</a>
                    <a href="about.html" class="mobile-menu-link">About</a>
                    <a href="community.html" class="mobile-menu-link">Community</a>
                    ${authMenuItems}
                </div>
            </div>
        `;
        header.appendChild(mobileMenu);
    }
    
    // Create mobile button if it doesn't exist
    if (!document.getElementById('mobile-menu-btn')) {
        const nav = document.querySelector('nav');
        const rightNav = nav.querySelector('.right-nav') || nav;
        const mobileBtn = document.createElement('button');
        mobileBtn.id = 'mobile-menu-btn';
        mobileBtn.className = 'mobile-menu-btn';
        mobileBtn.onclick = toggleMobileMenu;
        mobileBtn.innerHTML = `
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
        `;
        rightNav.appendChild(mobileBtn);
    }
}

function handleMobileLogout(event) {
    event.preventDefault();
    if (confirm('Are you sure you want to logout?')) {
        // Clear all auth data
        localStorage.clear();
        
        // Close mobile menu
        closeMobileMenu();
        
        // Refresh the page to update UI
        window.location.reload();
    }
}

function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.toggle('active');
    btn.classList.toggle('active');
    
    if (menu.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
    } else {
        document.body.style.overflow = '';
    }
}

function closeMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.remove('active');
    btn.classList.remove('active');
    document.body.style.overflow = '';
}

// Function to update mobile menu when auth state changes
function updateMobileMenuAuth() {
    const existingMenu = document.getElementById('mobile-menu');
    if (existingMenu) {
        existingMenu.remove();
    }
    createMobileMenu();
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', createMobileMenu);

// Listen for auth state changes (if you have an auth system that fires events)
window.addEventListener('authStateChanged', updateMobileMenuAuth);

// Export functions for external use
window.updateMobileMenuAuth = updateMobileMenuAuth;
window.handleMobileLogout = handleMobileLogout;
// Add this at the end of your mobile menu script
window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
        // Remove mobile elements on desktop
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileBtn = document.getElementById('mobile-menu-btn');
        
        if (mobileMenu) mobileMenu.remove();
        if (mobileBtn) mobileBtn.remove();
        
        // Reset body overflow
        document.body.style.overflow = '';
    } else if (window.innerWidth <= 768) {
        // Recreate mobile menu if switching to mobile
        const existingMenu = document.getElementById('mobile-menu');
        if (!existingMenu) {
            createMobileMenu();
        }
    }
});
        </script>
<!-- CSS Loading Order Fix -->

<link rel="stylesheet" href="styles.css">

<!-- FOUC Prevention -->
<style>
    html { visibility: hidden; opacity: 0; }
    html.loaded { visibility: visible; opacity: 1; transition: opacity 0.3s ease; }
@media (max-width: 768px) {
            /* FORCE hide all desktop navigation */
            nav ul,
            nav li,
            .left-nav ul,
            .right-nav ul,
            .left-nav li,
            .right-nav li,
            .left-nav > ul,
            .right-nav > ul {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Ensure nav container works properly */
            nav {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 1rem !important;
                flex-wrap: nowrap !important;
            }
            
            /* Keep logo visible */
            .logo,
            .logo a {
                display: block !important;
                visibility: visible !important;
                font-size: 1.5rem !important;
                white-space: nowrap !important;
            }
            
            /* Force show mobile button if it exists */
            .mobile-menu-btn {
                display: flex !important;
                visibility: visible !important;
                flex-direction: column;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0.5rem;
                z-index: 1001;
            }
            
            /* Mobile button styles */
            .mobile-menu-btn .hamburger {
                width: 25px;
                height: 3px;
                background: #ffffff;
                margin: 3px 0;
                transition: 0.3s;
                border-radius: 2px;
            }
            
            /* Ensure right-nav container shows mobile button */
            .right-nav {
                display: flex !important;
                align-items: center !important;
                visibility: visible !important;
            }
        }

        /* If no mobile button exists, add this emergency button */
        @media (max-width: 768px) {
            nav:not(:has(.mobile-menu-btn))::after {
                content: "☰";
                position: absolute;
                right: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
            }
        }
        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 2rem;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .mobile-menu-link {
            color: #ffffff;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .mobile-menu-link:hover {
            color: #f39c12;
            padding-left: 1rem;
        }

        .mobile-menu-link.mobile-cta {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000 !important;
            border-radius: 12px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
            border: none;
        }

        .mobile-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 1rem 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .mobile-menu-btn.active .hamburger:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        /* Add this to your CSS to ensure mobile elements are hidden on desktop */
        @media (min-width: 769px) {
            .mobile-menu,
            .mobile-menu-btn {
                display: none !important;
                visibility: hidden !important;
            }
        }
    </style>
    <script>
        // Authentication-aware mobile menu
function createMobileMenu() {
    // Only create mobile menu on mobile devices
    if (window.innerWidth > 768) {
        return; // Exit early on desktop
    }
    
    // Check authentication status
    const authToken = localStorage.getItem('authToken');
    const userLoggedIn = localStorage.getItem('userLoggedIn');
    const isLoggedIn = !!(authToken || userLoggedIn === 'true');
    const username = localStorage.getItem('username') || 'User';
    
    console.log('Auth check:', { authToken, userLoggedIn, isLoggedIn, username }); // Debug log
    
    // Create mobile menu if it doesn't exist
    if (!document.getElementById('mobile-menu')) {
        const header = document.querySelector('header');
        const mobileMenu = document.createElement('div');
        mobileMenu.id = 'mobile-menu';
        mobileMenu.className = 'mobile-menu';
        
        // Generate auth-specific menu items
        let authMenuItems = '';
        if (isLoggedIn) {
            authMenuItems = `
                <div class="mobile-menu-divider"></div>
                <div class="mobile-user-info">
                    <span style="color: #f39c12; font-weight: 600; padding: 0.5rem 0;">Welcome, ${username}!</span>
                </div>
                <a href="dashboard.html" class="mobile-menu-link mobile-cta">Dashboard</a>
                <a href="profile.html" class="mobile-menu-link">Profile</a>
                <a href="#" class="mobile-menu-link" onclick="handleMobileLogout(event)">Logout</a>
            `;
        } else {
            authMenuItems = `
                <div class="mobile-menu-divider"></div>
                <a href="login.html" class="mobile-menu-link">Login</a>
                <a href="signup.html" class="mobile-menu-link mobile-cta">Start Training</a>
            `;
        }
        
        mobileMenu.innerHTML = `
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <div class="logo"><a href="index.html">Vivify</a></div>
                    <button class="mobile-menu-close" onclick="closeMobileMenu()">×</button>
                </div>
                <div class="mobile-menu-links">
                    <a href="index.html" class="mobile-menu-link">Home</a>
                    <a href="index.html#training" class="mobile-menu-link">Training Areas</a>
                    <a href="index.html#habits" class="mobile-menu-link">Habits & Challenges</a>
                    <a href="about.html" class="mobile-menu-link">About</a>
                    <a href="community.html" class="mobile-menu-link">Community</a>
                    ${authMenuItems}
                </div>
            </div>
        `;
        header.appendChild(mobileMenu);
    }
    
    // Create mobile button if it doesn't exist
    if (!document.getElementById('mobile-menu-btn')) {
        const nav = document.querySelector('nav');
        const rightNav = nav.querySelector('.right-nav') || nav;
        const mobileBtn = document.createElement('button');
        mobileBtn.id = 'mobile-menu-btn';
        mobileBtn.className = 'mobile-menu-btn';
        mobileBtn.onclick = toggleMobileMenu;
        mobileBtn.innerHTML = `
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
        `;
        rightNav.appendChild(mobileBtn);
    }
}

function handleMobileLogout(event) {
    event.preventDefault();
    if (confirm('Are you sure you want to logout?')) {
        // Clear all auth data
        localStorage.clear();
        
        // Close mobile menu
        closeMobileMenu();
        
        // Refresh the page to update UI
        window.location.reload();
    }
}

function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.toggle('active');
    btn.classList.toggle('active');
    
    if (menu.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
    } else {
        document.body.style.overflow = '';
    }
}

function closeMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.remove('active');
    btn.classList.remove('active');
    document.body.style.overflow = '';
}

// Function to update mobile menu when auth state changes
function updateMobileMenuAuth() {
    const existingMenu = document.getElementById('mobile-menu');
    if (existingMenu) {
        existingMenu.remove();
    }
    createMobileMenu();
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', createMobileMenu);

// Listen for auth state changes (if you have an auth system that fires events)
window.addEventListener('authStateChanged', updateMobileMenuAuth);

// Export functions for external use
window.updateMobileMenuAuth = updateMobileMenuAuth;
window.handleMobileLogout = handleMobileLogout;
// Add this at the end of your mobile menu script
window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
        // Remove mobile elements on desktop
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileBtn = document.getElementById('mobile-menu-btn');
        
        if (mobileMenu) mobileMenu.remove();
        if (mobileBtn) mobileBtn.remove();
        
        // Reset body overflow
        document.body.style.overflow = '';
    } else if (window.innerWidth <= 768) {
        // Recreate mobile menu if switching to mobile
        const existingMenu = document.getElementById('mobile-menu');
        if (!existingMenu) {
            createMobileMenu();
        }
    }
});
        </script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.documentElement.classList.add('loaded');
    });
    window.addEventListener('load', function() {
        document.documentElement.classList.add('loaded');
    });
</script>
<script src="js/vivify-stats.js"></script>
<script src="js/leaderboard-system.js"></script>
</head>
<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="left-nav">
                    <div class="logo">
                        <a href="index.html" aria-label="Home Page"><h1>Vivify</h1></a>
                    </div>
                    <ul>
                        <li><a href="about.html" aria-label="About Us Page">About</a></li>
                        <li class="dropdown" id="categoryDropdown">
                            <a href="#" class="dropbtn" aria-label="Categories Dropdown">Training</a>
                            <div class="dropdown-content">
                                <a href="fitness.html" aria-label="Fitness Page">Fitness</a>
                                <a href="nutrition.html" class="active" aria-label="Nutrition Page">Nutrition</a>
                                <a href="focus-resilience.html" aria-label="Focus & Resilience Page">Focus & Resilience</a>
                                <a href="life-mastery.html" aria-label="Life Lessons Page">Life Mastery</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="right-nav">
                    <ul>
                        <li><a href="dashboard.html" id="dashboardLink" aria-label="Dashboard">Performance Hub</a></li>
                        <li><a href="profile.html" id="profileLink" aria-label="Profile Page">Profile</a></li>
                        <li><a href="#" id="logoutLink" aria-label="Logout">Logout</a></li>
                        <li><a href="login.html" id="loginLink" style="display: none;" aria-label="Login Page">Login</a></li>
                        <li><a href="signup.html" id="signupLink" style="display: none;" aria-label="Sign Up Page">Sign Up</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Hero Section -->
        <section class="generator-hero">
            <h1>Student Meal Plan Generator</h1>
            <p>Create a personalized meal plan tailored to your nutrition goals, dietary preferences, schedule, and budget to support your academic performance and overall wellbeing.</p>
        </section>

        <!-- Generator Section -->
        <section class="container">
            <h2 class="section-title">Create Your Custom Meal Plan</h2>
            
            <div class="generator-container">
                <div class="generator-form">
                    <h3>Your Information & Preferences</h3>
                    <form id="meal-plan-form" novalidate>
                        <div class="form-group">
                            <label for="calories">Daily Calorie Target</label>
                            <input type="number" id="calories" name="calories" min="1200" max="5000" placeholder="e.g., 2000" required>
                            <p class="form-help">Not sure? <a href="tdee-calculator.html">Calculate your calorie needs</a></p>
                        </div>
                        
                        <div class="form-group">
                            <label for="goal">Primary Nutrition Goal</label>
                            <select id="goal" name="goal" required>
                                <option value="">Select Your Goal</option>
                                <option value="muscle-gain">Muscle Gain</option>
                                <option value="fat-loss">Fat Loss</option>
                                <option value="maintenance">Maintenance/General Health</option>
                                <option value="performance">Athletic Performance</option>
                                <option value="academic">Academic Performance Focus</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="diet-type">Dietary Pattern</label>
                            <select id="diet-type" name="diet-type" required>
                                <option value="">Select Dietary Pattern</option>
                                <option value="balanced">Balanced (No Restrictions)</option>
                                <option value="mediterranean">Mediterranean</option>
                                <option value="high-protein">High Protein</option>
                                <option value="vegetarian">Vegetarian</option>
                                <option value="vegan">Vegan</option>
                                <option value="paleo">Paleo</option>
                                <option value="keto">Ketogenic</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="meals-per-day">Meals Per Day</label>
                            <select id="meals-per-day" name="meals-per-day" required>
                                <option value="3">3 meals</option>
                                <option value="4" selected>4 meals (3 meals + 1 snack)</option>
                                <option value="5">5 meals (3 meals + 2 snacks)</option>
                                <option value="6">6 meals (Frequent small meals)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="time-to-cook">Cooking Time Available</label>
                            <select id="time-to-cook" name="time-to-cook" required>
                                <option value="minimal">Minimal (15 minutes or less)</option>
                                <option value="moderate" selected>Moderate (30 minutes)</option>
                                <option value="flexible">Flexible (45+ minutes)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="budget">Budget Level</label>
                            <select id="budget" name="budget" required>
                                <option value="tight">Tight Budget (Student-friendly)</option>
                                <option value="moderate" selected>Moderate Budget</option>
                                <option value="flexible">Flexible Budget</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Food Allergies/Intolerances</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="dairy"> Dairy
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="eggs"> Eggs
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="gluten"> Gluten
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="nuts"> Tree Nuts
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="peanuts"> Peanuts
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="shellfish"> Shellfish
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="soy"> Soy
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="allergies" value="fish"> Fish
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="foods-dislike">Foods You Dislike</label>
                            <textarea id="foods-dislike" name="foods-dislike" placeholder="Enter foods you don't enjoy (comma separated)"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="kitchen-equipment">Available Kitchen Equipment</label>
                            <div class="checkbox-group">
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="microwave" checked> Microwave
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="stove" checked> Stove/Cooktop
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="oven" checked> Oven
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="blender"> Blender
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="slow-cooker"> Slow Cooker
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="air-fryer"> Air Fryer
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="fridge" checked> Refrigerator
                                </label>
                                <label class="checkbox-option">
                                    <input type="checkbox" name="kitchen" value="freezer" checked> Freezer
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Meal Prep Preference</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="meal-prep" value="daily" checked> Daily Cooking
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="meal-prep" value="batch"> Batch Cooking (2-3 times per week)
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="meal-prep" value="weekly"> Weekly Meal Prep (once per week)
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="days">Days to Generate</label>
                            <select id="days" name="days" required>
                                <option value="1">1 day</option>
                                <option value="3">3 days</option>
                                <option value="5">5 days</option>
                                <option value="7" selected>7 days</option>
                            </select>
                        </div>

                        <div class="error-message" id="form-error"></div>
                        <div class="success-message" id="form-success"></div>
                        
                        <button type="submit" class="btn btn-block generate-btn" id="generate-button">Generate My Meal Plan</button>
                    </form>
                </div>
                
                <div class="results-container">
                    <!-- Loading Spinner -->
                    <div class="loading" id="loading-spinner">
                        <div class="spinner"></div>
                        <p>Creating your personalized meal plan...</p>
                        <p style="font-size: 0.9rem; color: #aaa;">This may take a few moments while we optimize your nutrition plan.</p>
                    </div>
                    
                    <!-- Meal Plan Results -->
                    <div class="meal-plan" id="meal-plan-results">
                        <h3>Your Personalized Student Meal Plan</h3>
                        
                        <div class="nutrition-summary">
                            <h4>Nutrition Overview</h4>
                           <p>Based on your goals and preferences, here's your daily nutritional breakdown:</p>
                           
                           <div class="macro-summary">
                               <div class="macro-item">
                                   <div class="macro-value" id="daily-calories">2,000</div>
                                   <div class="macro-label">Calories</div>
                               </div>
                               <div class="macro-item">
                                   <div class="macro-value" id="daily-protein">125g</div>
                                   <div class="macro-label">Protein (<span id="protein-percent">25</span>%)</div>
                               </div>
                               <div class="macro-item">
                                   <div class="macro-value" id="daily-carbs">250g</div>
                                   <div class="macro-label">Carbs (<span id="carb-percent">50</span>%)</div>
                               </div>
                               <div class="macro-item">
                                   <div class="macro-value" id="daily-fat">56g</div>
                                   <div class="macro-label">Fat (<span id="fat-percent">25</span>%)</div>
                               </div>
                           </div>
                       </div>
                       
                       <div class="daily-meals">
                           <h4 style="color: #f39c12; margin-bottom: 1rem;">Weekly Meal Schedule</h4>
                           <div id="generated-days-container"></div>
                       </div>
                       
                       <div class="shopping-list">
                           <h4>Weekly Shopping List</h4>
                           <div id="shopping-categories-container"></div>
                       </div>
                       
                       <div class="meal-prep-tips">
                           <h4>Meal Prep Strategies</h4>
                           <p id="prep-strategy-text">Based on your preferences, here's a recommended prep schedule:</p>
                           <ul id="prep-tips-list"></ul>
                       </div>
                       
                       <div class="action-buttons">
                           <button class="btn" id="save-meal-plan">
                               <i class="fas fa-save"></i> Save Plan
                           </button>
                           <button class="btn" id="print-meal-plan">
                               <i class="fas fa-print"></i> Print Plan
                           </button>
                           <button class="btn" id="regenerate-plan">
                               <i class="fas fa-redo"></i> Regenerate
                           </button>
                       </div>
                   </div>
               </div>
           </div>
           
           <!-- Information Section -->
           <div class="info-card">
               <h3>Student Meal Planning Principles</h3>
               <p>Effective meal planning for students balances nutrition, convenience, affordability, and academic support. Here are the key principles behind our meal plan generator:</p>
               
               <div class="tips-cards">
                   <div class="tip-card">
                       <h4><i class="fas fa-brain"></i> Brain-Boosting Nutrition</h4>
                       <p>Each meal plan incorporates foods known to support cognitive function, including omega-3 fatty acids (fatty fish, walnuts), antioxidants (berries, dark leafy greens), and complex carbohydrates for sustained energy during study sessions. Protein timing and distribution are optimized to support neurotransmitter production.</p>
                   </div>
                   
                   <div class="tip-card">
                       <h4><i class="fas fa-dollar-sign"></i> Budget Optimization</h4>
                       <p>Plans utilize cost-effective protein sources (eggs, legumes, chicken), seasonal produce, and staple grains that provide excellent nutritional value per dollar. Meal prep recommendations minimize food waste, and shopping lists are organized to help you maximize your grocery budget and take advantage of bulk purchases.</p>
                   </div>
                   
                   <div class="tip-card">
                       <h4><i class="fas fa-clock"></i> Time-Efficient Preparation</h4>
                       <p>Recipes and meal combinations are designed to work with your available cooking time and kitchen equipment. Batch cooking strategies allow you to prepare multiple meals at once, and quick-assembly options are included for busy days before exams or during heavy course loads.</p>
                   </div>
                   
                   <div class="tip-card">
                       <h4><i class="fas fa-balance-scale"></i> Balanced Macronutrients</h4>
                       <p>Each meal plan provides appropriate proportions of protein, carbohydrates, and fats based on your goals. Academic performance plans emphasize slow-releasing carbs for sustained energy, while athletic plans may include more protein for recovery and muscle maintenance.</p>
                   </div>
               </div>
           </div>
       </section>
       
       <!-- Footer -->
       <footer>
           <p>&copy; 2025 Vivify. All rights reserved.</p>
           <ul class="footer-links">
               <li><a href="privacy.html" aria-label="Privacy Policy">Privacy Policy</a></li>
               <li><a href="terms.html" aria-label="Terms of Service">Terms of Service</a></li>
               <li><a href="contact.html" aria-label="Contact Us">Contact Us</a></li>
           </ul>
       </footer>
   </div>

   <script>
       // Comprehensive meal database organized by dietary preferences
       const MEAL_DATABASE = {
           breakfasts: {
               balanced: [
                   {
                       name: "Protein Oatmeal Bowl",
                       items: ["1/2 cup oats", "1 scoop protein powder", "1 tbsp almond butter", "1/2 banana", "berries"],
                       calories: 480, protein: 35, carbs: 55, fat: 15
                   },
                   {
                       name: "Avocado Toast with Eggs",
                       items: ["2 slices whole grain bread", "1 avocado", "2 scrambled eggs", "cherry tomatoes"],
                       calories: 520, protein: 22, carbs: 45, fat: 28
                   },
                   {
                       name: "Greek Yogurt Parfait",
                       items: ["1 cup Greek yogurt", "1/4 cup granola", "mixed berries", "1 tbsp honey", "chia seeds"],
                       calories: 380, protein: 25, carbs: 42, fat: 12
                   },
                   {
                       name: "Breakfast Burrito",
                       items: ["whole wheat tortilla", "2 scrambled eggs", "black beans", "cheese", "salsa", "spinach"],
                       calories: 450, protein: 28, carbs: 38, fat: 20
                   },
                   {
                       name: "Smoothie Bowl",
                       items: ["protein powder", "frozen berries", "banana", "almond milk", "granola topping"],
                       calories: 420, protein: 30, carbs: 48, fat: 14
                   }
               ],
               vegetarian: [
                   {
                       name: "Veggie Scramble",
                       items: ["2 eggs", "spinach", "mushrooms", "bell peppers", "cheese", "whole grain toast"],
                       calories: 420, protein: 24, carbs: 28, fat: 22
                   },
                   {
                       name: "Overnight Oats",
                       items: ["oats", "chia seeds", "almond milk", "maple syrup", "berries", "nuts"],
                       calories: 380, protein: 12, carbs: 58, fat: 15
                   },
                   {
                       name: "Peanut Butter Toast",
                       items: ["2 slices whole grain bread", "2 tbsp peanut butter", "sliced banana", "hemp seeds"],
                       calories: 440, protein: 18, carbs: 52, fat: 20
                   }
               ],
               vegan: [
                   {
                       name: "Tofu Scramble",
                       items: ["firm tofu", "nutritional yeast", "spinach", "mushrooms", "turmeric", "whole grain toast"],
                       calories: 380, protein: 22, carbs: 32, fat: 18
                   },
                   {
                       name: "Chia Pudding",
                       items: ["chia seeds", "coconut milk", "maple syrup", "berries", "granola"],
                       calories: 360, protein: 8, carbs: 45, fat: 18
                   },
                   {
                       name: "Quinoa Breakfast Bowl",
                       items: ["cooked quinoa", "almond milk", "berries", "nuts", "coconut flakes"],
                       calories: 400, protein: 12, carbs: 58, fat: 16
                   }
               ],
               keto: [
                   {
                       name: "Keto Eggs Benedict",
                       items: ["2 eggs", "avocado", "bacon", "hollandaise sauce", "spinach"],
                       calories: 520, protein: 25, carbs: 8, fat: 45
                   },
                   {
                       name: "Bulletproof Coffee & Eggs",
                       items: ["coffee with MCT oil", "2 scrambled eggs", "cheese", "spinach"],
                       calories: 480, protein: 20, carbs: 5, fat: 42
                   }
               ]
           },
           lunches: {
               balanced: [
                   {
                       name: "Turkey Avocado Wrap",
                       items: ["whole wheat wrap", "sliced turkey", "avocado", "lettuce", "tomato", "hummus"],
                       calories: 520, protein: 28, carbs: 45, fat: 22
                   },
                   {
                       name: "Quinoa Buddha Bowl",
                       items: ["quinoa", "chickpeas", "roasted vegetables", "tahini dressing", "pumpkin seeds"],
                       calories: 480, protein: 18, carbs: 65, fat: 18
                   },
                   {
                       name: "Chicken Caesar Salad",
                       items: ["grilled chicken", "romaine lettuce", "parmesan", "whole grain croutons", "caesar dressing"],
                       calories: 450, protein: 35, carbs: 25, fat: 24
                   },
                   {
                       name: "Tuna Pasta Salad",
                       items: ["whole grain pasta", "tuna", "vegetables", "olive oil dressing", "herbs"],
                       calories: 490, protein: 32, carbs: 52, fat: 16
                   },
                   {
                       name: "Mexican Bowl",
                       items: ["brown rice", "black beans", "grilled chicken", "corn", "salsa", "avocado"],
                       calories: 510, protein: 30, carbs: 55, fat: 18
                   }
               ],
               vegetarian: [
                   {
                       name: "Caprese Sandwich",
                       items: ["whole grain bread", "mozzarella", "tomato", "basil", "balsamic glaze"],
                       calories: 420, protein: 20, carbs: 45, fat: 18
                   },
                   {
                       name: "Lentil Soup & Bread",
                       items: ["lentil soup", "whole grain roll", "side salad", "olive oil"],
                       calories: 460, protein: 22, carbs: 68, fat: 12
                   },
                   {
                       name: "Veggie Quesadilla",
                       items: ["whole wheat tortilla", "cheese", "bell peppers", "onions", "black beans"],
                       calories: 480, protein: 24, carbs: 52, fat: 20
                   }
               ],
               vegan: [
                   {
                       name: "Hummus Veggie Wrap",
                       items: ["whole wheat wrap", "hummus", "cucumber", "sprouts", "bell peppers", "avocado"],
                       calories: 420, protein: 15, carbs: 58, fat: 16
                   },
                   {
                       name: "Tempeh Stir-fry",
                       items: ["brown rice", "tempeh", "mixed vegetables", "soy sauce", "sesame oil"],
                       calories: 450, protein: 20, carbs: 55, fat: 18
                   }
               ],
               keto: [
                   {
                       name: "Cobb Salad",
                       items: ["mixed greens", "chicken", "bacon", "eggs", "blue cheese", "avocado"],
                       calories: 520, protein: 32, carbs: 8, fat: 42
                   },
                   {
                       name: "Zucchini Lasagna",
                       items: ["zucchini noodles", "ground beef", "ricotta", "mozzarella", "tomato sauce"],
                       calories: 480, protein: 35, carbs: 12, fat: 35
                   }
               ]
           },
           dinners: {
               balanced: [
                   {
                       name: "Baked Salmon with Quinoa",
                       items: ["salmon fillet", "quinoa", "roasted broccoli", "lemon", "olive oil"],
                       calories: 520, protein: 40, carbs: 45, fat: 15
                   },
                   {
                       name: "Chicken Stir-fry",
                       items: ["chicken breast", "brown rice", "mixed vegetables", "soy sauce", "ginger"],
                       calories: 480, protein: 38, carbs: 52, fat: 12
                   },
                   {
                       name: "Lean Beef & Sweet Potato",
                       items: ["lean ground beef", "baked sweet potato", "green beans", "herbs"],
                       calories: 510, protein: 35, carbs: 48, fat: 16
                   },
                   {
                       name: "Turkey Meatballs & Pasta",
                       items: ["turkey meatballs", "whole grain pasta", "marinara sauce", "side salad"],
                       calories: 490, protein: 32, carbs: 58, fat: 14
                   },
                   {
                       name: "Grilled Chicken & Vegetables",
                       items: ["grilled chicken", "roasted vegetables", "quinoa", "herbs", "olive oil"],
                       calories: 460, protein: 42, carbs: 35, fat: 16
                   }
               ],
               vegetarian: [
                   {
                       name: "Eggplant Parmesan",
                       items: ["baked eggplant", "marinara sauce", "mozzarella", "whole grain pasta"],
                       calories: 480, protein: 22, carbs: 62, fat: 16
                   },
                   {
                       name: "Vegetable Curry",
                       items: ["mixed vegetables", "coconut milk", "chickpeas", "brown rice", "spices"],
                       calories: 450, protein: 18, carbs: 68, fat: 14
                   },
                   {
                       name: "Stuffed Bell Peppers",
                       items: ["bell peppers", "quinoa", "black beans", "cheese", "vegetables"],
                       calories: 420, protein: 20, carbs: 55, fat: 12
                   }
               ],
               vegan: [
                   {
                       name: "Lentil Bolognese",
                       items: ["lentils", "whole grain pasta", "marinara sauce", "vegetables", "nutritional yeast"],
                       calories: 440, protein: 22, carbs: 72, fat: 8
                   },
                   {
                       name: "Buddha Bowl",
                       items: ["quinoa", "roasted vegetables", "chickpeas", "tahini dressing", "seeds"],
                       calories: 460, protein: 18, carbs: 65, fat: 16
                   }
               ],
               keto: [
                   {
                       name: "Keto Salmon & Asparagus",
                       items: ["salmon", "asparagus", "avocado", "olive oil", "lemon"],
                       calories: 520, protein: 38, carbs: 8, fat: 38
                   },
                   {
                       name: "Cauliflower Casserole",
                       items: ["cauliflower", "ground beef", "cheese", "cream", "herbs"],
                       calories: 480, protein: 32, carbs: 10, fat: 36
                   }
               ]
           },
           snacks: {
               balanced: [
                   {
                       name: "Apple with Almond Butter",
                       items: ["medium apple", "2 tbsp almond butter"],
                       calories: 290, protein: 8, carbs: 25, fat: 18
                   },
                   {
                       name: "Greek Yogurt & Berries",
                       items: ["Greek yogurt", "mixed berries", "granola"],
                       calories: 250, protein: 15, carbs: 32, fat: 8
                   },
                   {
                       name: "Protein Shake",
                       items: ["protein powder", "almond milk", "banana"],
                       calories: 280, protein: 25, carbs: 28, fat: 6
                   },
                   {
                       name: "Trail Mix",
                       items: ["mixed nuts", "dried fruit", "dark chocolate chips"],
                       calories: 320, protein: 8, carbs: 24, fat: 22
                   }
               ],
               vegetarian: [
                   {
                       name: "Hummus & Veggies",
                       items: ["hummus", "carrot sticks", "cucumber", "bell peppers"],
                       calories: 180, protein: 8, carbs: 22, fat: 8
                   },
                   {
                       name: "Cheese & Crackers",
                       items: ["whole grain crackers", "cheese", "grapes"],
                       calories: 260, protein: 12, carbs: 28, fat: 12
                   }
               ],
               vegan: [
                   {
                       name: "Energy Balls",
                       items: ["dates", "nuts", "coconut", "chia seeds"],
                       calories: 240, protein: 6, carbs: 28, fat: 14
                   },
                   {
                       name: "Avocado Toast",
                       items: ["whole grain toast", "avocado", "hemp seeds"],
                       calories: 280, protein: 8, carbs: 22, fat: 18
                   }
               ],
               keto: [
                   {
                       name: "Keto Fat Bombs",
                       items: ["coconut oil", "nuts", "cocoa powder"],
                       calories: 320, protein: 4, carbs: 6, fat: 32
                   },
                   {
                       name: "Cheese & Olives",
                       items: ["cheese cubes", "olives", "cucumber"],
                       calories: 280, protein: 12, carbs: 6, fat: 24
                   }
               ]
           }
       };

       // Function to filter meals based on allergies and dislikes
       function filterMeals(meals, allergies, dislikes) {
           return meals.filter(meal => {
               // Check allergies
               for (let allergy of allergies) {
                   if (meal.items.some(item => item.toLowerCase().includes(allergy.toLowerCase()))) {
                       return false;
                   }
               }
               
               // Check dislikes
               for (let dislike of dislikes) {
                   if (meal.items.some(item => item.toLowerCase().includes(dislike.toLowerCase()))) {
                       return false;
                   }
               }
               
               return true;
           });
       }

       // Function to get random meals with variation
       function getRandomMeals(mealArray, count) {
           const shuffled = [...mealArray].sort(() => 0.5 - Math.random());
           return shuffled.slice(0, count);
       }

       // FIXED: Function to generate shopping list based on selected meals
       function generateShoppingList(selectedMeals) {
           const ingredients = {};
           
           selectedMeals.forEach(dayMeals => {
               // Handle the case where dayMeals is an object with meal types as keys
               Object.values(dayMeals).forEach(meal => {
                   if (meal && meal.items) {
                       meal.items.forEach(item => {
                           const cleanItem = item.replace(/\d+\s*(cup|tbsp|tsp|oz|slice|medium|large|small)\s*/g, '').trim();
                           if (cleanItem) {
                               ingredients[cleanItem] = (ingredients[cleanItem] || 0) + 1;
                           }
                       });
                   }
               });
           });

           return {
               proteins: Object.keys(ingredients).filter(item => 
                   ['chicken', 'turkey', 'salmon', 'tuna', 'eggs', 'tofu', 'tempeh', 'lentils', 'chickpeas', 'beans', 'protein powder', 'greek yogurt', 'cheese'].some(protein => 
                       item.toLowerCase().includes(protein)
                   )
               ),
               grains: Object.keys(ingredients).filter(item => 
                   ['oats', 'quinoa', 'rice', 'bread', 'pasta', 'tortilla', 'crackers'].some(grain => 
                       item.toLowerCase().includes(grain)
                   )
               ),
               produce: Object.keys(ingredients).filter(item => 
                   ['banana', 'berries', 'apple', 'avocado', 'spinach', 'lettuce', 'tomato', 'broccoli', 'carrots', 'bell peppers', 'cucumber', 'onions', 'mushrooms'].some(produce => 
                       item.toLowerCase().includes(produce)
                   )
               ),
               pantry: Object.keys(ingredients).filter(item => 
                   ['almond butter', 'olive oil', 'nuts', 'seeds', 'spices', 'herbs', 'soy sauce', 'coconut oil'].some(pantry => 
                       item.toLowerCase().includes(pantry)
                   )
               )
           };
       }

       document.addEventListener('DOMContentLoaded', function() {
           // Check if user is logged in
           const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
           
           // Update UI based on login status
           document.getElementById('loginLink').style.display = isLoggedIn ? 'none' : 'inline';
           document.getElementById('signupLink').style.display = isLoggedIn ? 'none' : 'inline';
           document.getElementById('logoutLink').style.display = isLoggedIn ? 'inline' : 'none';
           document.getElementById('profileLink').style.display = isLoggedIn ? 'inline' : 'none';
           document.getElementById('dashboardLink').style.display = isLoggedIn ? 'inline' : 'none';
           
           // Handle logout
           document.getElementById('logoutLink').addEventListener('click', function(e) {
               e.preventDefault();
               localStorage.removeItem('userLoggedIn');
               window.location.href = 'index.html';
           });
           
           // Form elements
           const mealPlanForm = document.getElementById('meal-plan-form');
           const loadingSpinner = document.getElementById('loading-spinner');
           const mealPlanResults = document.getElementById('meal-plan-results');
           const generateButton = document.getElementById('generate-button');
           const errorMessage = document.getElementById('form-error');
           const successMessage = document.getElementById('form-success');
           
           // Form validation function
           function validateForm() {
               let isValid = true;
               const requiredFields = ['calories', 'goal', 'diet-type', 'meals-per-day', 'time-to-cook', 'budget', 'days'];
               
               // Clear previous validation styles
               document.querySelectorAll('.form-validation-error').forEach(el => {
                   el.classList.remove('form-validation-error');
               });
               
               // Validate required fields
               requiredFields.forEach(fieldId => {
                   const field = document.getElementById(fieldId);
                   if (!field.value.trim()) {
                       field.classList.add('form-validation-error');
                       isValid = false;
                   }
               });
               
               // Validate calorie range
               const calories = parseInt(document.getElementById('calories').value);
               if (calories && (calories < 1200 || calories > 5000)) {
                   document.getElementById('calories').classList.add('form-validation-error');
                   isValid = false;
               }
               
               return isValid;
           }
           
           // Show error message
           function showError(message) {
               errorMessage.textContent = message;
               errorMessage.style.display = 'block';
               successMessage.style.display = 'none';
               setTimeout(() => {
                   errorMessage.style.display = 'none';
               }, 5000);
           }
           
           // Show success message
           function showSuccess(message) {
               successMessage.textContent = message;
               successMessage.style.display = 'block';
               errorMessage.style.display = 'none';
               setTimeout(() => {
                   successMessage.style.display = 'none';
               }, 3000);
           }
           
           // Form submission for meal plan generation
           mealPlanForm.addEventListener('submit', function(e) {
               e.preventDefault();
               
               // Validate form
               if (!validateForm()) {
                   showError('Please fill in all required fields with valid values.');
                   return;
               }
               
               // Disable button and show loading
               generateButton.disabled = true;
               generateButton.textContent = 'Generating...';
               loadingSpinner.classList.add('active');
               mealPlanResults.style.display = 'none';
               
               // Simulate calculation/generation delay
               setTimeout(function() {
                   try {
                       generateMealPlan();
                       
                       // Hide loading spinner and show results
                       loadingSpinner.classList.remove('active');
                       mealPlanResults.style.display = 'block';
                       
                       // Re-enable button
                       generateButton.disabled = false;
                       generateButton.textContent = 'Generate My Meal Plan';
                       
                       // Show success message
                       showSuccess('Your meal plan has been generated successfully!');
                       
                       // Scroll to results
                       mealPlanResults.scrollIntoView({ behavior: 'smooth' });
                   } catch (error) {
                       // Handle any errors
                       loadingSpinner.classList.remove('active');
                       generateButton.disabled = false;
                       generateButton.textContent = 'Generate My Meal Plan';
                       showError('There was an error generating your meal plan. Please try again.');
                       console.error('Meal plan generation error:', error);
                   }
               }, 2000);
           });
           
           // Day header toggle functionality
           document.addEventListener('click', function(e) {
               if(e.target.matches('.day-header') || e.target.closest('.day-header')) {
                   const header = e.target.matches('.day-header') ? e.target : e.target.closest('.day-header');
                   header.classList.toggle('collapsed');
                   
                   const mealSection = header.nextElementSibling;
                   if(mealSection) {
                       if(mealSection.style.display === 'none' || getComputedStyle(mealSection).display === 'none') {
                           mealSection.style.display = 'grid';
                       } else {
                           mealSection.style.display = 'none';
                       }
                   }
               }
           });
           
           // Function to generate meal plan based on form inputs
           function generateMealPlan() {
               // Get form values
               const calories = parseInt(document.getElementById('calories').value);
               const goal = document.getElementById('goal').value;
               const dietType = document.getElementById('diet-type').value;
               const mealsPerDay = parseInt(document.getElementById('meals-per-day').value);
               const days = parseInt(document.getElementById('days').value);
               const mealPrepPreference = document.querySelector('input[name="meal-prep"]:checked').value;
               const timeAvailable = document.getElementById('time-to-cook').value;
               const budget = document.getElementById('budget').value;
               
               // Get allergies and dislikes
               const allergies = Array.from(document.querySelectorAll('input[name="allergies"]:checked')).map(cb => cb.value);
               const dislikesText = document.getElementById('foods-dislike').value;
               const dislikes = dislikesText ? dislikesText.split(',').map(item => item.trim()).filter(item => item) : [];
               
               // Update nutrition summary
               document.getElementById('daily-calories').textContent = calories.toLocaleString();
               
               // Calculate macros based on goal
               let proteinPct, carbPct, fatPct;
               
               switch(goal) {
                   case 'muscle-gain':
                       proteinPct = 0.30; carbPct = 0.45; fatPct = 0.25;
                       break;
                   case 'fat-loss':
                       proteinPct = 0.35; carbPct = 0.40; fatPct = 0.25;
                       break;
                   case 'performance':
                       proteinPct = 0.25; carbPct = 0.55; fatPct = 0.20;
                       break;
                   case 'academic':
                       proteinPct = 0.20; carbPct = 0.55; fatPct = 0.25;
                       break;
                   default: // maintenance
                       proteinPct = 0.25; carbPct = 0.50; fatPct = 0.25;
               }
               
               // Adjust macros based on diet type
               if(dietType === 'keto') {
                   proteinPct = 0.30; carbPct = 0.10; fatPct = 0.60;
               } else if(dietType === 'high-protein') {
                   proteinPct = Math.min(proteinPct + 0.05, 0.40);
                   carbPct = carbPct - 0.05;
               } else if(dietType === 'vegan' || dietType === 'vegetarian') {
                   proteinPct = Math.max(proteinPct - 0.05, 0.15);
                   carbPct = carbPct + 0.05;
               }
               
               // Calculate macros in grams
               const proteinGrams = Math.round((calories * proteinPct) / 4);
               const carbGrams = Math.round((calories * carbPct) / 4);
               const fatGrams = Math.round((calories * fatPct) / 9);
               
               // Update UI with calculated macros
               document.getElementById('daily-protein').textContent = proteinGrams + 'g';
               document.getElementById('daily-carbs').textContent = carbGrams + 'g';
               document.getElementById('daily-fat').textContent = fatGrams + 'g';
               document.getElementById('protein-percent').textContent = Math.round(proteinPct * 100);
               document.getElementById('carb-percent').textContent = Math.round(carbPct * 100);
               document.getElementById('fat-percent').textContent = Math.round(fatPct * 100);
               
               // Get appropriate meal categories based on diet type
               let mealCategory = dietType === 'balanced' ? 'balanced' : dietType;
               if (!MEAL_DATABASE.breakfasts[mealCategory]) {
                   mealCategory = 'balanced'; // fallback
               }
               
               // Filter meals based on allergies and dislikes
               const availableBreakfasts = filterMeals(MEAL_DATABASE.breakfasts[mealCategory], allergies, dislikes);
               const availableLunches = filterMeals(MEAL_DATABASE.lunches[mealCategory], allergies, dislikes);
               const availableDinners = filterMeals(MEAL_DATABASE.dinners[mealCategory], allergies, dislikes);
               const availableSnacks = filterMeals(MEAL_DATABASE.snacks[mealCategory], allergies, dislikes);
               
               // Generate meals for each day
               const selectedMeals = [];
               const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
               const daysContainer = document.getElementById('generated-days-container');
               daysContainer.innerHTML = '';
               
               for (let i = 0; i < days; i++) {
                   const dayName = dayNames[i] || `Day ${i + 1}`;
                   
                   // Select different meals for each day to ensure variety
                   let dayBreakfast = getRandomMeals(availableBreakfasts.filter(meal => 
                       !selectedMeals.some(day => day.breakfast && day.breakfast.name === meal.name)
                   ), 1)[0];
                   
                   let dayLunch = getRandomMeals(availableLunches.filter(meal => 
                       !selectedMeals.some(day => day.lunch && day.lunch.name === meal.name)
                   ), 1)[0];
                   
                   let dayDinner = getRandomMeals(availableDinners.filter(meal => 
                       !selectedMeals.some(day => day.dinner && day.dinner.name === meal.name)
                   ), 1)[0];
                   
                   // Fallback if no unique meals left
                   if (!dayBreakfast) dayBreakfast = getRandomMeals(availableBreakfasts, 1)[0];
                   if (!dayLunch) dayLunch = getRandomMeals(availableLunches, 1)[0];
                   if (!dayDinner) dayDinner = getRandomMeals(availableDinners, 1)[0];
                   
                   let dayMeals = {
                       breakfast: dayBreakfast,
                       lunch: dayLunch,
                       dinner: dayDinner
                   };
                   
                   // Add snacks based on meals per day
                   if (mealsPerDay >= 4 && availableSnacks.length > 0) {
                       dayMeals.snack1 = getRandomMeals(availableSnacks, 1)[0];
                   }
                   if (mealsPerDay >= 5 && availableSnacks.length > 1) {
                       dayMeals.snack2 = getRandomMeals(availableSnacks.filter(s => s !== dayMeals.snack1), 1)[0];
                   }
                   if (mealsPerDay >= 6 && availableSnacks.length > 2) {
                       dayMeals.snack3 = getRandomMeals(availableSnacks.filter(s => s !== dayMeals.snack1 && s !== dayMeals.snack2), 1)[0];
                   }
                   
                   selectedMeals.push(dayMeals);
                   
                   // Create day header
                   const dayHeader = document.createElement('div');
                   dayHeader.className = i === 0 ? 'day-header' : 'day-header collapsed';
                   dayHeader.textContent = `Day ${i + 1} - ${dayName}`;
                   
                   // Create day meals container
                   const dayMealsContainer = document.createElement('div');
                   dayMealsContainer.className = 'day-meals';
                   dayMealsContainer.style.display = i === 0 ? 'grid' : 'none';
                   
                   // Add meals to container
                   Object.entries(dayMeals).forEach(([mealType, meal]) => {
                       if (meal) {
                           const mealCard = document.createElement('div');
                           mealCard.className = 'meal-card';
                           
                           const mealName = mealType === 'snack1' ? 'Morning Snack' : 
                                          mealType === 'snack2' ? 'Afternoon Snack' : 
                                          mealType === 'snack3' ? 'Evening Snack' : 
                                          mealType.charAt(0).toUpperCase() + mealType.slice(1);
                           
                           mealCard.innerHTML = `
                               <h5>${mealName}</h5>
                               <ul>
                                   ${meal.items.map(item => `<li>${item}</li>`).join('')}
                               </ul>
                               <div class="meal-macros">
                                   <div>Calories: <span>${meal.calories}</span></div>
                                   <div>Protein: <span>${meal.protein}g</span></div>
                                   <div>Carbs: <span>${meal.carbs}g</span></div>
                                   <div>Fat: <span>${meal.fat}g</span></div>
                               </div>
                           `;
                           
                           dayMealsContainer.appendChild(mealCard);
                       }
                   });
                   
                   daysContainer.appendChild(dayHeader);
                   daysContainer.appendChild(dayMealsContainer);
               }
               
               // Generate shopping list
               generateShoppingListUI(selectedMeals);
               
               // Update meal prep tips
               updateMealPrepTips(mealPrepPreference, timeAvailable, budget);
           }
           
           // Function to generate shopping list UI
           function generateShoppingListUI(selectedMeals) {
               const shoppingList = generateShoppingList(selectedMeals);
               const container = document.getElementById('shopping-categories-container');
               
               container.innerHTML = `
                   <div class="shopping-categories">
                       <div class="shopping-category">
                           <h5>Proteins</h5>
                           <ul>
                               ${shoppingList.proteins.length > 0 ? shoppingList.proteins.map(item => `<li>${item}</li>`).join('') : '<li>No protein items needed</li>'}
                           </ul>
                       </div>
                       <div class="shopping-category">
                           <h5>Grains & Starches</h5>
                           <ul>
                               ${shoppingList.grains.length > 0 ? shoppingList.grains.map(item => `<li>${item}</li>`).join('') : '<li>No grain items needed</li>'}
                           </ul>
                       </div>
                       <div class="shopping-category">
                           <h5>Fruits & Vegetables</h5>
                           <ul>
                               ${shoppingList.produce.length > 0 ? shoppingList.produce.map(item => `<li>${item}</li>`).join('') : '<li>No produce items needed</li>'}
                           </ul>
                       </div>
                       <div class="shopping-category">
                           <h5>Pantry Items</h5>
                           <ul>
                               ${shoppingList.pantry.length > 0 ? shoppingList.pantry.map(item => `<li>${item}</li>`).join('') : '<li>No pantry items needed</li>'}
                           </ul>
                       </div>
                   </div>
               `;
           }
           
           // Function to update meal prep tips based on preferences
           function updateMealPrepTips(mealPrepPreference, timeAvailable, budget) {
               const prepStrategyText = document.getElementById('prep-strategy-text');
               const prepTipsList = document.getElementById('prep-tips-list');
               
               let tips = [];
               let strategyText = '';
               
               // Base tips on meal prep preference
               switch(mealPrepPreference) {
                   case 'daily':
                       strategyText = 'Based on your preference for daily cooking, here are efficient strategies:';
                       tips = [
                           '<strong>Morning Prep (10 mins):</strong> Prepare ingredients the night before for quick assembly.',
                           '<strong>One-Pot Meals:</strong> Focus on simple recipes that minimize cleanup.',
                           '<strong>Quick Proteins:</strong> Keep easy proteins like eggs, canned tuna, and pre-cooked options.',
                           '<strong>Batch Basics:</strong> Cook larger portions of grains on weekends for the week.',
                           '<strong>Smart Snacks:</strong> Prepare grab-and-go options in advance.'
                       ];
                       break;
                   case 'weekly':
                       strategyText = 'Based on your weekly meal prep preference, here\'s an optimized schedule:';
                       tips = [
                           '<strong>Sunday Prep (3-4 hours):</strong> Cook all proteins, grains, and vegetables for the week.',
                           '<strong>Portion Control:</strong> Divide meals into containers immediately after cooking.',
                           '<strong>Strategic Storage:</strong> Keep wet and dry ingredients separate until eating.',
                           '<strong>Freezer Friendly:</strong> Prepare extra portions for future weeks.',
                           '<strong>Fresh Elements:</strong> Add fresh ingredients just before eating.'
                       ];
                       break;
                   default: // batch
                       strategyText = 'Based on your batch cooking preference, here\'s a recommended schedule:';
                       tips = [
                           '<strong>Sunday Prep (2 hours):</strong> Cook grains and proteins, prep vegetables.',
                           '<strong>Wednesday Refresh (30 mins):</strong> Cook fresh proteins for the week\'s second half.',
                           '<strong>Breakfast Batch:</strong> Prepare 3-4 days of overnight oats or smoothie packs.',
                           '<strong>Salad Strategy:</strong> Wash and chop vegetables, store components separately.',
                           '<strong>Freezer Storage:</strong> Freeze extra portions for busy weeks.'
                       ];
               }
               
               // Add time-specific tips
               if (timeAvailable === 'minimal') {
                   tips.push('<strong>Time-Saver:</strong> Focus on no-cook and microwave-friendly options during busy periods.');
               } else if (timeAvailable === 'flexible') {
                   tips.push('<strong>Advanced Prep:</strong> Use your extra time to make homemade sauces and marinades.');
               }
               
               // Add budget-specific tips
               if (budget === 'tight') {
                   tips.push('<strong>Budget Tip:</strong> Buy in bulk, use seasonal produce, and prioritize versatile ingredients.');
               } else if (budget === 'flexible') {
                   tips.push('<strong>Quality Focus:</strong> Invest in organic produce and premium proteins for optimal nutrition.');
               }
               
               prepStrategyText.textContent = strategyText;
               prepTipsList.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
           }
           
           // Handle action buttons
           document.getElementById('save-meal-plan').addEventListener('click', function() {
               const saveButton = this;
               saveButton.disabled = true;
               saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
               
               setTimeout(() => {
                   saveButton.disabled = false;
                   saveButton.innerHTML = '<i class="fas fa-save"></i> Save Plan';
                   
                   if (isLoggedIn) {
                       showSuccess('Meal plan saved to your profile!');
                   } else {
                       showError('Please log in to save your meal plan.');
                   }
               }, 1000);
           });
           
           document.getElementById('print-meal-plan').addEventListener('click', function() {
               window.print();
           });
           
           document.getElementById('regenerate-plan').addEventListener('click', function() {
               if (!validateForm()) {
                   showError('Please fill in all required fields before regenerating.');
                   return;
               }
               
               mealPlanResults.style.display = 'none';
               loadingSpinner.classList.add('active');
               
               setTimeout(function() {
                   try {
                       generateMealPlan();
                       loadingSpinner.classList.remove('active');
                       mealPlanResults.style.display = 'block';
                       showSuccess('Your meal plan has been regenerated with new variety!');
                   } catch (error) {
                       loadingSpinner.classList.remove('active');
                       showError('There was an error regenerating your meal plan. Please try again.');
                       console.error('Meal plan regeneration error:', error);
                   }
               }, 1500);
           });
           
           // Real-time form validation
           document.getElementById('calories').addEventListener('input', function() {
               const value = parseInt(this.value);
               if (value && (value < 1200 || value > 5000)) {
                   this.classList.add('form-validation-error');
               } else {
                   this.classList.remove('form-validation-error');
               }
           });
           
           // Remove validation error styling when user starts typing
           document.querySelectorAll('input, select, textarea').forEach(field => {
               field.addEventListener('input', function() {
                   if (this.value.trim()) {
                       this.classList.remove('form-validation-error');
                   }
               });
           });
           
           // Auto-save form data
           function saveFormData() {
               const formData = new FormData(mealPlanForm);
               const formObject = {};
               
               for (let [key, value] of formData.entries()) {
                   if (formObject[key]) {
                       if (Array.isArray(formObject[key])) {
                           formObject[key].push(value);
                       } else {
                           formObject[key] = [formObject[key], value];
                       }
                   } else {
                       formObject[key] = value;
                   }
               }
               
               const mealPrepRadio = document.querySelector('input[name="meal-prep"]:checked');
               if (mealPrepRadio) {
                   formObject['meal-prep'] = mealPrepRadio.value;
               }
               
               localStorage.setItem('mealPlanFormData', JSON.stringify(formObject));
           }
           
           function loadFormData() {
               const savedData = localStorage.getItem('mealPlanFormData');
               if (savedData) {
                   try {
                       const formData = JSON.parse(savedData);
                       
                       Object.keys(formData).forEach(key => {
                           const element = document.getElementById(key) || document.querySelector(`[name="${key}"]`);
                           if (element) {
                               if (element.type === 'checkbox') {
                                   const checkboxes = document.querySelectorAll(`[name="${key}"]`);
                                   const values = Array.isArray(formData[key]) ? formData[key] : [formData[key]];
                                   checkboxes.forEach(cb => {
                                       cb.checked = values.includes(cb.value);
                                   });
                               } else if (element.type === 'radio') {
                                   const radio = document.querySelector(`[name="${key}"][value="${formData[key]}"]`);
                                   if (radio) radio.checked = true;
                               } else {
                                   element.value = formData[key];
                               }
                           }
                       });
                   } catch (error) {
                       console.error('Error loading saved form data:', error);
                   }
               }
           }
           
           // Load saved form data on page load
           loadFormData();
           
           // Save form data when user makes changes
           mealPlanForm.addEventListener('input', saveFormData);
           mealPlanForm.addEventListener('change', saveFormData);
           
           // Clear saved form data when form is successfully submitted
           mealPlanForm.addEventListener('submit', function() {
               setTimeout(() => {
                   localStorage.removeItem('mealPlanFormData');
               }, 2000);
           });
           
           // Keyboard accessibility
           document.addEventListener('keydown', function(e) {
               if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('day-header')) {
                   e.preventDefault();
                   e.target.click();
               }
           });
           
           // Error handling
           window.addEventListener('error', function(e) {
               console.error('Application error:', e.error);
               showError('An unexpected error occurred. Please refresh the page and try again.');
           });
           
           window.addEventListener('unhandledrejection', function(e) {
               console.error('Unhandled promise rejection:', e.reason);
               showError('An unexpected error occurred. Please refresh the page and try again.');
           });
       });
   </script>
<script src="class-management.js"></script> <script src="js/flexible-mobile-nav.js"></script> </body>
</html>