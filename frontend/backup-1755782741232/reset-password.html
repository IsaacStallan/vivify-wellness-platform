<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Vivify</title>
    
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<!-- CSS Loading Order Fix -->

<link rel="stylesheet" href="styles.css">

<!-- FOUC Prevention -->
<style>
    html { visibility: hidden; opacity: 0; }
    html.loaded { visibility: visible; opacity: 1; transition: opacity 0.3s ease; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.documentElement.classList.add('loaded');
    });
    window.addEventListener('load', function() {
        document.documentElement.classList.add('loaded');
    });
</script>
<script src="js/vivify-stats.js"></script>
<script src="js/leaderboard-system.js"></script>
</head>
<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="left-nav">
                    <div class="logo">
                        <a href="index.html"><h1>Vivify</h1></a>
                    </div>
                    <ul>
                        <li><a href="about.html" aria-label="About Us Page">About</a></li>
                    </ul>
                </div>
                <div class="right-nav">
                    <ul>
                        <li><a href="login.html" id="loginLink" aria-label="Login Page">Login</a></li>
                        <li><a href="signup.html" id="signupLink" aria-label="Sign Up Page">Sign Up</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <main>
            <section class="form-section">
                <div class="form-container">
                    <form id="resetPasswordForm">
                        <h1>Reset Your Password</h1>
                        <p>Please enter your new password below.</p>

                        <label for="password">New Password</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            required 
                            placeholder="Enter your new password" 
                            aria-label="New Password">
                        <p class="password-hint">Password must be at least 8 characters, include an uppercase letter, and a number.</p>

                        <label for="confirmPassword">Confirm Password</label>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            required 
                            placeholder="Confirm your new password" 
                            aria-label="Confirm Password">

                        <button type="submit">Reset Password</button>
                    </form>

                    <p id="message" style="display:none;"></p>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2024 Vivify. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resetPasswordForm = document.getElementById('resetPasswordForm');
            const messageElement = document.getElementById('message');
            
            // Get token from URL
            const token = window.location.pathname.split('/').pop();
            
            resetPasswordForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // Get form values
                const password = document.getElementById('password').value.trim();
                const confirmPassword = document.getElementById('confirmPassword').value.trim();
                
                // Validate passwords
                if (password !== confirmPassword) {
                    messageElement.textContent = 'Passwords do not match.';
                    messageElement.style.color = 'red';
                    messageElement.style.display = 'block';
                    return;
                }
                
                // Validate password complexity
                if (password.length < 8 || !/[A-Z]/.test(password) || !/\d/.test(password)) {
                    messageElement.textContent = 'Password must be at least 8 characters, include an uppercase letter, and a number.';
                    messageElement.style.color = 'red';
                    messageElement.style.display = 'block';
                    return;
                }
                
                try {
                    const response = await fetch(`/auth/reset-password/${token}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ password })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Password reset successful
                        messageElement.textContent = data.message || 'Password reset successful! Redirecting to login page...';
                        messageElement.style.color = 'green';
                        messageElement.style.display = 'block';
                        
                        // Redirect to login page after a delay
                        setTimeout(() => {
                            window.location.href = '/login.html?message=password-reset';
                        }, 3000);
                    } else {
                        // Display error message
                        messageElement.textContent = data.message || 'Failed to reset password. Please try again.';
                        messageElement.style.color = 'red';
                        messageElement.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Password reset error:', error);
                    messageElement.textContent = 'A network error occurred. Please try again.';
                    messageElement.style.color = 'red';
                    messageElement.style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
