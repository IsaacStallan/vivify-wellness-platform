<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal Editor - Vivify</title>
    
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Add Font Awesome for icons -->
    
    <style>
        /* Footer styles to ensure it stays at bottom */
        footer {
            background-color: #000;
            color: white;
            text-align: center;
            padding: 2rem 0;
            width: 100%;
            margin-top: auto;
            border-top: 1px solid #333;
        }

        footer .footer-links {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1rem 0 0 0;
            padding: 0;
        }

        footer .footer-links a {
            color: #a0a0a0;
            text-decoration: none;
            transition: color 0.3s;
        }

        footer .footer-links a:hover {
            color: #f39c12;
        }
        
        /* Journal Editor specific styles */
        .editor-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            display: flex;
            gap: 2rem;
        }
        
        .sidebar {
            width: 300px;
            background-color: #222;
            border-radius: 10px;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }
        
        .sidebar-header {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #333;
            padding-bottom: 1rem;
        }
        
        .sidebar-header h2 {
            color: #f39c12;
            margin-bottom: 0.5rem;
            font-size: 1.4rem;
        }
        
        .sidebar-prompt {
            color: #ddd;
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        .sidebar-section {
            margin-bottom: 1.5rem;
        }
        
        .sidebar-section h3 {
            color: #f39c12;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }
        
        .time-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .timer {
            font-size: 1.2rem;
            color: white;
            font-weight: bold;
        }
        
        .timer-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .timer-btn {
            background-color: #333;
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .timer-btn:hover {
            background-color: #444;
        }
        
        .timer-btn.start {
            background-color: #27ae60;
        }
        
        .timer-btn.start:hover {
            background-color: #2ecc71;
        }
        
        .timer-btn.pause {
            background-color: #f39c12;
        }
        
        .timer-btn.pause:hover {
            background-color: #e67e22;
        }
        
        .timer-btn.stop {
            background-color: #e74c3c;
        }
        
        .timer-btn.stop:hover {
            background-color: #c0392b;
        }
        
        .timer-preset {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .preset-btn {
            background-color: #333;
            border: none;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 0.8rem;
        }
        
        .preset-btn:hover {
            background-color: #444;
        }
        
        .mood-tracker {
            margin-bottom: 1.5rem;
        }
        
        .mood-options {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .mood-option {
            background: none;
            border: none;
            color: #ddd;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mood-option:hover {
            transform: scale(1.2);
        }
        
        .mood-option.selected {
            color: #f39c12;
            transform: scale(1.2);
        }
        
        .tags-container {
            margin-top: 0.5rem;
        }
        
        .tags-input {
            background-color: #333;
            border: none;
            border-radius: 5px;
            padding: 0.5rem;
            color: white;
            width: 100%;
            margin-bottom: 0.5rem;
        }
        
        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tag {
            background-color: #444;
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .tag .remove-tag {
            background: none;
            border: none;
            color: #ddd;
            cursor: pointer;
            font-size: 0.7rem;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sidebar-actions {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .sidebar-btn {
            background-color: #333;
            border: none;
            color: white;
            padding: 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .sidebar-btn:hover {
            background-color: #444;
        }
        
        .sidebar-btn.primary {
            background-color: #f39c12;
            color: black;
            font-weight: 500;
        }
        
        .sidebar-btn.primary:hover {
            background-color: #e67e22;
        }
        
        .editor-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .editor-header {
            background-color: #222;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .editor-title {
            font-size: 1.8rem;
            color: #f39c12;
            margin-bottom: 0.5rem;
        }
        
        .editor-meta {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .word-counter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .editor-textarea {
            background-color: #222;
            border-radius: 10px;
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .journal-title {
            background-color: #333;
            border: none;
            border-radius: 5px;
            padding: 0.8rem;
            color: white;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            width: 100%;
        }
        
        .journal-content {
            background-color: #333;
            border: none;
            border-radius: 5px;
            padding: 1rem;
            color: white;
            font-size: 1rem;
            line-height: 1.6;
            height: 500px;
            resize: vertical;
            width: 100%;
            font-family: 'Roboto', sans-serif;
        }
        
        .journal-content:focus, .journal-title:focus {
            outline: none;
            border: 1px solid #f39c12;
        }
        
        .formatting-toolbar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .format-btn {
            background-color: #333;
            border: none;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .format-btn:hover {
            background-color: #444;
        }
        
        .format-btn.active {
            background-color: #f39c12;
            color: black;
        }
        
        .auto-save-status {
            color: #aaa;
            font-size: 0.9rem;
            text-align: right;
            margin-top: 1rem;
        }
        
        .success-message {
            background-color: rgba(39, 174, 96, 0.2);
            border: 1px solid #27ae60;
            border-radius: 5px;
            padding: 1rem;
            color: #2ecc71;
            margin-bottom: 1.5rem;
            display: none;
        }
        
        .prompt-reflection {
            background-color: #222;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .reflection-title {
            color: #f39c12;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .reflection-questions {
            margin-bottom: 1rem;
        }
        
        .reflection-question {
            color: #ddd;
            margin-bottom: 0.5rem;
        }
        
        .reflection-actions {
            display: flex;
            justify-content: flex-end;
        }
        
        @media (max-width: 992px) {
            .editor-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
            }
        }
    </style>
<!-- CSS Loading Order Fix -->

<link rel="stylesheet" href="styles.css">

<!-- FOUC Prevention -->
<style>
    html { visibility: hidden; opacity: 0; }
    html.loaded { visibility: visible; opacity: 1; transition: opacity 0.3s ease; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.documentElement.classList.add('loaded');
    });
    window.addEventListener('load', function() {
        document.documentElement.classList.add('loaded');
    });
</script>
<script 
    src="js/vivify-stats.js"
    src="js/leaderboard-system.js">
</script>  
</head>
<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="left-nav">
                    <div class="logo">
                        <a href="index.html" aria-label="Home Page"><h1>Vivify</h1></a>
                    </div>
                    <ul>
                        <li><a href="about.html" aria-label="About Us Page">About</a></li>
                        <li class="dropdown" id="categoryDropdown">
                            <a href="#" class="dropbtn" aria-label="Categories Dropdown">Training</a>
                            <div class="dropdown-content">
                                <a href="fitness.html" aria-label="Fitness Page">Fitness</a>
                                <a href="nutrition.html" aria-label="Nutrition Page">Nutrition</a>
                                <a href="focus-resilience.html" class="active" aria-label="Focus & Resilience Page">Focus & Resilience</a>
                                <a href="life-mastery.html" aria-label="Life Lessons Page">Life Mastery</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="right-nav">
                    <ul>
                        <li><a href="dashboard.html" id="dashboardLink" aria-label="Dashboard">Performance Hub</a></li>
                        <li><a href="profile.html" id="profileLink" aria-label="Profile Page">Profile</a></li>
                        <li><a href="#" id="logoutLink" aria-label="Logout">Logout</a></li>
                        <li><a href="login.html" id="loginLink" style="display: none;" aria-label="Login Page">Login</a></li>
                        <li><a href="signup.html" id="signupLink" style="display: none;" aria-label="Sign Up Page">Sign Up</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <div class="content-container">
            <div id="successMessage" class="success-message">
                <i class="fas fa-check-circle"></i> Your journal entry has been saved successfully!
            </div>
            
            <div class="editor-container">
                <!-- Sidebar with tools and prompt -->
                <div class="sidebar">
                    <div class="sidebar-header">
                        <h2>Journal Prompt</h2>
                        <p id="promptText" class="sidebar-prompt">Loading prompt...</p>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-stopwatch"></i> Timer</h3>
                        <div class="time-container">
                            <div id="timer" class="timer">00:00</div>
                            <div class="timer-controls">
                                <button id="startTimerBtn" class="timer-btn start"><i class="fas fa-play"></i></button>
                                <button id="pauseTimerBtn" class="timer-btn pause" disabled><i class="fas fa-pause"></i></button>
                                <button id="stopTimerBtn" class="timer-btn stop" disabled><i class="fas fa-stop"></i></button>
                            </div>
                        </div>
                        <div class="timer-preset">
                            <button class="preset-btn" data-time="5">5 min</button>
                            <button class="preset-btn" data-time="10">10 min</button>
                            <button class="preset-btn" data-time="15">15 min</button>
                            <button class="preset-btn" data-time="20">20 min</button>
                        </div>
                    </div>
                    
                    <div class="sidebar-section mood-tracker">
                        <h3><i class="fas fa-smile"></i> Mood Tracker</h3>
                        <p>How are you feeling today?</p>
                        <div class="mood-options">
                            <button class="mood-option" data-mood="Very Happy"><i class="fas fa-laugh-beam"></i></button>
                            <button class="mood-option" data-mood="Happy"><i class="fas fa-smile"></i></button>
                            <button class="mood-option" data-mood="Neutral"><i class="fas fa-meh"></i></button>
                            <button class="mood-option" data-mood="Sad"><i class="fas fa-frown"></i></button>
                            <button class="mood-option" data-mood="Very Sad"><i class="fas fa-sad-tear"></i></button>
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3><i class="fas fa-tags"></i> Tags</h3>
                        <div class="tags-container">
                            <input type="text" id="tagInput" class="tags-input" placeholder="Add tags (press Enter)">
                            <div id="tagsList" class="tags-list">
                                <!-- Tags will be added here dynamically -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="sidebar-actions">
                        <button id="saveEntryBtn" class="sidebar-btn primary"><i class="fas fa-save"></i> Save Entry</button>
                        <button id="viewEntriesBtn" class="sidebar-btn"><i class="fas fa-book"></i> View All Entries</button>
                        <button id="newPromptBtn" class="sidebar-btn"><i class="fas fa-random"></i> Try Another Prompt</button>
                    </div>
                </div>
                
                <!-- Main editor area -->
                <div class="editor-main">
                    <div class="editor-header">
                        <h1 class="editor-title">Create New Journal Entry</h1>
                        <div class="editor-meta">
                            <div id="currentDate"></div>
                            <div id="wordCounter" class="word-counter">
                                <i class="fas fa-font"></i> <span id="wordCount">0</span> words
                            </div>
                        </div>
                    </div>
                    
                    <div class="editor-textarea">
                        <div class="formatting-toolbar">
                            <button class="format-btn" title="Bold" data-format="bold"><i class="fas fa-bold"></i></button>
                            <button class="format-btn" title="Italic" data-format="italic"><i class="fas fa-italic"></i></button>
                            <button class="format-btn" title="Underline" data-format="underline"><i class="fas fa-underline"></i></button>
                            <button class="format-btn" title="Strikethrough" data-format="strikethrough"><i class="fas fa-strikethrough"></i></button>
                            <button class="format-btn" title="Bullet List" data-format="bullet"><i class="fas fa-list-ul"></i></button>
                            <button class="format-btn" title="Numbered List" data-format="number"><i class="fas fa-list-ol"></i></button>
                            <button class="format-btn" title="Heading" data-format="heading"><i class="fas fa-heading"></i></button>
                            <button class="format-btn" title="Quote" data-format="quote"><i class="fas fa-quote-right"></i></button>
                        </div>
                        
                        <input type="text" id="journalTitle" class="journal-title" placeholder="Give your entry a title...">
                        <textarea id="journalContent" class="journal-content" placeholder="Start writing here..."></textarea>
                        
                        <div id="autoSaveStatus" class="auto-save-status">
                            <i class="fas fa-sync-alt"></i> Auto-saving...
                        </div>
                    </div>
                    
                    <div class="prompt-reflection">
                        <h2 class="reflection-title"><i class="fas fa-lightbulb"></i> Reflection Questions</h2>
                        <div class="reflection-questions">
                            <p class="reflection-question">1. What was the most significant insight you gained from this journaling session?</p>
                            <p class="reflection-question">2. Did anything surprise you about what you wrote?</p>
                            <p class="reflection-question">3. What action or change might you consider based on today's reflection?</p>
                        </div>
                        <div class="reflection-actions">
                            <button id="includeReflectionBtn" class="sidebar-btn">Include These Reflections</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>&copy; 2024 Vivify. All rights reserved.</p>
            <ul class="footer-links">
                <li><a href="privacy.html" aria-label="Privacy Policy">Privacy Policy</a></li>
                <li><a href="terms.html" aria-label="Terms of Service">Terms of Service</a></li>
                <li><a href="contact.html" aria-label="Contact Us">Contact Us</a></li>
            </ul>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const isLoggedIn = localStorage.getItem('userLoggedIn') === 'true';
            
            // Update UI based on login status
            const loginLink = document.getElementById('loginLink');
            const signupLink = document.getElementById('signupLink');
            const logoutLink = document.getElementById('logoutLink');
            const profileLink = document.getElementById('profileLink');
            const dashboardLink = document.getElementById('dashboardLink');
            
            if (loginLink) loginLink.style.display = isLoggedIn ? 'none' : 'inline';
            if (signupLink) signupLink.style.display = isLoggedIn ? 'none' : 'inline';
            if (logoutLink) logoutLink.style.display = isLoggedIn ? 'inline' : 'none';
            if (profileLink) profileLink.style.display = isLoggedIn ? 'inline' : 'none';
            if (dashboardLink) dashboardLink.style.display = isLoggedIn ? 'inline' : 'none';
            
            // Handle logout
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('userLoggedIn');
                    localStorage.removeItem('authToken');
                    window.location.href = 'index.html';
                });
            }
            
            // Set current date
            const currentDateElement = document.getElementById('currentDate');
            if (currentDateElement) {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                currentDateElement.textContent = now.toLocaleDateString('en-US', options);
            }
            
            // Parse URL parameters to get prompt
            const urlParams = new URLSearchParams(window.location.search);
            const promptKey = urlParams.get('prompt');
            let promptContent = urlParams.get('content');
            const promptElement = document.getElementById('promptText');
            
            // Load prompt based on URL parameter or use default
            if (promptKey && promptElement) {
                if (promptContent) {
                    // Custom prompt was passed directly
                    promptElement.textContent = promptContent;
                } else {
                    // Load prompt based on key
                const prompts = {
                    'worry-download': 'Write down everything that\'s worrying you right now, big or small. Don\'t judge or analyze—just let it all flow onto the page. When you\'ve written everything, take a deep breath and ask yourself: "Which of these concerns can I address today, and which ones need to be set aside for now?"',
                    'stress-reframing': 'Describe a current stressful academic situation you\'re facing (an upcoming exam, difficult assignment, etc.). Write about it in detail. Then, rewrite the same situation from the perspective of someone who sees this challenge as an opportunity for growth. How might this new perspective change your approach?',
                    'future-self': 'Write a letter from your future self (1 year from now) to your current self about the situation that\'s causing you anxiety right now. How did things work out? What advice would your future self give you about what you\'re experiencing? What did you learn from this experience?',
                    'values-exploration': 'List 5-10 values that are most important to you (such as authenticity, compassion, achievement, creativity, etc.). For each value, describe: 1) Why this matters to you, 2) A time when you honored this value, and 3) How this value influences your choices as a student.',
                    'strengths-inventory': 'Reflect on your personal strengths and qualities. Write about: 1) Three strengths that come naturally to you, 2) A strength you\'ve developed through effort and practice, 3) A strength others see in you that you don\'t always recognize, and 4) How you could use these strengths more intentionally in your academic life.',
                    'identity-exploration': 'Complete the sentence "I am..." 15-20 times, writing whatever comes to mind. Include roles, qualities, beliefs, interests, cultural identities, etc. Then reflect: Which of these identities feel most central to who you are? Which ones are imposed by others? Which ones are you growing into or out of during this stage of life?',
                    'learning-reflection': 'Think about a concept or skill you recently mastered. Write about: 1) The specific strategies that helped you learn it, 2) Obstacles you encountered and how you overcame them, 3) How this learning connects to other knowledge you have, and 4) How you\'ll approach similar learning challenges in the future.',
                    'motivation-dive': 'Write about your academic goals by exploring: 1) What specifically you want to achieve this term/year, 2) WHY these goals matter to you personally (go deeper than "to get a good job"), 3) How these goals connect to your values and larger life purpose, and 4) What intrinsically motivates you about your field of study beyond grades or external rewards.',
                    'failure-analysis': 'Describe an academic setback or "failure" you experienced recently. Analyze it by exploring: 1) What specifically happened, 2) Factors that contributed to the outcome (both within and outside your control), 3) What you learned from this experience, and 4) How you\'ll apply these insights to future similar situations.',
                    'emotional-weather': 'Describe your current emotional state as a weather report. What\'s the climate of your inner world right now? Is there sunshine, storms, fog, or changing conditions? What factors are influencing this weather? Is there a forecast for how it might change later today or tomorrow?',
                    'compassion-letter': 'Write a letter to yourself from the perspective of a wise, compassionate friend who knows you well and cares about you deeply. What would this friend say about the challenges you\'re facing right now? What words of understanding, comfort, and encouragement would they offer? How would they remind you of your worth and capabilities?',
                    'inner-critic': 'Write out what your inner critic is saying about a recent mistake or challenge. Then, write a response from your compassionate self that acknowledges the concern but offers a more balanced, kind perspective. What wisdom does your compassionate self have that your inner critic is missing?',
                    'relationship-appreciation': 'Write about a person in your life who has positively influenced your college experience. What specific qualities do you appreciate about them? What have they taught you? How have they supported you? What impact have they had on your growth or wellbeing?',
                    'boundary-exploration': 'Reflect on your boundaries in relationships by exploring: 1) A situation where you need stronger boundaries, 2) What makes setting boundaries difficult for you, 3) How you feel when your boundaries are respected vs. crossed, and 4) One boundary you want to establish or strengthen moving forward.',
                    'community-belonging': 'Write about places or groups where you feel a sense of belonging and acceptance. What qualities make these environments feel safe and welcoming? What parts of yourself do you feel free to express in these contexts? If you\'re still seeking your community on campus, what kind of connection are you looking for?'
                };

                promptElement.textContent = prompts[promptKey] || 'Write freely about whatever is on your mind today...';
                }
            } else if (promptElement) {
                // Default prompt if none specified
                promptElement.textContent = 'Write freely about whatever is on your mind today...';
            }
            
                // Timer functionality
            let timerInterval;
            let timerSeconds = 0;
            let timerRunning = false;
            const timerElement = document.getElementById('timer');
            const startTimerBtn = document.getElementById('startTimerBtn');
            const pauseTimerBtn = document.getElementById('pauseTimerBtn');
            const stopTimerBtn = document.getElementById('stopTimerBtn');

            function updateTimerDisplay() {
                const minutes = Math.floor(timerSeconds / 60);
                const seconds = timerSeconds % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            function startTimer() {
                if (!timerRunning) {
                    timerInterval = setInterval(function() {
                        timerSeconds++;
                        updateTimerDisplay();
                    }, 1000);
                    timerRunning = true;
                    
                    startTimerBtn.disabled = true;
                    pauseTimerBtn.disabled = false;
                    stopTimerBtn.disabled = false;
                }
            }

            function pauseTimer() {
                if (timerRunning) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    
                    startTimerBtn.disabled = false;
                    pauseTimerBtn.disabled = true;
                    stopTimerBtn.disabled = false;
                }
            }

            function stopTimer() {
                clearInterval(timerInterval);
                timerRunning = false;
                timerSeconds = 0;
                updateTimerDisplay();
                
                startTimerBtn.disabled = false;
                pauseTimerBtn.disabled = true;
                stopTimerBtn.disabled = true;
            }

            // Timer button event listeners
            if (startTimerBtn) startTimerBtn.addEventListener('click', startTimer);
            if (pauseTimerBtn) pauseTimerBtn.addEventListener('click', pauseTimer);
            if (stopTimerBtn) stopTimerBtn.addEventListener('click', stopTimer);

            // Timer presets
            const presetButtons = document.querySelectorAll('.preset-btn');
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const minutes = parseInt(this.dataset.time);
                    timerSeconds = 0;
                    updateTimerDisplay();
                    
                    // Start countdown timer
                    stopTimer();
                    timerSeconds = minutes * 60;
                    updateTimerDisplay();
                    
                    // Convert to countdown
                    clearInterval(timerInterval);
                    timerInterval = setInterval(function() {
                        timerSeconds--;
                        updateTimerDisplay();
                        
                        if (timerSeconds <= 0) {
                            clearInterval(timerInterval);
                            timerRunning = false;
                            startTimerBtn.disabled = false;
                            pauseTimerBtn.disabled = true;
                            stopTimerBtn.disabled = true;
                            
                            // Alert user that time is up
                            alert('Time is up! You\'ve completed your journaling session.');
                        }
                    }, 1000);
                    timerRunning = true;
                    
                    startTimerBtn.disabled = true;
                    pauseTimerBtn.disabled = false;
                    stopTimerBtn.disabled = false;
                });
            });
            
            // Mood tracker functionality
            const moodButtons = document.querySelectorAll('.mood-option');
            let selectedMood = null;
            
            moodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove selected class from all buttons
                    moodButtons.forEach(btn => btn.classList.remove('selected'));
                    
                    // Add selected class to clicked button
                    this.classList.add('selected');
                    
                    // Store selected mood
                    selectedMood = this.dataset.mood;
                });
            });
            
            // Tags functionality
            const tagInput = document.getElementById('tagInput');
            const tagsList = document.getElementById('tagsList');
            let tags = [];
            
            if (tagInput) {
                tagInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const tag = this.value.trim();
                        
                        if (tag && !tags.includes(tag)) {
                            tags.push(tag);
                            renderTags();
                            this.value = '';
                        }
                    }
                });
            }
            
            function renderTags() {
                if (!tagsList) return;
                
                tagsList.innerHTML = '';
                
                tags.forEach((tag, index) => {
                    const tagElement = document.createElement('div');
                    tagElement.className = 'tag';
                    tagElement.innerHTML = `
                        ${tag}
                        <button class="remove-tag" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    tagsList.appendChild(tagElement);
                });
                
                // Add event listeners to remove buttons
                const removeButtons = document.querySelectorAll('.remove-tag');
                removeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        tags.splice(index, 1);
                        renderTags();
                    });
                });
            }
            
            // Word counter functionality
            const journalContent = document.getElementById('journalContent');
            const wordCountElement = document.getElementById('wordCount');
            
            function updateWordCount() {
                if (!journalContent || !wordCountElement) return;
                
                const text = journalContent.value.trim();
                const wordCount = text ? text.split(/\s+/).length : 0;
                wordCountElement.textContent = wordCount;
            }
            
            if (journalContent) {
                journalContent.addEventListener('input', updateWordCount);
            }
            
            // Text formatting toolbar functionality
            const formatButtons = document.querySelectorAll('.format-btn');
            
            formatButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (!journalContent) return;
                    
                    const format = this.dataset.format;
                    const startPos = journalContent.selectionStart;
                    const endPos = journalContent.selectionEnd;
                    const selectedText = journalContent.value.substring(startPos, endPos);
                    
                    let formattedText = '';
                    
                    switch (format) {
                        case 'bold':
                            formattedText = `**${selectedText}**`;
                            break;
                        case 'italic':
                            formattedText = `*${selectedText}*`;
                            break;
                        case 'underline':
                            formattedText = `_${selectedText}_`;
                            break;
                        case 'strikethrough':
                            formattedText = `~~${selectedText}~~`;
                            break;
                        case 'bullet':
                            formattedText = selectedText.split('\n').map(line => `• ${line}`).join('\n');
                            break;
                        case 'number':
                            formattedText = selectedText.split('\n').map((line, i) => `${i+1}. ${line}`).join('\n');
                            break;
                        case 'heading':
                            formattedText = `## ${selectedText}`;
                            break;
                        case 'quote':
                            formattedText = `> ${selectedText}`;
                            break;
                    }
                    
                    // Replace selected text with formatted text
                    journalContent.value = journalContent.value.substring(0, startPos) + formattedText + journalContent.value.substring(endPos);
                    
                    // Update focus and selection
                    journalContent.focus();
                    journalContent.setSelectionRange(startPos, startPos + formattedText.length);
                    
                    // Toggle active state for the button
                    this.classList.toggle('active');
                    
                    // Update word count
                    updateWordCount();
                });
            });
            
            // Auto-save functionality
            const autoSaveStatus = document.getElementById('autoSaveStatus');
            let autoSaveTimeout;
            let lastSavedContent = '';
            
            function autoSave() {
                if (!journalContent || !autoSaveStatus) return;
                
                const currentContent = journalContent.value;
                
                // Only save if content has changed
                if (currentContent !== lastSavedContent) {
                    // Update status to saving
                    autoSaveStatus.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Auto-saving...';
                    
                    // Simulate saving (in a real app, this would be an API call)
                    setTimeout(() => {
                        lastSavedContent = currentContent;
                        
                        // Save to localStorage
                        const journalTitle = document.getElementById('journalTitle').value;
                        const journalEntry = {
                            id: Date.now().toString(),
                            title: journalTitle || 'Untitled Entry',
                            content: currentContent,
                            prompt: document.getElementById('promptText').textContent,
                            date: new Date().toISOString(),
                            wordCount: parseInt(wordCountElement.textContent),
                            mood: selectedMood,
                            tags: [...tags],
                            duration: timerSeconds
                        };
                        
                        // Get existing entries or initialize empty array
                        let journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                        
                        // Find if we already have a temporary entry for this session
                        const tempEntryIndex = journalEntries.findIndex(entry => entry.temp === true);
                        
                        if (tempEntryIndex >= 0) {
                            // Update existing temp entry
                            journalEntry.temp = true;
                            journalEntries[tempEntryIndex] = journalEntry;
                        } else {
                            // Add new temp entry
                            journalEntry.temp = true;
                            journalEntries.push(journalEntry);
                        }
                        
                        // Save back to localStorage
                        localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                        
                        // Update status to saved
                        autoSaveStatus.innerHTML = '<i class="fas fa-check"></i> Auto-saved at ' + new Date().toLocaleTimeString();
                    }, 1000);
                }
            }
            
            if (journalContent) {
                journalContent.addEventListener('input', function() {
                    // Clear existing timeout
                    clearTimeout(autoSaveTimeout);
                    
                    // Set new timeout for auto-save (2 seconds after typing stops)
                    autoSaveTimeout = setTimeout(autoSave, 2000);
                });
                
                // Also auto-save when title changes
                document.getElementById('journalTitle').addEventListener('input', function() {
                    clearTimeout(autoSaveTimeout);
                    autoSaveTimeout = setTimeout(autoSave, 2000);
                });
            }
            
            // Save entry functionality
            const saveEntryBtn = document.getElementById('saveEntryBtn');
            const successMessage = document.getElementById('successMessage');
            
            if (saveEntryBtn) {
                saveEntryBtn.addEventListener('click', function() {
                    if (!journalContent) return;
                    
                    const journalTitle = document.getElementById('journalTitle').value;
                    
                    if (!journalTitle.trim()) {
                        alert('Please give your journal entry a title before saving.');
                        document.getElementById('journalTitle').focus();
                        return;
                    }
                    
                    // Get current content
                    const currentContent = journalContent.value;
                    
                    if (!currentContent.trim()) {
                        alert('Please write something in your journal before saving.');
                        journalContent.focus();
                        return;
                    }
                    
                    // Create journal entry object
                    const journalEntry = {
                        id: Date.now().toString(),
                        title: journalTitle,
                        content: currentContent,
                        prompt: document.getElementById('promptText').textContent,
                        date: new Date().toISOString(),
                        wordCount: parseInt(wordCountElement.textContent),
                        mood: selectedMood,
                        tags: [...tags],
                        duration: timerSeconds
                    };
                    
                    // Get existing entries or initialize empty array
                    let journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                    
                    // Remove any temporary entries
                    journalEntries = journalEntries.filter(entry => !entry.temp);
                    
                    // Add new entry
                    journalEntries.push(journalEntry);
                    
                    // Save to localStorage
                    localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                    
                    // Show success message
                    if (successMessage) {
                        successMessage.style.display = 'block';
                        setTimeout(() => {
                            successMessage.style.display = 'none';
                        }, 3000);
                    }
                    
                    // Update status
                    if (autoSaveStatus) {
                        autoSaveStatus.innerHTML = '<i class="fas fa-check"></i> Saved at ' + new Date().toLocaleTimeString();
                    }
                    
                    // No longer a temp entry
                    lastSavedContent = currentContent;
                });
            }
            
            // View entries button
            const viewEntriesBtn = document.getElementById('viewEntriesBtn');
            
            if (viewEntriesBtn) {
                viewEntriesBtn.addEventListener('click', function() {
                    window.location.href = 'journal-entries.html';
                });
            }
            
            // New prompt button
            const newPromptBtn = document.getElementById('newPromptBtn');
            
            if (newPromptBtn) {
                newPromptBtn.addEventListener('click', function() {
                    // Confirm before changing prompt if content exists
                    if (journalContent && journalContent.value.trim() && !confirm('Changing the prompt will start a new entry. Your current entry is auto-saved. Continue?')) {
                        return;
                    }
                    
                    window.location.href = 'journal-prompts.html';
                });
            }
            
            // Include reflection questions button
            const includeReflectionBtn = document.getElementById('includeReflectionBtn');
            
            if (includeReflectionBtn && journalContent) {
                includeReflectionBtn.addEventListener('click', function() {
                    const reflectionQuestions = document.querySelectorAll('.reflection-question');
                    let reflectionText = '\n\n## Reflections\n\n';
                    
                    reflectionQuestions.forEach(question => {
                        reflectionText += question.textContent + '\n\n';
                    });
                    
                    // Add to journal content
                    journalContent.value += reflectionText;
                    
                    // Move cursor to after the reflection questions
                    journalContent.focus();
                    journalContent.scrollTop = journalContent.scrollHeight;
                    journalContent.setSelectionRange(journalContent.value.length, journalContent.value.length);
                    
                    // Update word count
                    updateWordCount();
                    
                    // Auto-save
                    clearTimeout(autoSaveTimeout);
                    autoSaveTimeout = setTimeout(autoSave, 500);
                });
            }
            
            // On page load, check for temporary entries to restore
            function loadTempEntry() {
                // Only load if the content area is empty
                if (journalContent && !journalContent.value.trim()) {
                    const journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                    const tempEntry = journalEntries.find(entry => entry.temp === true);
                    
                    if (tempEntry) {
                        // Restore content
                        journalContent.value = tempEntry.content;
                        
                        // Restore title
                        const titleInput = document.getElementById('journalTitle');
                        if (titleInput) {
                            titleInput.value = tempEntry.title;
                        }
                        
                        // Restore tags
                        if (tempEntry.tags) {
                            tags = [...tempEntry.tags];
                            renderTags();
                        }
                        
                        // Restore mood
                        if (tempEntry.mood) {
                            selectedMood = tempEntry.mood;
                            moodButtons.forEach(btn => {
                                if (btn.dataset.mood === selectedMood) {
                                    btn.classList.add('selected');
                                }
                            });
                        }
                        
                        // Update word count
                        updateWordCount();
                        
                        // Update auto-save status
                        if (autoSaveStatus) {
                            autoSaveStatus.innerHTML = '<i class="fas fa-history"></i> Restored from auto-save';
                        }
                        
                        // Set lastSavedContent to prevent immediate auto-save
                        lastSavedContent = tempEntry.content;
                    }
                }
            }
            
            // Load temp entry on page load
            loadTempEntry();
        });
    </script>
</body>
</html>