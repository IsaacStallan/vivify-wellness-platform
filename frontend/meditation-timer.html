<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meditation Timer - Vivify</title>
    
    <!-- Load fonts first -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Load icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .left-nav {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .logo a {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .left-nav ul, .right-nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .left-nav a, .right-nav a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .left-nav a:hover, .right-nav a:hover {
            color: #f39c12;
        }

        .left-nav a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transition: width 0.3s ease;
        }

        .left-nav a:hover::after {
            width: 100%;
        }

        .cta-nav {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000 !important;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .cta-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(243, 156, 18, 0.4);
            color: #000 !important;
        }

        .hidden {
            display: none !important;
        }

        /* Hero Section */
        .meditation-hero {
            background: 
                radial-gradient(circle at 20% 20%, rgba(243, 156, 18, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(230, 126, 34, 0.1) 0%, transparent 50%),
                linear-gradient(rgba(10, 10, 10, 0.8), rgba(10, 10, 10, 0.8)),
                url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            padding: 150px 2rem 6rem;
            text-align: center;
            position: relative;
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content {
            position: relative;
            z-index: 100;
            max-width: 900px;
            margin: 0 auto;
        }

        .meditation-badge {
            display: inline-block;
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            border: 1px solid rgba(243, 156, 18, 0.2);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .meditation-hero h1 {
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 900;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f39c12 50%, #e67e22 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }

        .meditation-hero p {
            font-size: 1.25rem;
            max-width: 700px;
            margin: 0 auto 3rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        /* Timer Container */
        .timer-container {
            max-width: 900px;
            margin: -4rem auto 3rem auto;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 3rem;
            position: relative;
            z-index: 10;
        }

        .timer-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-radius: 24px 24px 0 0;
        }

        /* Program Info */
        .program-info {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 16px;
            border: 1px solid rgba(243, 156, 18, 0.2);
        }

        .program-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f39c12;
            margin-bottom: 0.5rem;
        }

        .program-description {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
        }

        /* Timer Display */
        .timer-display {
            text-align: center;
            margin-bottom: 3rem;
        }

        .time-circle {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .time-circle::before {
            content: '';
            position: absolute;
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: conic-gradient(
                #f39c12 0deg,
                #f39c12 var(--progress, 0deg),
                rgba(255, 255, 255, 0.1) var(--progress, 0deg),
                rgba(255, 255, 255, 0.1) 360deg
            );
            z-index: 1;
        }

        .time-circle::after {
            content: '';
            position: absolute;
            width: 240px;
            height: 240px;
            background: #0a0a0a;
            border-radius: 50%;
            z-index: 2;
        }

        .time-text {
            position: relative;
            z-index: 3;
            font-size: 3.5rem;
            font-weight: 300;
            color: #f39c12;
            text-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
        }

        .timer-status {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
        }

        .session-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Preset Buttons */
        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .preset-btn {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
        }

        .preset-btn:hover {
            background: rgba(243, 156, 18, 0.1);
            border-color: rgba(243, 156, 18, 0.3);
            transform: translateY(-2px);
        }

        .preset-btn.active {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000;
            border-color: transparent;
        }

        .preset-btn i {
            font-size: 1.5rem;
        }

        /* Custom Time */
        .custom-time {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .time-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: border-color 0.3s;
            height: 50px;
        }

        .time-input:focus-within {
            border-color: #f39c12;
        }

        .time-input input {
            background: transparent;
            border: none;
            color: white;
            width: 60px;
            text-align: center;
            font-size: 1.2rem;
            outline: none;
            height: 100%;
            font-family: inherit;
        }

        .time-input label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
        }

        /* Control Buttons */
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000;
            border: none;
            border-radius: 50px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 120px;
            justify-content: center;
            font-family: inherit;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(243, 156, 18, 0.3);
        }

        .control-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .control-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .control-btn.secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* Sound Controls */
        .sound-controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sound-controls h3 {
            color: #f39c12;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .sound-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .sound-option {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sound-option:hover {
            border-color: rgba(243, 156, 18, 0.3);
            background: rgba(243, 156, 18, 0.1);
        }

        .sound-option.active {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000;
            border-color: transparent;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .volume-slider {
            width: 200px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #f39c12;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #f39c12;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Session Complete */
        .session-complete {
            display: none;
            text-align: center;
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.2));
            border: 1px solid rgba(39, 174, 96, 0.3);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin-top: 2rem;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .session-complete.show {
            display: block;
        }

        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f39c12;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Guided Programs */
        .guided-programs {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .guided-programs h2 {
            color: #f39c12;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 800;
        }

        .program-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .program-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .program-card:hover {
            transform: translateY(-5px);
            background: rgba(243, 156, 18, 0.05);
            border-color: rgba(243, 156, 18, 0.2);
        }

        .card-header {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: black;
            padding: 1rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-content h4 {
            color: #f39c12;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .card-content p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .duration-badge {
            background: rgba(255, 255, 255, 0.2);
            color: #000;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .difficulty-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .difficulty-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .difficulty-badge.beginner {
            background: rgba(39, 174, 96, 0.2);
            color: #27ae60;
        }

        .difficulty-badge.intermediate {
            background: rgba(243, 156, 18, 0.2);
            color: #f39c12;
        }

        .difficulty-badge.advanced {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }

        /* Footer */
        footer {
            background: #000000;
            padding: 3rem 2rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            list-style: none;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: #f39c12;
        }

        .copyright {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.9rem;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {

            .meditation-hero {
                padding: 120px 1rem 4rem;
            }

            .meditation-hero h1 {
                font-size: 2.5rem;
            }

            .timer-container {
                margin: -2rem 1rem 2rem 1rem;
                padding: 2rem;
            }

            .time-circle {
                width: 250px;
                height: 250px;
            }

            .time-circle::before {
                width: 230px;
                height: 230px;
            }

            .time-circle::after {
                width: 200px;
                height: 200px;
            }

            .time-text {
                font-size: 2.5rem;
            }

            .control-buttons {
                flex-direction: column;
                align-items: center;
            }

            .custom-time {
                flex-direction: column;
            }

            .preset-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
        }
    @media (max-width: 768px) {
            /* FORCE hide all desktop navigation */
            nav ul,
            nav li,
            .left-nav ul,
            .right-nav ul,
            .left-nav li,
            .right-nav li,
            .left-nav > ul,
            .right-nav > ul {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Ensure nav container works properly */
            nav {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 1rem !important;
                flex-wrap: nowrap !important;
            }
            
            /* Keep logo visible */
            .logo,
            .logo a {
                display: block !important;
                visibility: visible !important;
                font-size: 1.5rem !important;
                white-space: nowrap !important;
            }
            
            /* Force show mobile button if it exists */
            .mobile-menu-btn {
                display: flex !important;
                visibility: visible !important;
                flex-direction: column;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0.5rem;
                z-index: 1001;
            }
            
            /* Mobile button styles */
            .mobile-menu-btn .hamburger {
                width: 25px;
                height: 3px;
                background: #ffffff;
                margin: 3px 0;
                transition: 0.3s;
                border-radius: 2px;
            }
            
            /* Ensure right-nav container shows mobile button */
            .right-nav {
                display: flex !important;
                align-items: center !important;
                visibility: visible !important;
            }
        }

        /* If no mobile button exists, add this emergency button */
        @media (max-width: 768px) {
            nav:not(:has(.mobile-menu-btn))::after {
                content: "â˜°";
                position: absolute;
                right: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
            }
        }
        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 2rem;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .mobile-menu-link {
            color: #ffffff;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .mobile-menu-link:hover {
            color: #f39c12;
            padding-left: 1rem;
        }

        .mobile-menu-link.mobile-cta {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000 !important;
            border-radius: 12px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
            border: none;
        }

        .mobile-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 1rem 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .mobile-menu-btn.active .hamburger:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        /* Add this to your CSS to ensure mobile elements are hidden on desktop */
        @media (min-width: 769px) {
            .mobile-menu,
            .mobile-menu-btn {
                display: none !important;
                visibility: hidden !important;
            }
        }
    </style>
    <script>
        // Authentication-aware mobile menu
function createMobileMenu() {
    // Only create mobile menu on mobile devices
    if (window.innerWidth > 768) {
        return; // Exit early on desktop
    }
    
    // Check authentication status
    const authToken = localStorage.getItem('authToken');
    const userLoggedIn = localStorage.getItem('userLoggedIn');
    const isLoggedIn = !!(authToken || userLoggedIn === 'true');
    const username = localStorage.getItem('username') || 'User';
    
    console.log('Auth check:', { authToken, userLoggedIn, isLoggedIn, username }); // Debug log
    
    // Create mobile menu if it doesn't exist
    if (!document.getElementById('mobile-menu')) {
        const header = document.querySelector('header');
        const mobileMenu = document.createElement('div');
        mobileMenu.id = 'mobile-menu';
        mobileMenu.className = 'mobile-menu';
        
        // Generate auth-specific menu items
        let authMenuItems = '';
        if (isLoggedIn) {
            authMenuItems = `
                <div class="mobile-menu-divider"></div>
                <div class="mobile-user-info">
                    <span style="color: #f39c12; font-weight: 600; padding: 0.5rem 0;">Welcome, ${username}!</span>
                </div>
                <a href="dashboard.html" class="mobile-menu-link mobile-cta">Dashboard</a>
                <a href="profile.html" class="mobile-menu-link">Profile</a>
                <a href="#" class="mobile-menu-link" onclick="handleMobileLogout(event)">Logout</a>
            `;
        } else {
            authMenuItems = `
                <div class="mobile-menu-divider"></div>
                <a href="login.html" class="mobile-menu-link">Login</a>
                <a href="signup.html" class="mobile-menu-link mobile-cta">Start Training</a>
            `;
        }
        
        mobileMenu.innerHTML = `
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <div class="logo"><a href="index.html">Vivify</a></div>
                    <button class="mobile-menu-close" onclick="closeMobileMenu()">Ã—</button>
                </div>
                <div class="mobile-menu-links">
                    <a href="index.html" class="mobile-menu-link">Home</a>
                    <a href="index.html#training" class="mobile-menu-link">Training Areas</a>
                    <a href="habits-tracker.html" class="mobile-menu-link">Habits</a>
                    <a href="challenges.html" class="mobile-menu-link">Challenges</a>
                    <a href="about.html" class="mobile-menu-link">About</a>
                    <a href="community.html" class="mobile-menu-link">Community</a>
                    ${authMenuItems}
                </div>
            </div>
        `;
        header.appendChild(mobileMenu);
    }
    
    // Create mobile button if it doesn't exist
    if (!document.getElementById('mobile-menu-btn')) {
        const nav = document.querySelector('nav');
        const rightNav = nav.querySelector('.right-nav') || nav;
        const mobileBtn = document.createElement('button');
        mobileBtn.id = 'mobile-menu-btn';
        mobileBtn.className = 'mobile-menu-btn';
        mobileBtn.onclick = toggleMobileMenu;
        mobileBtn.innerHTML = `
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
        `;
        rightNav.appendChild(mobileBtn);
    }
}

function handleMobileLogout(event) {
    event.preventDefault();
    if (confirm('Are you sure you want to logout?')) {
        // Clear all auth data
        localStorage.clear();
        
        // Close mobile menu
        closeMobileMenu();
        
        // Refresh the page to update UI
        window.location.reload();
    }
}

function toggleMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.toggle('active');
    btn.classList.toggle('active');
    
    if (menu.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
    } else {
        document.body.style.overflow = '';
    }
}

function closeMobileMenu() {
    const menu = document.getElementById('mobile-menu');
    const btn = document.getElementById('mobile-menu-btn');
    
    menu.classList.remove('active');
    btn.classList.remove('active');
    document.body.style.overflow = '';
}

// Function to update mobile menu when auth state changes
function updateMobileMenuAuth() {
    const existingMenu = document.getElementById('mobile-menu');
    if (existingMenu) {
        existingMenu.remove();
    }
    createMobileMenu();
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', createMobileMenu);

// Listen for auth state changes (if you have an auth system that fires events)
window.addEventListener('authStateChanged', updateMobileMenuAuth);

// Export functions for external use
window.updateMobileMenuAuth = updateMobileMenuAuth;
window.handleMobileLogout = handleMobileLogout;
// Add this at the end of your mobile menu script
window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
        // Remove mobile elements on desktop
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileBtn = document.getElementById('mobile-menu-btn');
        
        if (mobileMenu) mobileMenu.remove();
        if (mobileBtn) mobileBtn.remove();
        
        // Reset body overflow
        document.body.style.overflow = '';
    } else if (window.innerWidth <= 768) {
        // Recreate mobile menu if switching to mobile
        const existingMenu = document.getElementById('mobile-menu');
        if (!existingMenu) {
            createMobileMenu();
        }
    }
});
        </script>
<script src="js/vivify-stats.js"></script>
<script src="js/leaderboard-system.js"></script>
</head>
<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="left-nav">
                    <div class="logo">
                        <a href="index.html">Vivify</a>
                    </div>
                    <ul>
                        <li><a href="index.html#training">Training Areas</a></li>
                        <li><a href="index.html#habits">Habits & Challenges</a></li>
                        <li><a href="about.html">About</a></li>
                    </ul>
                </div>
                <div class="right-nav">
                    <ul>
                        <li><a href="login.html" id="login-link">Login</a></li>
                        <li><a href="signup.html" class="cta-nav" id="signup-link">Start Training</a></li>
                        <!-- Logged in navigation -->
                        <li><a href="dashboard.html" id="dashboard-link" class="hidden">Dashboard</a></li>
                        <li><a href="profile.html" id="profile-link" class="hidden">Profile</a></li>
                        <li><a href="#" id="logout-link" class="hidden">Logout</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Hero Section -->
        <section class="meditation-hero">
            <div class="hero-content">
                <div class="meditation-badge">Mindfulness Training</div>
                <h1 id="heroTitle">Meditation Timer</h1>
                <p id="heroDescription">Take a moment to center yourself and practice mindfulness. Choose your duration and let our timer guide you through a peaceful meditation session.</p>
            </div>
        </section>

        <!-- Timer Container -->
        <main class="timer-container">
            <!-- Program Info (hidden by default) -->
            <div class="program-info" id="programInfo" style="display: none;">
                <div class="program-title" id="programTitle"></div>
                <div class="program-description" id="programDescription"></div>
            </div>

            <!-- Timer Display -->
            <div class="timer-display">
                <div class="time-circle" id="timeCircle">
                    <div class="time-text" id="timeText">05:00</div>
                </div>
                <div class="timer-status" id="timerStatus">Ready to begin</div>
                <div class="session-info" id="sessionInfo">
                    <span>Selected: <strong id="selectedDuration">5 minutes</strong></span>
                    <span> | Sessions today: <strong id="sessionsToday">0</strong></span>
                </div>
            </div>

            <!-- Preset Time Buttons -->
            <div class="preset-buttons">
                <button class="preset-btn active" data-minutes="5">
                    <i class="fas fa-seedling"></i>
                    <span>5 min</span>
                    <small>Beginner</small>
                </button>
                <button class="preset-btn" data-minutes="10">
                    <i class="fas fa-leaf"></i>
                    <span>10 min</span>
                    <small>Focus</small>
                </button>
                <button class="preset-btn" data-minutes="15">
                    <i class="fas fa-tree"></i>
                    <span>15 min</span>
                    <small>Mindful</small>
                </button>
                <button class="preset-btn" data-minutes="20">
                    <i class="fas fa-mountain"></i>
                    <span>20 min</span>
                    <small>Deep</small>
                </button>
                <button class="preset-btn" data-minutes="30">
                    <i class="fas fa-sun"></i>
                    <span>30 min</span>
                    <small>Extended</small>
                </button>
            </div>

            <!-- Custom Time Input -->
            <div class="custom-time">
                <span style="color: #f39c12; margin-right: 1rem;">Custom Duration:</span>
                <div class="time-input">
                    <input type="number" id="customMinutes" min="1" max="99" value="5">
                    <label>minutes</label>
                </div>
                <button class="preset-btn" onclick="setCustomTime()">
                    <i class="fas fa-clock"></i>
                    Set
                </button>
            </div>

            <!-- Control Buttons -->
            <div class="control-buttons">
                <button class="control-btn" id="startBtn" onclick="startTimer()">
                    <i class="fas fa-play"></i>
                    Start
                </button>
                <button class="control-btn secondary" id="pauseBtn" onclick="pauseTimer()" disabled>
                    <i class="fas fa-pause"></i>
                    Pause
                </button>
                <button class="control-btn secondary" id="resetBtn" onclick="resetTimer()">
                    <i class="fas fa-stop"></i>
                    Reset
                </button>
            </div>

            <!-- Sound Controls -->
            <div class="sound-controls">
                <h3><i class="fas fa-volume-up"></i> Ambient Sounds</h3>
                <div class="sound-options">
                    <div class="sound-option active" data-sound="none">
                        <i class="fas fa-volume-mute"></i>
                        <div>Silence</div>
                    </div>
                    <div class="sound-option" data-sound="rain">
                        <i class="fas fa-cloud-rain"></i>
                        <div>Rain</div>
                    </div>
                    <div class="sound-option" data-sound="ocean">
                        <i class="fas fa-water"></i>
                        <div>Ocean Waves</div>
                    </div>
                    <div class="sound-option" data-sound="forest">
                        <i class="fas fa-tree"></i>
                        <div>Forest</div>
                    </div>
                    <div class="sound-option" data-sound="bells">
                        <i class="fas fa-bell"></i>
                        <div>Tibetan Bowls</div>
                    </div>
                </div>
                <div class="volume-control">
                    <i class="fas fa-volume-down"></i>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="0.8">
                    <i class="fas fa-volume-up"></i>
                </div>
            </div>

            <!-- Session Complete -->
            <div class="session-complete" id="sessionComplete">
                <h2><i class="fas fa-check-circle"></i> Well Done!</h2>
                <p>You've completed your meditation session. Take a moment to notice how you feel.</p>
                <div class="session-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="completedDuration">5</div>
                        <div class="stat-label">Minutes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalSessions">1</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="streakCount">1</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>
                <button class="control-btn" onclick="startNewSession()">
                    <i class="fas fa-redo"></i>
                    Start New Session
                </button>
            </div>
        </main>
 
        <!-- Guided Programs -->
        <section class="guided-programs">
            <h2>Performance Training Programs</h2>
            <div class="program-cards">
                <div class="program-card" onclick="startGuidedProgram('exam-protocol', 15)">
                    <div class="card-header">
                        <div>
                            <i class="fas fa-graduation-cap"></i>
                            <strong>Exam Performance Protocol</strong>
                        </div>
                        <span class="duration-badge">15 min</span>
                    </div>
                    <div class="card-content">
                        <div class="difficulty-indicator">
                            <div class="difficulty-badge beginner">Beginner</div>
                        </div>
                        <h4>Pre-Exam Optimization</h4>
                        <p>Complete routine to optimize focus, reduce anxiety, and enhance recall during tests and exams.</p>
                        <button class="control-btn" style="width: 100%;">
                            <i class="fas fa-play"></i>
                            Start Training
                        </button>
                    </div>
                </div>
 
                <div class="program-card" onclick="startGuidedProgram('study-focus', 20)">
                    <div class="card-header">
                        <div>
                            <i class="fas fa-brain"></i>
                            <strong>Deep Study Focus</strong>
                        </div>
                        <span class="duration-badge">20 min</span>
                    </div>
                    <div class="card-content">
                        <div class="difficulty-indicator">
                            <div class="difficulty-badge intermediate">Intermediate</div>
                        </div>
                        <h4>Extended Concentration</h4>
                        <p>Advanced concentration training for marathon study sessions and complex material mastery.</p>
                        <button class="control-btn" style="width: 100%;">
                            <i class="fas fa-play"></i>
                            Start Training
                        </button>
                    </div>
                </div>
 
                <div class="program-card" onclick="startGuidedProgram('athletic-prep', 10)">
                    <div class="card-header">
                        <div>
                            <i class="fas fa-dumbbell"></i>
                            <strong>Athletic Performance</strong>
                        </div>
                        <span class="duration-badge">10 min</span>
                    </div>
                    <div class="card-content">
                        <div class="difficulty-indicator">
                            <div class="difficulty-badge intermediate">Intermediate</div>
                        </div>
                        <h4>Pre-Competition Prep</h4>
                        <p>Mental preparation for peak athletic performance and competitive edge.</p>
                        <button class="control-btn" style="width: 100%;">
                            <i class="fas fa-play"></i>
                            Start Training
                        </button>
                    </div>
                </div>
 
                <div class="program-card" onclick="startGuidedProgram('stress-resilience', 25)">
                    <div class="card-header">
                        <div>
                            <i class="fas fa-shield-alt"></i>
                            <strong>Stress Resilience Building</strong>
                        </div>
                        <span class="duration-badge">25 min</span>
                    </div>
                    <div class="card-content">
                        <div class="difficulty-indicator">
                            <div class="difficulty-badge advanced">Advanced</div>
                        </div>
                        <h4>Mental Toughness</h4>
                        <p>Advanced stress inoculation training to build mental toughness and emotional regulation.</p>
                        <button class="control-btn" style="width: 100%;">
                            <i class="fas fa-play"></i>
                            Start Training
                        </button>
                    </div>
                </div>
 
                <div class="program-card" onclick="startGuidedProgram('speaking-confidence', 12)">
                    <div class="card-header">
                        <div>
                            <i class="fas fa-microphone"></i>
                            <strong>Public Speaking Confidence</strong>
                        </div>
                        <span class="duration-badge">12 min</span>
                    </div>
                    <div class="card-content">
                        <div class="difficulty-indicator">
                            <div class="difficulty-badge beginner">Beginner</div>
                        </div>
                        <h4>Presentation Power</h4>
                        <p>Overcome presentation anxiety and build confidence for public speaking and presentations.</p>
                        <button class="control-btn" style="width: 100%;">
                            <i class="fas fa-play"></i>
                            Start Training
                        </button>
                    </div>
                </div>
 
                <div class="program-card" onclick="startGuidedProgram('recovery-protocol', 30)">
                    <div class="card-header">
                        <div>
                            <i class="fas fa-moon"></i>
                            <strong>Elite Recovery Protocol</strong>
                        </div>
                        <span class="duration-badge">30 min</span>
                    </div>
                    <div class="card-content">
                        <div class="difficulty-indicator">
                            <div class="difficulty-badge advanced">Advanced</div>
                        </div>
                        <h4>Optimal Recovery</h4>
                        <p>Comprehensive recovery practice for optimal sleep preparation and stress release.</p>
                        <button class="control-btn" style="width: 100%;">
                            <i class="fas fa-play"></i>
                            Start Training
                        </button>
                    </div>
                </div>
            </div>
        </section>
 
        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <p class="copyright">&copy; 2025 Vivify. Building elite habits, one day at a time.</p>
                <ul class="footer-links">
                    <li><a href="privacy.html">Privacy Policy</a></li>
                    <li><a href="terms.html">Terms of Service</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>
            </div>
        </footer>
    </div>
 
    <script>
        console.log('ðŸŽµ Elite Meditation Timer Starting...');
 
        // Global variables
        let audioContext = null;
        let currentAmbientSound = null;
        let volume = 0.8;
        let selectedSound = 'none';
        let isAudioEnabled = false;
 
        // Timer variables
        let duration = 5 * 60;
        let timeLeft = duration;
        let isRunning = false;
        let isPaused = false;
        let timerInterval = null;
        let sessionsToday = 0;
        let currentProgram = null;
 
        // DOM elements
        const timeText = document.getElementById('timeText');
        const timeCircle = document.getElementById('timeCircle');
        const timerStatus = document.getElementById('timerStatus');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const sessionComplete = document.getElementById('sessionComplete');
 
        // Program definitions
        const programs = {
            'exam-protocol': {
                name: 'Exam Performance Protocol',
                description: 'A comprehensive 15-minute routine to optimize your mental state before exams, featuring breathing techniques, visualization, and confidence building.',
                duration: 15,
                steps: [
                    'Settle into a comfortable position and close your eyes',
                    'Take 5 deep breaths to center yourself',
                    'Visualize the exam room - see yourself calm and confident',
                    'Review key concepts mentally with clarity',
                    'Feel your knowledge flowing easily',
                    'Set intention for focused performance',
                    'Anchor confidence with final deep breaths'
                ]
            },
            'study-focus': {
                name: 'Deep Study Focus',
                description: '20-minute extended concentration training for marathon study sessions and complex material mastery.',
                duration: 20,
                steps: [
                    'Find your optimal study position',
                    'Clear mental distractions with breathing',
                    'Set focused intention for learning',
                    'Practice sustained attention training',
                    'Build concentration stamina',
                    'Prepare mind for deep learning',
                    'Lock in focus for study session'
                ]
            },
            'athletic-prep': {
                name: 'Athletic Performance',
                description: '10-minute pre-competition mental preparation for peak athletic performance and competitive edge.',
                duration: 10,
                steps: [
                    'Ground yourself in confident posture',
                    'Activate your athletic mindset',
                    'Visualize perfect performance',
                    'Feel strength and power in your body',
                    'See yourself executing with precision',
                    'Build competitive confidence',
                    'Ready for peak performance'
                ]
            },
            'stress-resilience': {
                name: 'Stress Resilience Building',
                description: '25-minute advanced stress inoculation training to build mental toughness and emotional regulation.',
                duration: 25,
                steps: [
                    'Acknowledge current stress levels',
                    'Practice stress response awareness',
                    'Build emotional regulation skills',
                    'Develop mental toughness',
                    'Create resilience strategies',
                    'Strengthen coping mechanisms',
                    'Integrate resilience mindset'
                ]
            },
            'speaking-confidence': {
                name: 'Public Speaking Confidence',
                description: '12-minute confidence building for presentations and public speaking.',
                duration: 12,
                steps: [
                    'Stand or sit with confident posture',
                    'Connect with your authentic voice',
                    'Visualize engaging your audience',
                    'Feel your message flowing clearly',
                    'See positive audience response',
                    'Build presentation confidence',
                    'Ready to share your voice'
                ]
            },
            'recovery-protocol': {
                name: 'Elite Recovery Protocol',
                description: '30-minute comprehensive recovery practice for optimal sleep preparation and stress release.',
                duration: 30,
                steps: [
                    'Release the tensions of the day',
                    'Scan and relax your entire body',
                    'Clear mental activity and worries',
                    'Activate your relaxation response',
                    'Prepare for restorative sleep',
                    'Set intention for deep recovery',
                    'Drift into peaceful rest'
                ]
            }
        };
 
        // Initialize audio context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('ðŸŽµ Audio context created');
                isAudioEnabled = true;
            }
        }
 
        // Audio creation functions
        function createAmbientAudio(soundType) {
            console.log('ðŸŽµ Loading audio file:', soundType);
            
            const audio = new Audio();
            audio.src = `sounds/${soundType}.mp3`;
            audio.loop = true;
            audio.volume = volume * 0.7;
            
            audio.addEventListener('loadstart', () => {
                console.log('ðŸ“ Started loading:', soundType);
            });
            
            audio.addEventListener('canplay', () => {
                console.log('âœ… Audio file ready:', soundType);
            });
            
            audio.addEventListener('error', (e) => {
                console.error('âŒ Audio file error:', soundType, e);
                console.log('ðŸ’¡ Falling back to generated sound');
            });
            
            return audio;
        }
 
        function startAmbientSound() {
            if (selectedSound === 'none') {
                console.log('ðŸ”‡ No sound selected');
                return;
            }
 
            console.log('ðŸŽµ Starting ambient sound:', selectedSound);
            stopAmbientSound();
 
            try {
                currentAmbientSound = createAmbientAudio(selectedSound);
                
                if (currentAmbientSound) {
                    currentAmbientSound.play().then(() => {
                        console.log('âœ… Audio file playing:', selectedSound);
                    }).catch((error) => {
                        console.error('âŒ Audio play failed, falling back to generated sound:', error);
                        fallbackToGeneratedSound();
                    });
                }
            } catch (error) {
                console.error('âŒ Error with audio file, using generated sound:', error);
                fallbackToGeneratedSound();
            }
        }
 
        function fallbackToGeneratedSound() {
            console.log('ðŸ”„ Using generated sound as fallback');
            
            if (!audioContext) {
                initAudio();
            }
            
            let generatedSound = null;
            
            switch (selectedSound) {
                case 'rain':
                    generatedSound = createGeneratedRain();
                    break;
                case 'ocean':
                    generatedSound = createGeneratedOcean();
                    break;
                case 'forest':
                    generatedSound = createGeneratedForest();
                    break;
                case 'bells':
                    generatedSound = createGeneratedBells();
                    break;
            }
            
            if (generatedSound && generatedSound.source) {
                generatedSound.source.start();
                currentAmbientSound = generatedSound;
                console.log('âœ… Generated sound started');
            }
        }
 
        function stopAmbientSound() {
            if (currentAmbientSound) {
                try {
                    if (currentAmbientSound.pause) {
                        currentAmbientSound.pause();
                        currentAmbientSound.currentTime = 0;
                        console.log('ðŸ›‘ Audio file stopped');
                    } else if (currentAmbientSound.source) {
                        currentAmbientSound.source.stop();
                        console.log('ðŸ›‘ Generated sound stopped');
                    }
                } catch (error) {
                    console.log('âš ï¸ Error stopping sound:', error.message);
                }
                currentAmbientSound = null;
            }
        }
 
        // Generated sound functions
        function createGeneratedRain() {
            if (!audioContext) return null;
            const bufferSize = audioContext.sampleRate * 2;
            const buffer = audioContext.createBuffer(2, bufferSize, audioContext.sampleRate);
            const leftData = buffer.getChannelData(0);
            const rightData = buffer.getChannelData(1);
            
            for (let i = 0; i < bufferSize; i++) {
                leftData[i] = (Math.random() * 2 - 1) * 0.3;
                rightData[i] = (Math.random() * 2 - 1) * 0.3;
            }
 
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.loop = true;
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1500;
            const gainNode = audioContext.createGain();
            gainNode.gain.value = volume * 0.7;
            source.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            return { source, gainNode };
        }
 
        function createGeneratedOcean() {
            if (!audioContext) return null;
            const bufferSize = audioContext.sampleRate * 3;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                const time = i / audioContext.sampleRate;
                data[i] = (Math.sin(2 * Math.PI * 0.3 * time) * 0.4 + Math.sin(2 * Math.PI * 0.5 * time) * 0.3 + (Math.random() * 2 - 1) * 0.1) * 0.5;
            }
 
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.loop = true;
            const gainNode = audioContext.createGain();
            gainNode.gain.value = volume * 0.6;
            source.connect(gainNode);
            gainNode.connect(audioContext.destination);
            return { source, gainNode };
        }
 
        function createGeneratedForest() {
            if (!audioContext) return null;
            const bufferSize = audioContext.sampleRate * 2;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                const time = i / audioContext.sampleRate;
                data[i] = (Math.sin(2 * Math.PI * 0.4 * time) * 0.2 + (Math.random() * 2 - 1) * 0.15) * 0.4;
            }
 
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.loop = true;
            const gainNode = audioContext.createGain();
            gainNode.gain.value = volume * 0.5;
            source.connect(gainNode);
            gainNode.connect(audioContext.destination);
            return { source, gainNode };
        }
 
        function createGeneratedBells() {
            if (!audioContext) return null;
            const bufferSize = audioContext.sampleRate * 4;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < bufferSize; i++) {
                const time = i / audioContext.sampleRate;
                data[i] = (Math.sin(2 * Math.PI * 220 * time) * Math.exp(-time * 0.5) * 0.6 + Math.sin(2 * Math.PI * 440 * time) * Math.exp(-time * 0.7) * 0.3) * 0.5;
            }
 
            const source = audioContext.createBufferSource();
            source.buffer = buffer;
            source.loop = true;
            const gainNode = audioContext.createGain();
            gainNode.gain.value = volume * 0.4;
            source.connect(gainNode);
            gainNode.connect(audioContext.destination);
            return { source, gainNode };
        }
 
        // Timer functions
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timeText.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
 
            const progress = ((duration - timeLeft) / duration) * 360;
            timeCircle.style.setProperty('--progress', `${progress}deg`);
        }
 
        function updateSessionInfo() {
            const totalMinutes = Math.floor(duration / 60);
            document.getElementById('selectedDuration').textContent = `${totalMinutes} minute${totalMinutes !== 1 ? 's' : ''}`;
            document.getElementById('sessionsToday').textContent = sessionsToday;
        }
 
        function startTimer() {
            console.log('â–¶ï¸ Starting timer...');
            
            initAudio();
            
            if (isPaused) {
                resumeTimer();
                return;
            }
 
            isRunning = true;
            isPaused = false;
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            timerStatus.textContent = currentProgram ? `Training: ${currentProgram.name}` : 'Meditating...';
 
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    startAmbientSound();
                });
            } else {
                startAmbientSound();
            }
 
            timerInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();
 
                if (timeLeft <= 0) {
                    completeSession();
                }
            }, 1000);
        }
 
        function pauseTimer() {
            console.log('â¸ï¸ Pausing timer...');
            
            isPaused = true;
            isRunning = false;
            clearInterval(timerInterval);
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            timerStatus.textContent = 'Paused';
 
            stopAmbientSound();
        }
 
        function resumeTimer() {
            console.log('â–¶ï¸ Resuming timer...');
            
            isRunning = true;
            isPaused = false;
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            timerStatus.textContent = currentProgram ? `Training: ${currentProgram.name}` : 'Meditating...';
 
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    startAmbientSound();
                });
            } else {
                startAmbientSound();
            }
 
            timerInterval = setInterval(() => {
                timeLeft--;
                updateDisplay();
 
                if (timeLeft <= 0) {
                    completeSession();
                }
            }, 1000);
        }
 
        function resetTimer() {
            console.log('ðŸ”„ Resetting timer...');
            
            isRunning = false;
            isPaused = false;
            clearInterval(timerInterval);
            timeLeft = duration;
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            timerStatus.textContent = 'Ready to begin';
            sessionComplete.classList.remove('show');
 
            stopAmbientSound();
            updateDisplay();
        }
 
        function completeSession() {
            console.log('âœ… Session complete!');
            
            isRunning = false;
            isPaused = false;
            clearInterval(timerInterval);
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            timerStatus.textContent = 'Session complete! Well done!';
 
            stopAmbientSound();
            
            // Play completion sound
            if (audioContext) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 1.5);
            }
 
            recordSession();
            showSessionComplete();
        }
 
        function recordSession() {
            sessionsToday++;
            const today = new Date().toDateString();
            
            const sessionData = {
                date: today,
                duration: Math.floor(duration / 60),
                type: currentProgram ? currentProgram.name : 'timer',
                program: currentProgram ? currentProgram.name : null,
                completedAt: new Date().toISOString()
            };
 
            let sessions = JSON.parse(localStorage.getItem('meditationSessions') || '[]');
            sessions.push(sessionData);
            localStorage.setItem('meditationSessions', JSON.stringify(sessions));
 
            localStorage.setItem('meditationSessionsToday', sessionsToday.toString());
            localStorage.setItem('lastMeditationDate', today);
 
            // Also save to mindfulness sessions for progress tracking
            let mindfulnessSessions = JSON.parse(localStorage.getItem('mindfulnessSessions') || '[]');
            mindfulnessSessions.push({
                date: new Date().toISOString(),
                type: 'guided-program',
                name: currentProgram ? currentProgram.name : 'Meditation Timer',
                duration: Math.floor(duration / 60) * 60,
                timestamp: Date.now()
            });
            localStorage.setItem('mindfulnessSessions', JSON.stringify(mindfulnessSessions));
        }
 
        function getTodaySessions() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastMeditationDate');
            
            if (lastDate === today) {
                return parseInt(localStorage.getItem('meditationSessionsToday') || '0');
            } else {
                localStorage.setItem('meditationSessionsToday', '0');
                localStorage.setItem('lastMeditationDate', today);
                return 0;
            }
        }
 
        function showSessionComplete() {
            const completedMinutes = Math.floor(duration / 60);
            document.getElementById('completedDuration').textContent = completedMinutes;
            document.getElementById('totalSessions').textContent = sessionsToday;
            
            const streak = 1; // Simplified - could be enhanced with actual streak calculation
            document.getElementById('streakCount').textContent = streak;
            
            sessionComplete.classList.add('show');
            sessionComplete.scrollIntoView({ behavior: 'smooth' });
        }
 
        function setCustomTime() {
            if (isRunning) return;
            
            const minutes = parseInt(document.getElementById('customMinutes').value);
            if (minutes && minutes > 0) {
                duration = minutes * 60;
                timeLeft = duration;
                clearActivePresets();
                updateDisplay();
                updateSessionInfo();
                currentProgram = null;
                hideProgram();
            }
        }
 
        function clearActivePresets() {
            document.querySelectorAll('.preset-btn[data-minutes]').forEach(btn => {
                btn.classList.remove('active');
            });
        }
 
        function startNewSession() {
            resetTimer();
            currentProgram = null;
            hideProgram();
            timerStatus.textContent = 'Ready to begin';
        }
 
        function startGuidedProgram(programKey, minutes) {
            if (isRunning) return;
            
            currentProgram = programs[programKey];
            if (!currentProgram) return;
            
            duration = minutes * 60;
            timeLeft = duration;
            clearActivePresets();
            updateDisplay();
            updateSessionInfo();
            
            showProgram(currentProgram);
            
            document.querySelector('.timer-container').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
 
        function showProgram(program) {
            const programInfo = document.getElementById('programInfo');
            const programTitle = document.getElementById('programTitle');
            const programDescription = document.getElementById('programDescription');
            const heroTitle = document.getElementById('heroTitle');
            const heroDescription = document.getElementById('heroDescription');
            
            programTitle.textContent = program.name;
            programDescription.textContent = program.description;
            programInfo.style.display = 'block';
            
            heroTitle.textContent = program.name;
            heroDescription.textContent = program.description;
        }
 
        function hideProgram() {
            const programInfo = document.getElementById('programInfo');
            const heroTitle = document.getElementById('heroTitle');
            const heroDescription = document.getElementById('heroDescription');
            
            programInfo.style.display = 'none';
            heroTitle.textContent = 'Meditation Timer';
            heroDescription.textContent = 'Take a moment to center yourself and practice mindfulness. Choose your duration and let our timer guide you through a peaceful meditation session.';
        }
 
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“± Loading elite meditation timer...');
            
            // Check authentication status
            const isLoggedIn = localStorage.getItem('authToken') || localStorage.getItem('userLoggedIn') === 'true';
            
            // Update UI based on login status
            updateAuthState(isLoggedIn);
            
            function updateAuthState(isLoggedIn) {
                document.getElementById('login-link').style.display = isLoggedIn ? 'none' : 'block';
                document.getElementById('signup-link').style.display = isLoggedIn ? 'none' : 'block';
                document.getElementById('dashboard-link').classList.toggle('hidden', !isLoggedIn);
                document.getElementById('profile-link').classList.toggle('hidden', !isLoggedIn);
                document.getElementById('logout-link').classList.toggle('hidden', !isLoggedIn);
            }
            
            // Logout functionality
            const logoutLink = document.getElementById('logout-link');
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.clear();
                    updateAuthState(false);
                    window.location.href = 'index.html';
                });
            }
 
            // Check for program from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const programParam = urlParams.get('program');
            
            // Check for stored practice from mindfulness guide
            const selectedPractice = localStorage.getItem('selectedPractice');
            if (selectedPractice) {
                const practice = JSON.parse(selectedPractice);
                // Map the practice to our program system
                const programMapping = {
                    'Exam Performance Protocol': 'exam-protocol',
                    'Deep Study Focus': 'study-focus',
                    'Athletic Performance': 'athletic-prep',
                    'Stress Resilience Building': 'stress-resilience',
                    'Public Speaking Confidence': 'speaking-confidence',
                    'Elite Recovery Protocol': 'recovery-protocol'
                };
                
                const programKey = programMapping[practice.name];
                if (programKey && programs[programKey]) {
                    startGuidedProgram(programKey, programs[programKey].duration);
                }
                
                // Clear the stored practice
                localStorage.removeItem('selectedPractice');
            } else if (programParam && programs[programParam]) {
                startGuidedProgram(programParam, programs[programParam].duration);
            }
 
            // Load sessions today
            sessionsToday = getTodaySessions();
 
            // Preset buttons
            document.querySelectorAll('.preset-btn[data-minutes]').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (isRunning) return;
                    
                    const minutes = parseInt(btn.dataset.minutes);
                    duration = minutes * 60;
                    timeLeft = duration;
                    
                    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    currentProgram = null;
                    hideProgram();
                    
                    updateDisplay();
                    updateSessionInfo();
                    console.log('â±ï¸ Duration set to', minutes, 'minutes');
                });
            });
 
            // Sound option buttons
            document.querySelectorAll('.sound-option').forEach(option => {
                option.addEventListener('click', () =>{
                   initAudio();
                   
                   document.querySelectorAll('.sound-option').forEach(opt => opt.classList.remove('active'));
                   option.classList.add('active');
                   selectedSound = option.dataset.sound;
                   console.log('ðŸŽµ Sound selected:', selectedSound);

                   if (isRunning) {
                       stopAmbientSound();
                       startAmbientSound();
                   }
               });
           });

           // Volume control
           document.getElementById('volumeSlider').addEventListener('input', (e) => {
               volume = parseFloat(e.target.value);
               console.log('ðŸ”Š Volume changed to:', volume);
               
               if (currentAmbientSound) {
                   if (currentAmbientSound.volume !== undefined) {
                       currentAmbientSound.volume = volume * 0.7;
                   } else if (currentAmbientSound.gainNode) {
                       currentAmbientSound.gainNode.gain.value = volume * 0.7;
                   }
               }
           });

           // Custom time input
           document.getElementById('customMinutes').addEventListener('change', () => {
               clearActivePresets();
               currentProgram = null;
               hideProgram();
           });

           // Initialize display
           updateDisplay();
           updateSessionInfo();
           
           console.log('âœ… Elite meditation timer ready!');
       });

       // Keyboard shortcuts
       document.addEventListener('keydown', function(e) {
           if (e.target.matches('input')) return;
           
           switch(e.code) {
               case 'Space':
                   e.preventDefault();
                   if (!isRunning && !isPaused) {
                       startTimer();
                   } else if (isRunning) {
                       pauseTimer();
                   } else if (isPaused) {
                       startTimer();
                   }
                   break;
                   
               case 'KeyR':
                   e.preventDefault();
                   resetTimer();
                   break;
                   
               case 'Digit1':
                   e.preventDefault();
                   if (!isRunning) {
                       document.querySelector('[data-minutes="5"]').click();
                   }
                   break;
                   
               case 'Digit2':
                   e.preventDefault();
                   if (!isRunning) {
                       document.querySelector('[data-minutes="10"]').click();
                   }
                   break;
                   
               case 'Digit3':
                   e.preventDefault();
                   if (!isRunning) {
                       document.querySelector('[data-minutes="15"]').click();
                   }
                   break;
           }
       });

       // Header background on scroll
       window.addEventListener('scroll', function() {
           const header = document.querySelector('header');
           if (window.scrollY > 100) {
               header.style.background = 'rgba(10, 10, 10, 0.98)';
           } else {
               header.style.background = 'rgba(10, 10, 10, 0.95)';
           }
       });

       console.log('ðŸŽ¯ Elite meditation timer loaded and ready!');
       console.log('ðŸŽµ Select an ambient sound and start your training!');
   </script>
<script src="js/flexible-mobile-nav.js"></script> </body>
</html>