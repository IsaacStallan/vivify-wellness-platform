<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attention Training - Vivify</title>
    
    <!-- Load fonts first -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Load icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header - Consistent with other pages */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .left-nav {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .logo a {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .left-nav ul, .right-nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .left-nav a, .right-nav a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .left-nav a:hover, .right-nav a:hover {
            color: #f39c12;
        }

        .left-nav a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transition: width 0.3s ease;
        }

        .left-nav a:hover::after {
            width: 100%;
        }

        .cta-nav {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000 !important;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .cta-nav:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(243, 156, 18, 0.4);
            color: #000 !important;
        }

        .hidden {
            display: none !important;
        }

        /* Hero Section */
        .attention-hero {
            background: 
                radial-gradient(circle at 20% 20%, rgba(243, 156, 18, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(230, 126, 34, 0.1) 0%, transparent 50%),
                linear-gradient(rgba(10, 10, 10, 0.7), rgba(10, 10, 10, 0.7)),
                url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            padding: 150px 2rem 6rem;
            text-align: center;
            position: relative;
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-content {
            position: relative;
            z-index: 100;
            max-width: 900px;
            margin: 0 auto;
        }

        .attention-badge {
            display: inline-block;
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            border: 1px solid rgba(243, 156, 18, 0.2);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .attention-hero h1 {
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 900;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #f39c12 50%, #e67e22 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
        }

        .attention-hero p {
            font-size: 1.25rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        /* Live Focus Stats */
        .focus-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0 3rem;
            flex-wrap: wrap;
        }

        .focus-stat {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .focus-stat::before {
            content: '';
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(39, 174, 96, 0); }
            100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0); }
        }

        .focus-stat .stat-number {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
            color: #f39c12;
        }

        .focus-stat .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn {
            padding: 1rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: inline-block;
            font-family: inherit;
            border: none;
            cursor: pointer;
            margin: 0 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 2px solid rgba(243, 156, 18, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(243, 156, 18, 0.4);
        }

        /* Interactive Focus Timer */
        .focus-timer-section {
            background: rgba(255, 255, 255, 0.02);
            padding: 6rem 2rem;
        }

        .timer-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 3rem;
            position: relative;
            text-align: center;
        }

        .timer-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-radius: 24px 24px 0 0;
        }

        .section-heading {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #ffffff, #f39c12);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .timer-modes {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .timer-mode {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timer-mode.active {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000;
            border-color: transparent;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .timer-btn {
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .timer-btn.start {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #000;
        }

        .timer-btn.pause {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000;
        }

        .timer-btn.stop {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
        }

        .timer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .session-info {
            background: rgba(243, 156, 18, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid rgba(243, 156, 18, 0.2);
        }

        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            text-align: center;
        }

        .session-stat {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
        }

        .session-stat .value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: #f39c12;
        }

        .session-stat .label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
        }

        /* Game Styles */
        .game-area {
            min-height: 400px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .game-instructions {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
        }

        .stroop-word {
            font-size: 4rem;
            font-weight: 800;
            margin: 2rem 0;
            cursor: pointer;
            transition: all 0.2s ease;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .stroop-word:hover {
            transform: scale(1.1);
        }

        .color-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .color-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .color-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .nback-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 2rem 0;
        }

        .nback-cell {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nback-cell.active {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
        }

        .breathing-circle {
            width: 200px;
            height: 200px;
            border: 4px solid rgba(243, 156, 18, 0.3);
            border-radius: 50%;
            margin: 2rem auto;
            position: relative;
            overflow: hidden;
        }

        .breathing-inner {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(243, 156, 18, 0.3), transparent);
            border-radius: 50%;
            transition: transform 4s ease-in-out;
        }

        .breathing-circle.inhale .breathing-inner {
            transform: scale(1.5);
        }

        .breathing-circle.exhale .breathing-inner {
            transform: scale(0.7);
        }

        .breathing-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: 600;
            color: #f39c12;
        }

        .game-score {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            text-align: center;
        }

        .game-score .score-value {
            font-size: 2rem;
            font-weight: 800;
            color: #f39c12;
        }

        .game-score .score-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Attention Games */
        .attention-games {
            padding: 6rem 2rem;
        }

        .games-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 4rem;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            overflow: hidden;
            transition: all 0.4s ease;
            position: relative;
            cursor: pointer;
        }

        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #f39c12, #e67e22);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .game-card:hover::before {
            transform: scaleX(1);
        }

        .game-card:hover {
            transform: translateY(-15px);
            background: rgba(243, 156, 18, 0.05);
            border-color: rgba(243, 156, 18, 0.2);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .game-icon {
            padding: 3rem 2rem 2rem;
            text-align: center;
        }

        .game-icon i {
            font-size: 3rem;
            color: #f39c12;
            margin-bottom: 1rem;
        }

        .game-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 1rem 0;
            color: #ffffff;
            text-align: center;
        }

        .game-description {
            padding: 0 2rem 1rem;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
            text-align: center;
        }

        .game-actions {
            padding: 1.5rem 2rem 2rem;
            text-align: center;
        }

        /* Footer - FIXED */
        footer {
            background: #000000;
            padding: 3rem 2rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            list-style: none;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: #f39c12;
        }

        .copyright {
            color: rgba(255, 255, 255, 0.4);
            font-size: 0.9rem;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .attention-hero {
                padding: 120px 1rem 4rem;
            }

            .attention-hero h1 {
                font-size: 2.5rem;
            }

            .focus-stats {
                flex-direction: column;
                align-items: center;
            }

            .timer-display {
                font-size: 3rem;
            }

            .games-grid {
                grid-template-columns: 1fr;
            }

            .timer-controls {
                flex-direction: column;
                align-items: center;
            }

            .color-buttons {
                flex-direction: column;
                align-items: center;
            }

            .stroop-word {
                font-size: 3rem;
            }

            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }

            /* FORCE hide all desktop navigation */
            nav ul,
            nav li,
            .left-nav ul,
            .right-nav ul,
            .left-nav li,
            .right-nav li,
            .left-nav > ul,
            .right-nav > ul {
                display: none !important;
                visibility: hidden !important;
            }
            
            /* Ensure nav container works properly */
            nav {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 1rem !important;
                flex-wrap: nowrap !important;
            }
            
            /* Keep logo visible */
            .logo,
            .logo a {
                display: block !important;
                visibility: visible !important;
                font-size: 1.5rem !important;
                white-space: nowrap !important;
            }
            
            /* Force show mobile button if it exists */
            .mobile-menu-btn {
                display: flex !important;
                visibility: visible !important;
                flex-direction: column;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0.5rem;
                z-index: 1001;
            }
            
            /* Mobile button styles */
            .mobile-menu-btn .hamburger {
                width: 25px;
                height: 3px;
                background: #ffffff;
                margin: 3px 0;
                transition: 0.3s;
                border-radius: 2px;
            }
            
            /* Ensure right-nav container shows mobile button */
            .right-nav {
                display: flex !important;
                align-items: center !important;
                visibility: visible !important;
            }
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.8s ease-out forwards;
        }

        @keyframes breathing {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .breathing {
            animation: breathing 4s ease-in-out infinite;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(10, 10, 10, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 2rem;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .mobile-menu-link {
            color: #ffffff;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: 500;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .mobile-menu-link:hover {
            color: #f39c12;
            padding-left: 1rem;
        }

        .mobile-menu-link.mobile-cta {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: #000 !important;
            border-radius: 12px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 600;
            border: none;
        }

        .mobile-menu-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 1rem 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .mobile-menu-btn.active .hamburger:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active .hamburger:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        /* Add this to your CSS to ensure mobile elements are hidden on desktop */
        @media (min-width: 769px) {
            .mobile-menu,
            .mobile-menu-btn {
                display: none !important;
                visibility: hidden !important;
            }
        }

        /* Game-specific styles */
        .game-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .game-modal {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            text-align: center;
            position: relative;
        }

        .close-game {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .close-game:hover {
            color: #f39c12;
        }

        .cooldown-notice {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            color: #f39c12;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="left-nav">
                <div class="logo">
                    <a href="index.html">Vivify</a>
                </div>
                <ul>
                    <li><a href="index.html#training">Training Areas</a></li>
                    <li><a href="index.html#habits">Habits & Challenges</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>
            </div>
            <div class="right-nav">
                <ul>
                    <li><a href="login.html" id="login-link">Login</a></li>
                    <li><a href="signup.html" class="cta-nav" id="signup-link">Start Training</a></li>
                    <!-- Logged in navigation -->
                    <li><a href="dashboard.html" id="dashboard-link" class="hidden">Dashboard</a></li>
                    <li><a href="profile.html" id="profile-link" class="hidden">Profile</a></li>
                    <li><a href="#" id="logout-link" class="hidden">Logout</a></li>
                </ul>
            </div>
        </nav>
    </header>
 
    <div class="wrapper">
        <!-- Hero Section with Live Focus Stats -->
        <section class="attention-hero fade-in-up">
            <div class="hero-content">
                <div class="attention-badge">Brain Training Mode</div>
                <h1>Master Your Attention</h1>
                <p>Join 892 students building laser-sharp focus through gamified attention training, mindfulness challenges, and cognitive performance tracking.</p>
                
                <div class="focus-stats">
                    <div class="focus-stat">
                        <span class="stat-number" id="live-focusers">892</span>
                        <span class="stat-label">Students Focusing</span>
                    </div>
                    <div class="focus-stat">
                        <span class="stat-number" id="active-sessions">47</span>
                        <span class="stat-label">Active Sessions</span>
                    </div>
                    <div class="focus-stat">
                        <span class="stat-number" id="minutes-today">2,847</span>
                        <span class="stat-label">Minutes Today</span>
                    </div>
                </div>
 
                <div class="hero-buttons">
                    <a href="#focus-timer" class="btn btn-primary">Start Focus Session</a>
                    <a href="#games" class="btn btn-secondary">Play Brain Games</a>
                </div>
            </div>
        </section>
 
        <!-- Interactive Focus Timer -->
        <section class="focus-timer-section fade-in-up">
            <div class="timer-container" id="focus-timer">
                <h2 class="section-heading">Focus Timer</h2>
                <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 2rem;">Choose your focus technique and build your concentration streak. Track your progress and compete with peers!</p>
                
                <div class="timer-modes">
                    <div class="timer-mode active" onclick="selectMode('pomodoro')" data-mode="pomodoro">
                        Pomodoro (25 min)
                    </div>
                    <div class="timer-mode" onclick="selectMode('deep')" data-mode="deep">
                        Deep Focus (50 min)
                    </div>
                    <div class="timer-mode" onclick="selectMode('sprint')" data-mode="sprint">
                        Sprint (15 min)
                    </div>
                    <div class="timer-mode" onclick="selectMode('custom')" data-mode="custom">
                        Custom
                    </div>
                </div>
 
                <div class="timer-display" id="timer-display">25:00</div>
                
                <div class="timer-controls">
                    <button class="timer-btn start" id="start-btn" onclick="startTimer()">
                        <i class="fas fa-play"></i> Start Focus
                    </button>
                    <button class="timer-btn pause" id="pause-btn" onclick="pauseTimer()" style="display: none;">
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="timer-btn stop" id="stop-btn" onclick="stopTimer()" style="display: none;">
                        <i class="fas fa-stop"></i> Stop
                    </button>
                </div>
 
                <div class="session-info">
                    <h4 style="color: #f39c12; margin-bottom: 1rem; text-align: center;">Today's Focus Progress</h4>
                    <div class="session-stats">
                        <div class="session-stat">
                            <span class="value" id="sessions-today">0</span>
                            <span class="label">Sessions</span>
                        </div>
                        <div class="session-stat">
                            <span class="value" id="total-minutes">0</span>
                            <span class="label">Minutes</span>
                        </div>
                        <div class="session-stat">
                            <span class="value" id="current-streak">7</span>
                            <span class="label">Day Streak</span>
                        </div>
                        <div class="session-stat">
                            <span class="value" id="focus-score">0</span>
                            <span class="label">Focus Score</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interactive Attention Training Games -->
        <section class="attention-games fade-in-up" id="games">
            <div class="games-container">
                <h2 class="section-heading">Brain Training Games</h2>
                <p style="text-align: center; color: rgba(255, 255, 255, 0.8); margin-bottom: 2rem;">Level up your cognitive abilities with scientifically-backed brain training games. Click any game to start training!</p>
                
                <div class="games-grid">
                    <div class="game-card" onclick="openGame('stroop')">
                        <div class="game-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <h3>Stroop Challenge</h3>
                        <div class="game-description">
                            Test your cognitive flexibility by naming colors while ignoring word meanings. Builds selective attention and mental agility.
                        </div>
                        <div class="game-actions">
                            <button class="btn btn-primary">Play Now</button>
                        </div>
                    </div>
 
                    <div class="game-card" onclick="openGame('nback')">
                        <div class="game-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h3>N-Back Memory</h3>
                        <div class="game-description">
                            Train working memory by identifying when current stimulus matches one from N steps back. Scientifically proven to boost IQ.
                        </div>
                        <div class="game-actions">
                            <button class="btn btn-primary">Train Memory</button>
                        </div>
                    </div>
 
                    <div class="game-card" onclick="openGame('mindfulness')">
                        <div class="game-icon">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <h3>Mindful Breathing</h3>
                        <div class="game-description">
                            Interactive breathing exercises with biofeedback. Build mindfulness and emotional regulation skills through guided practice.
                        </div>
                        <div class="game-actions">
                            <button class="btn btn-primary">Start Breathing</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Game Overlay Modal -->
        <div class="game-overlay" id="game-overlay">
            <div class="game-modal">
                <button class="close-game" onclick="closeGame()">&times;</button>
                <div id="game-content">
                    <!-- Game content will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-content">
                <ul class="footer-links">
                    <li><a href="privacy.html">Privacy Policy</a></li>
                    <li><a href="terms.html">Terms of Service</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>
                <p class="copyright">&copy; 2025 Vivify. Building elite habits, one day at a time.</p>
            </div>
        </footer>
    </div>
    <script src="js/unified-leaderboard.js"></script>
    <script>
        // Timer Variables
        let timerInterval;
        let currentMode = 'pomodoro';
        let timeRemaining = 25 * 60;
        let isTimerRunning = false;
        let sessionTime = 0;

        const timeModes = {
            pomodoro: 25 * 60,
            deep: 50 * 60,
            sprint: 15 * 60,
            custom: 25 * 60
        };

        // Enhanced Game System with Anti-Gaming Mechanics
        let currentGame = null;
        let gameScore = 0;
        let gameLevel = 1;
        let gameCooldowns = {}; // Track when each game was last played
        let gameMultipliers = {}; // Track diminishing returns for each game

        // Initialize game stats
        function initializeGameStats() {
            const gameStats = localStorage.getItem('gameStats');
            if (gameStats) {
                const stats = JSON.parse(gameStats);
                gameCooldowns = stats.cooldowns || {};
                gameMultipliers = stats.multipliers || {};
            } else {
                gameCooldowns = {};
                gameMultipliers = {};
            }
        }

        // Global Leaderboard Integration
        function updateGlobalLeaderboard(points, gameType) {
            try {
                // Get current leaderboard data
                const leaderboardData = JSON.parse(localStorage.getItem('globalLeaderboard') || '[]');
                const username = localStorage.getItem('username') || 'Anonymous';
                const school = localStorage.getItem('userSchool') || 'Knox Grammar';
                
                // Find existing user or create new entry
                let userEntry = leaderboardData.find(entry => entry.username === username);
                if (!userEntry) {
                    userEntry = {
                        username: username,
                        school: school,
                        totalPoints: 0,
                        focusMinutes: parseInt(document.getElementById('total-minutes').textContent) || 0,
                        streak: parseInt(document.getElementById('current-streak').textContent) || 0,
                        gamesPlayed: 0,
                        lastActive: Date.now()
                    };
                    leaderboardData.push(userEntry);
                }
                
                // Update user stats
                userEntry.totalPoints += points;
                userEntry.gamesPlayed += 1;
                userEntry.focusMinutes = parseInt(document.getElementById('total-minutes').textContent) || 0;
                userEntry.lastActive = Date.now();
                
                // Sort leaderboard
                leaderboardData.sort((a, b) => b.totalPoints - a.totalPoints);
                
                // Save updated leaderboard
                localStorage.setItem('globalLeaderboard', JSON.stringify(leaderboardData));
                
                console.log(`${points} points added to global leaderboard for ${gameType}`);
                
            } catch (error) {
                console.error('Error updating global leaderboard:', error);
            }
        }

        // Anti-Gaming Point Calculation
        function calculatePoints(basePoints, gameType, accuracy) {
            const now = Date.now();
            const lastPlayed = gameCooldowns[gameType] || 0;
            const timeSinceLastPlay = now - lastPlayed;
            
            // Cooldown system: reduced points if played too recently
            const cooldownPenalty = Math.min(timeSinceLastPlay / (30 * 60 * 1000), 1); // 30 minute full recovery
            
            // Diminishing returns: each play of same game type gives fewer points
            const playCount = gameMultipliers[gameType] || 0;
            const diminishingReturns = Math.max(0.1, 1 - (playCount * 0.1)); // Min 10% of original points
            
            // Accuracy bonus
            const accuracyBonus = Math.max(0.5, accuracy / 100); // 50% to 100% based on accuracy
            
            // Calculate final points
            const finalPoints = Math.floor(basePoints * cooldownPenalty * diminishingReturns * accuracyBonus);
            
            // Update tracking
            gameCooldowns[gameType] = now;
            gameMultipliers[gameType] = (gameMultipliers[gameType] || 0) + 1;
            
            // Save to localStorage
            localStorage.setItem('gameStats', JSON.stringify({
                cooldowns: gameCooldowns,
                multipliers: gameMultipliers
            }));
            
            return {
                points: finalPoints,
                cooldownPenalty: cooldownPenalty,
                diminishingReturns: diminishingReturns,
                accuracyBonus: accuracyBonus
            };
        }

        // Check if game is on cooldown
        function isGameOnCooldown(gameType) {
            const now = Date.now();
            const lastPlayed = gameCooldowns[gameType] || 0;
            const timeSinceLastPlay = now - lastPlayed;
            const cooldownTime = 5 * 60 * 1000; // 5 minutes minimum cooldown
            
            return timeSinceLastPlay < cooldownTime;
        }

        function getRemainingCooldown(gameType) {
            const now = Date.now();
            const lastPlayed = gameCooldowns[gameType] || 0;
            const timeSinceLastPlay = now - lastPlayed;
            const cooldownTime = 5 * 60 * 1000; // 5 minutes
            
            return Math.max(0, cooldownTime - timeSinceLastPlay);
        }

        // Timer Functions
        function selectMode(mode) {
            if (isTimerRunning) return;
            
            currentMode = mode;
            timeRemaining = timeModes[mode];
            
            document.querySelectorAll('.timer-mode').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            updateTimerDisplay();
            
            if (mode === 'custom') {
                const customTime = prompt('Enter focus time in minutes:', '25');
                if (customTime && !isNaN(customTime)) {
                    timeRemaining = parseInt(customTime) * 60;
                    timeModes.custom = timeRemaining;
                    updateTimerDisplay();
                }
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            if (isTimerRunning) return;
            
            isTimerRunning = true;
            sessionTime = timeRemaining;
            
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('pause-btn').style.display = 'inline-block';
            document.getElementById('stop-btn').style.display = 'inline-block';
            
            document.getElementById('timer-display').classList.add('breathing');
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    completeSession();
                }
            }, 1000);
        }

        function pauseTimer() {
            if (!isTimerRunning) return;
            
            isTimerRunning = false;
            clearInterval(timerInterval);
            
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('start-btn').innerHTML = '<i class="fas fa-play"></i> Resume';
            document.getElementById('pause-btn').style.display = 'none';
            
            document.getElementById('timer-display').classList.remove('breathing');
        }

        function stopTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            
            timeRemaining = timeModes[currentMode];
            updateTimerDisplay();
            
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('start-btn').innerHTML = '<i class="fas fa-play"></i> Start Focus';
            document.getElementById('pause-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'none';
            
            document.getElementById('timer-display').classList.remove('breathing');
        }

        // FIXED: Timer completion
        function completeSession() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            
            const completedMinutes = Math.floor(sessionTime / 60);
            const timerPoints = completedMinutes * 3;
            
            // ONLY update non-point displays locally
            const sessionsEl = document.getElementById('sessions-today');
            const minutesEl = document.getElementById('total-minutes');
            
            sessionsEl.textContent = parseInt(sessionsEl.textContent) + 1;
            minutesEl.textContent = parseInt(minutesEl.textContent) + completedMinutes;
            
            // CRITICAL FIX: Let unified leaderboard handle the points
            addPointsToLeaderboard(timerPoints, 'focus_timer');
            
            alert(`Focus Session Complete!\n\n${completedMinutes} minutes of deep focus\n+${timerPoints} focus points earned`);
            stopTimer();
        }

        // Enhanced Game System
        function openGame(gameType) {
            // Check cooldown
            if (isGameOnCooldown(gameType)) {
                const remainingTime = getRemainingCooldown(gameType);
                const minutes = Math.floor(remainingTime / 60000);
                const seconds = Math.floor((remainingTime % 60000) / 1000);
                
                alert(`Game on cooldown! Wait ${minutes}:${seconds.toString().padStart(2, '0')} before playing again.\n\nThis prevents point farming and encourages diverse training.`);
                return;
            }
            
            currentGame = gameType;
            gameScore = 0;
            gameLevel = 1;
            
            const overlay = document.getElementById('game-overlay');
            const content = document.getElementById('game-content');
            
            overlay.style.display = 'flex';
            
            switch(gameType) {
                case 'stroop':
                    startStroopGame(content);
                    break;
                case 'nback':
                    startNBackGame(content);
                    break;
                case 'mindfulness':
                    startMindfulnessExercise(content);
                    break;
            }
        }

        function closeGame() {
            document.getElementById('game-overlay').style.display = 'none';
            currentGame = null;
        }

        // Enhanced Stroop Game with Progressive Difficulty
        function startStroopGame(container) {
            const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
            const colorWords = ['RED', 'BLUE', 'GREEN', 'YELLOW', 'PURPLE'];
            
            let currentWord = '';
            let currentColor = '';
            let correctAnswers = 0;
            let totalQuestions = 0;
            let startTime = Date.now();
            let questionStartTime = Date.now();
            let reactionTimes = [];
            let gameActive = true;
            
            // Progressive difficulty
            const maxQuestions = 10;
            const timeLimit = 8000; // 8 seconds per question instead of 2-5 seconds
            
            function newStroopQuestion() {
                if (!gameActive || totalQuestions >= maxQuestions) return;
                
                questionStartTime = Date.now();
                
                currentWord = colorWords[Math.floor(Math.random() * colorWords.length)];
                currentColor = colors[Math.floor(Math.random() * colors.length)];
                
                container.innerHTML = `
                    <h3>Stroop Challenge - Level ${gameLevel}</h3>
                    <div class="game-instructions">
                        Click the COLOR of the word, not what the word says!<br>
                        <small>Time limit: ${(timeLimit/1000).toFixed(0)}s per question</small>
                    </div>
                    <div class="stroop-word" style="color: ${currentColor}">${currentWord}</div>
                    <div class="color-buttons">
                        ${colors.map(color => 
                            `<button class="color-btn" style="background: ${color}; color: white;" onclick="stroopAnswer('${color}')">${color.toUpperCase()}</button>`
                        ).join('')}
                    </div>
                    <div class="game-score">
                        <div class="score-value">${correctAnswers}/${totalQuestions}</div>
                        <div class="score-label">Correct Answers</div>
                    </div>
                    <div style="margin-top: 1rem; color: rgba(255,255,255,0.7);">
                        Average reaction time: ${reactionTimes.length > 0 ? (reactionTimes.reduce((a,b) => a+b, 0) / reactionTimes.length / 1000).toFixed(2) : '0.00'}s
                    </div>
                `;
                
                // FIXED: Auto-advance only after reasonable time limit
                setTimeout(() => {
                    if (gameActive && currentGame === 'stroop' && totalQuestions < maxQuestions) {
                        stroopAnswer('timeout');
                    }
                }, timeLimit);
            }
            
            window.stroopAnswer = function(selectedColor) {
                if (!gameActive) return;
                
                const reactionTime = Date.now() - questionStartTime;
                totalQuestions++;
                
                if (selectedColor === currentColor && selectedColor !== 'timeout') {
                    correctAnswers++;
                    reactionTimes.push(reactionTime);
                }
                
                if (totalQuestions >= maxQuestions) {
                    gameActive = false;
                    endStroopGame();
                } else {
                    // FIXED: Reasonable delay between questions
                    setTimeout(newStroopQuestion, 1500); // 1.5 seconds between questions
                }
            };
            
            function endStroopGame() {
                gameActive = false;
                const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
                const avgReactionTime = reactionTimes.length > 0 ? 
                    (reactionTimes.reduce((a,b) => a+b, 0) / reactionTimes.length / 1000).toFixed(2) : 'N/A';
                
                // FIXED: Proper point calculation and global leaderboard sync
                const basePoints = 50;
                const pointsResult = calculatePoints(basePoints, 'stroop', accuracy);
                
                // Update local score AND sync to global leaderboard properly
                const scoreEl = document.getElementById('focus-score');
                const newLocalScore = parseInt(scoreEl.textContent) + pointsResult.points;
                scoreEl.textContent = newLocalScore;
                
                // CRITICAL FIX: Properly sync to global leaderboard
                addPointsToLeaderboard(pointsResult.points, 'brain_training');
                
                container.innerHTML = `
                    <h3>Stroop Challenge Complete!</h3>
                    <div class="game-score">
                        <div class="score-value">${accuracy}%</div>
                        <div class="score-label">Accuracy</div>
                    </div>
                    <p>Level ${gameLevel}  ${correctAnswers}/${totalQuestions} correct</p>
                    <p>Average reaction time: ${avgReactionTime}s</p>
                    <p><strong>+${pointsResult.points} focus points earned</strong></p>
                    
                    ${pointsResult.cooldownPenalty < 1 ? `
                        <div class="cooldown-notice">
                            Cooldown penalty: ${Math.round((1 - pointsResult.cooldownPenalty) * 100)}% point reduction<br>
                            Wait longer between games for full points!
                        </div>
                    ` : ''}
                    
                    <button class="btn btn-primary" onclick="gameLevel++; startStroopGame(document.getElementById('game-content'))">Next Level</button>
                    <button class="btn btn-secondary" onclick="closeGame()">Close</button>
                `;
            }
            
            gameActive = true;
            newStroopQuestion();
        }

        // Enhanced N-Back Game with Progressive Difficulty
        function startNBackGame(container) {
            let sequence = [];
            let currentStep = 0;
            let nBack = Math.min(2 + Math.floor(gameLevel / 3), 4); // Increase n-back level
            let correctAnswers = 0;
            let totalQuestions = 0;
            let startTime = Date.now();
            
            function generateSequence() {
                sequence = [];
                const sequenceLength = 15 + (gameLevel * 5); // Longer sequences at higher levels
                for (let i = 0; i < sequenceLength; i++) {
                    sequence.push(Math.floor(Math.random() * 9));
                }
                currentStep = 0;
            }
            
            function showNextStep() {
                if (currentStep >= sequence.length) {
                    endNBackGame();
                    return;
                }
                
                const currentPosition = sequence[currentStep];
                const isMatch = currentStep >= nBack && sequence[currentStep] === sequence[currentStep - nBack];
                
                container.innerHTML = `
                    <h3>N-Back Memory Training - Level ${gameLevel}</h3>
                    <div class="game-instructions">
                        Remember the position ${nBack} steps back. Click if current position matches!<br>
                        <small>Step ${currentStep + 1} of ${sequence.length}</small>
                    </div>
                    <div class="nback-grid">
                        ${Array.from({length: 9}, (_, i) => 
                            `<div class="nback-cell ${i === currentPosition ? 'active' : ''}" data-position="${i}"></div>`
                        ).join('')}
                    </div>
                    <div style="margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="nbackAnswer(true)">MATCH</button>
                        <button class="btn btn-secondary" onclick="nbackAnswer(false)">NO MATCH</button>
                    </div>
                    <div class="game-score">
                        <div class="score-value">${correctAnswers}/${totalQuestions}</div>
                        <div class="score-label">Correct</div>
                    </div>
                `;
                
                window.nbackAnswer = function(userSaysMatch) {
                    const actualMatch = currentStep >= nBack && sequence[currentStep] === sequence[currentStep - nBack];
                    totalQuestions++;
                    
                    if (userSaysMatch === actualMatch) {
                        correctAnswers++;
                    }
                    
                    currentStep++;
                    setTimeout(showNextStep, 1000 - (gameLevel * 50)); // Faster at higher levels
                };
            }
            
            function endNBackGame() {
                const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
                
                // Calculate points with anti-gaming mechanics
                const basePoints = 75; // Higher base points for harder game
                const pointsResult = calculatePoints(basePoints, 'nback', accuracy);
                
                // Update local score
                const scoreEl = document.getElementById('focus-score');
                scoreEl.textContent = parseInt(scoreEl.textContent) + pointsResult.points;
                
                // Update global leaderboard
                addPointsToLeaderboard(pointsResult.points, 'nback');
                
                container.innerHTML = `
                    <h3>N-Back Training Complete!</h3>
                    <div class="game-score">
                        <div class="score-value">${accuracy}%</div>
                        <div class="score-label">Accuracy</div>
                    </div>
                    <p>Level ${gameLevel}  ${nBack}-Back  ${correctAnswers}/${totalQuestions} correct</p>
                    <p><strong>+${pointsResult.points} focus points earned</strong></p>
                    
                    ${pointsResult.cooldownPenalty < 1 ? `
                        <div class="cooldown-notice">
                            Cooldown penalty: ${Math.round((1 - pointsResult.cooldownPenalty) * 100)}% point reduction
                        </div>
                    ` : ''}
                    
                    <button class="btn btn-primary" onclick="gameLevel++; startNBackGame(document.getElementById('game-content'))">Next Level</button>
                    <button class="btn btn-secondary" onclick="closeGame()">Close</button>
                `;
            }
            
            generateSequence();
            showNextStep();
        }

        // Mindfulness Exercise (Points for completion, not spammable)
        function startMindfulnessExercise(container) {
            let phase = 'prepare';
            let cycleCount = 0;
            let maxCycles = 8 + (gameLevel * 2); // More cycles at higher levels
            let breathingInterval;
            let sessionStartTime = Date.now();
            
            function updateBreathing() {
                const circle = container.querySelector('.breathing-circle');
                const text = container.querySelector('.breathing-text');
                
                if (phase === 'prepare') {
                    text.textContent = 'Get Ready...';
                    phase = 'inhale';
                    setTimeout(() => updateBreathing(), 2000);
                    return;
                }
                
                if (phase === 'inhale') {
                    circle.className = 'breathing-circle inhale';
                    text.textContent = 'Breathe In...';
                    setTimeout(() => {
                        phase = 'exhale';
                        updateBreathing();
                    }, 4000);
                } else if (phase === 'exhale') {
                    circle.className = 'breathing-circle exhale';
                    text.textContent = 'Breathe Out...';
                    setTimeout(() => {
                        cycleCount++;
                        if (cycleCount >= maxCycles) {
                            endMindfulness();
                        } else {
                            phase = 'inhale';
                            updateBreathing();
                        }
                    }, 4000);
                }
            }
            
            function endMindfulness() {
                const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
                const completionRate = 100; // Assume 100% completion for mindfulness
                
                // Calculate points - mindfulness gives consistent points, less affected by spam
                const basePoints = 40;
                const pointsResult = calculatePoints(basePoints, 'mindfulness', completionRate);
                
                // Update local score
                const scoreEl = document.getElementById('focus-score');
                scoreEl.textContent = parseInt(scoreEl.textContent) + pointsResult.points;
                
                // Update global leaderboard
                addPointsToLeaderboard(pointsResult.points, 'mindfulness');
                container.innerHTML = `
                    <h3>Mindfulness Session Complete!</h3>
                    <div class="game-score">
                        <div class="score-value">${cycleCount}</div>
                        <div class="score-label">Breath Cycles</div>
                    </div>
                    <p>Level ${gameLevel}  ${cycleCount} mindful breaths in ${sessionDuration}s</p>
                    <p><strong>+${pointsResult.points} focus points earned</strong></p>
                    
                    ${pointsResult.cooldownPenalty < 1 ? `
                        <div class="cooldown-notice">
                            Mindfulness is most effective when practiced consistently, not rushed.
                        </div>
                    ` : ''}
                    
                    <button class="btn btn-primary" onclick="gameLevel++; startMindfulnessExercise(document.getElementById('game-content'))">Deeper Practice</button>
                    <button class="btn btn-secondary" onclick="closeGame()">Close</button>
                `;
            }
            
            container.innerHTML = `
                <h3>Mindful Breathing Exercise - Level ${gameLevel}</h3>
                <div class="game-instructions">
                    Follow the circle's rhythm. Breathe in when it expands, out when it contracts.<br>
                    <small>${maxCycles} breath cycles for level ${gameLevel}</small>
                </div>
                <div class="breathing-circle">
                    <div class="breathing-inner"></div>
                    <div class="breathing-text">Get Ready...</div>
                </div>
                <div class="game-score">
                    <div class="score-value">${cycleCount}/${maxCycles}</div>
                    <div class="score-label">Breath Cycles</div>
                </div>
            `;
            
            setTimeout(() => {
                updateBreathing();
            }, 2000);
        }

        // UNIFIED LEADERBOARD SYNC - Add this to attention training page
        // FIXED: Proper Global Leaderboard Integration
        function addPointsToLeaderboard(points, activityType) {
            if (!window.VivifyLeaderboard) {
                console.error('VivifyLeaderboard not available');
                return false;
            }
            
            // Add points locally
            const success = window.VivifyLeaderboard.addPoints(points, activityType, {
                focusMinutes: parseInt(document.getElementById('total-minutes')?.textContent || '0')
            });
            
            if (success) {
                // ALSO sync to backend so database stays current
                syncPointsToBackend(points, activityType);
                console.log(`Successfully added ${points} points for ${activityType}`);
            }
            
            return success;
        }

        // Helper function to update leaderboards visible on current page
        function updateVisibleLeaderboards() {
            // This will update any leaderboard displays on the current page
            const leaderboardList = document.getElementById('focus-leaderboard-list');
            if (leaderboardList) {
                displayGlobalLeaderboard();
            }
        }

        // Enhanced function to display global leaderboard
        function displayGlobalLeaderboard() {
            const leaderboardList = document.getElementById('focus-leaderboard-list');
            if (!leaderboardList) return;
            
            const globalLeaderboard = JSON.parse(localStorage.getItem('globalLeaderboard') || '[]');
            const currentUsername = localStorage.getItem('username');
            
            if (globalLeaderboard.length === 0) {
                leaderboardList.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: rgba(255,255,255,0.6);">
                        <p>No players yet. Be the first to earn points!</p>
                    </div>
                `;
                return;
            }
            
            leaderboardList.innerHTML = '';
            
            // Show top 10 players
            const top10 = globalLeaderboard.slice(0, 10);
            
            top10.forEach((entry, index) => {
                const isCurrentUser = entry.username === currentUsername;
                const rank = index + 1;
                
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                if (isCurrentUser) {
                    item.style.border = '2px solid #f39c12';
                    item.style.background = 'rgba(243, 156, 18, 0.1)';
                }
                
                let rankStyle = '#f39c12';
                if (rank === 1) rankStyle = '#ffd700';
                else if (rank === 2) rankStyle = '#c0c0c0';
                else if (rank === 3) rankStyle = '#cd7f32';
                
                item.innerHTML = `
                    <div class="rank" style="color: ${rankStyle}">${rank}</div>
                    <div class="player-avatar">${entry.username.charAt(0).toUpperCase()}</div>
                    <div class="player-info">
                        <div class="player-name">${entry.displayName || entry.username}${isCurrentUser ? ' (You)' : ''}</div>
                        <div class="player-school">${entry.school || 'Knox Grammar'}</div>
                    </div>
                    <div class="player-stats">
                        <div class="focus-time">${entry.totalPoints || 0} pts</div>
                        <div class="streak-count">Level ${entry.level || 1}</div>
                    </div>
                `;
                
                leaderboardList.appendChild(item);
            });
            
            // If current user isn't in top 10, show their position at bottom
            const userIndex = globalLeaderboard.findIndex(entry => entry.username === currentUsername);
            if (userIndex > 9) {
                const userEntry = globalLeaderboard[userIndex];
                const separator = document.createElement('div');
                separator.style.cssText = 'border-top: 1px solid rgba(255,255,255,0.2); margin: 1rem 0; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.8rem;';
                separator.textContent = '...';
                leaderboardList.appendChild(separator);
                
                const userItem = document.createElement('div');
                userItem.className = 'leaderboard-item';
                userItem.style.border = '2px solid #f39c12';
                userItem.style.background = 'rgba(243, 156, 18, 0.1)';
                
                userItem.innerHTML = `
                    <div class="rank" style="color: #f39c12">${userIndex + 1}</div>
                    <div class="player-avatar">${userEntry.username.charAt(0).toUpperCase()}</div>
                    <div class="player-info">
                        <div class="player-name">${userEntry.displayName || userEntry.username} (You)</div>
                        <div class="player-school">${userEntry.school || 'Knox Grammar'}</div>
                    </div>
                    <div class="player-stats">
                        <div class="focus-time">${userEntry.totalPoints || 0} pts</div>
                        <div class="streak-count">Level ${userEntry.level || 1}</div>
                    </div>
                `;
                
                leaderboardList.appendChild(userItem);
            }
        }

        // Mobile Menu Functions
        function createMobileMenu() {
            if (window.innerWidth > 768) return;
            
            const authToken = localStorage.getItem('authToken');
            const userLoggedIn = localStorage.getItem('userLoggedIn');
            const isLoggedIn = !!(authToken || userLoggedIn === 'true');
            const username = localStorage.getItem('username') || 'User';
            
            if (!document.getElementById('mobile-menu')) {
                const header = document.querySelector('header');
                const mobileMenu = document.createElement('div');
                mobileMenu.id = 'mobile-menu';
                mobileMenu.className = 'mobile-menu';
                
                let authMenuItems = '';
                if (isLoggedIn) {
                    authMenuItems = `
                        <div class="mobile-menu-divider"></div>
                        <div class="mobile-user-info">
                            <span style="color: #f39c12; font-weight: 600; padding: 0.5rem 0;">Welcome, ${username}!</span>
                        </div>
                        <a href="dashboard.html" class="mobile-menu-link mobile-cta">Dashboard</a>
                        <a href="profile.html" class="mobile-menu-link">Profile</a>
                        <a href="#" class="mobile-menu-link" onclick="handleMobileLogout(event)">Logout</a>
                    `;
                } else {
                    authMenuItems = `
                        <div class="mobile-menu-divider"></div>
                        <a href="login.html" class="mobile-menu-link">Login</a>
                        <a href="signup.html" class="mobile-menu-link mobile-cta">Start Training</a>
                    `;
                }
                
                mobileMenu.innerHTML = `
                    <div class="mobile-menu-content">
                        <div class="mobile-menu-header">
                            <div class="logo"><a href="index.html">Vivify</a></div>
                            <button class="mobile-menu-close" onclick="closeMobileMenu()"></button>
                        </div>
                        <div class="mobile-menu-links">
                            <a href="index.html" class="mobile-menu-link">Home</a>
                            <a href="index.html#training" class="mobile-menu-link">Training Areas</a>
                            <a href="index.html#habits" class="mobile-menu-link">Habits & Challenges</a>
                            <a href="about.html" class="mobile-menu-link">About</a>
                            <a href="community.html" class="mobile-menu-link">Community</a>
                            ${authMenuItems}
                        </div>
                    </div>
                `;
                header.appendChild(mobileMenu);
            }
            
            if (!document.getElementById('mobile-menu-btn')) {
                const nav = document.querySelector('nav');
                const rightNav = nav.querySelector('.right-nav') || nav;
                const mobileBtn = document.createElement('button');
                mobileBtn.id = 'mobile-menu-btn';
                mobileBtn.className = 'mobile-menu-btn';
                mobileBtn.onclick = toggleMobileMenu;
                mobileBtn.innerHTML = `
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                `;
                rightNav.appendChild(mobileBtn);
            }
        }

        function handleMobileLogout(event) {
            event.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                closeMobileMenu();
                window.location.reload();
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('mobile-menu-btn');
            
            menu.classList.toggle('active');
            btn.classList.toggle('active');
            
            if (menu.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('mobile-menu-btn');
            
            menu.classList.remove('active');
            btn.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Page loading...');
            
            // Check authentication
            const userLoggedIn = localStorage.getItem('userLoggedIn');
                const userProfile = JSON.parse(localStorage.getItem('userProfile') || '{}');
                const username = localStorage.getItem('username');
            
                if (userLoggedIn !== 'true' || !username) {
                    console.log('User not logged in, redirecting...');
                    window.location.href = 'login.html';
                    return;
                }
            
                document.getElementById('login-link').style.display = 'none';
                document.getElementById('signup-link').style.display = 'none';
                document.getElementById('dashboard-link').classList.remove('hidden');
                document.getElementById('profile-link').classList.remove('hidden');
                document.getElementById('logout-link').classList.remove('hidden');
            
            console.log('User authenticated:', username);
            
            // Initialize unified leaderboard FIRST
            if (window.VivifyLeaderboard) {
                window.VivifyLeaderboard.initialize(userProfile.id || username, username, 'Knox Grammar');
                
                // Wait a moment for initialization
                setTimeout(() => {
                    // NOW update displays
                    updateChallengeStats(); // On challenges page
                    // OR sync displays for attention training
                    if (window.VivifyLeaderboard.syncAllDisplays) {
                        window.VivifyLeaderboard.syncAllDisplays();
                    }
                }, 500);

                // Listen for updates
                window.VivifyLeaderboard.onUpdate((data) => {
                    console.log('Leaderboard updated:', data);
                    
                    // Update displays based on which page we're on
                    if (document.getElementById('leaderboardList')) {
                        // Challenges page
                        window.VivifyLeaderboard.displayForChallengesPage('leaderboardList');
                    }
                    if (document.getElementById('focus-leaderboard-list')) {
                        // Attention training page  
                        window.VivifyLeaderboard.displayForAttentionTraining('focus-leaderboard-list');
                    }
                });
                
                console.log('Unified leaderboard initialized');
            } else {
                console.error('VivifyLeaderboard not available');
            }
            
            // Rest of your existing initialization code...
            // (Keep all your existing code for mobile menu, logout, etc.)
        });

        // Add this function to sync points to backend
        async function syncPointsToBackend(points, activityType) {
            try {
                const userId = localStorage.getItem('username');
                const authToken = localStorage.getItem('authToken');
                
                const response = await fetch('https://vivify-backend.onrender.com/api/users/update-score', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        userId: userId,
                        pointsToAdd: points,
                        activityType: activityType
                    })
                });
                
                if (response.ok) {
                    console.log(`Synced ${points} points to backend for ${activityType}`);
                    return true;
                } else {
                    console.error('Failed to sync points to backend');
                    return false;
                }
            } catch (error) {
                console.error('Error syncing points to backend:', error);
                return false;
            }
        }

        // Daily cooldown reset
        function showDailyCooldownReset() {
            const lastResetDate = localStorage.getItem('lastCooldownReset');
            const today = new Date().toDateString();
            
            if (lastResetDate !== today) {
                // Reset daily multipliers but keep overall game stats
                const gameStats = JSON.parse(localStorage.getItem('gameStats') || '{}');
                gameStats.multipliers = {}; // Reset diminishing returns daily
                localStorage.setItem('gameStats', JSON.stringify(gameStats));
                localStorage.setItem('lastCooldownReset', today);
                
                if (lastResetDate) { // Don't show on first visit
                    setTimeout(() => {
                        alert('Daily reset! Game multipliers refreshed. Start training for full points!');
                    }, 2000);
                }
            }
        }

        function animateStats() {
            const baseStats = {
                focusers: 892,
                activeSessions: 47,
                minutesToday: 2847
            };
            
            setInterval(() => {
                const variation = () => Math.floor(Math.random() * 8) - 4;
                document.getElementById('live-focusers').textContent = baseStats.focusers + variation();
                document.getElementById('active-sessions').textContent = Math.max(0, baseStats.activeSessions + variation());
                document.getElementById('minutes-today').textContent = baseStats.minutesToday + Math.abs(variation() * 10);
            }, 20000);
        }

        // Responsive handling
        window.addEventListener('leaderboardUpdated', function(event) {
            console.log('Leaderboard update received:', event.detail);
            
            // Force refresh the leaderboard display
            const challengesLeaderboard = JSON.parse(localStorage.getItem('challengesLeaderboard') || '[]');
            
            if (challengesLeaderboard.length > 0) {
                // Update the challenges page leaderboard display
                updateChallengesLeaderboardDisplay(challengesLeaderboard);
            }
        });

        // Function to update the challenges page leaderboard display
        function updateChallengesLeaderboardDisplay(leaderboard) {
            const list = document.getElementById('leaderboardList');
            if (!list) return;
            
            const username = localStorage.getItem('username');
            
            list.innerHTML = '';
            const top10 = leaderboard.slice(0, 10);
            
            top10.forEach((entry, idx) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                if (entry.username === username) {
                    item.classList.add('current-user');
                }
                
                let icon = '<i class="fas fa-user"></i>';
                if (idx === 0) icon = '<i class="fas fa-crown" style="color:#f39c12;"></i>';
                else if (idx === 1) icon = '<i class="fas fa-medal" style="color:#c0c0c0;"></i>';
                else if (idx === 2) icon = '<i class="fas fa-medal" style="color:#cd7f32;"></i>';
                
                const isCurrentUser = entry.username === username;
                const displayName = entry.displayName || entry.username || 'Student';
                
                item.innerHTML = `
                    <div class="leaderboard-rank">${idx + 1}</div>
                    <div class="leaderboard-avatar">${icon}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${displayName}${isCurrentUser ? ' (You)' : ''}</div>
                        <div class="leaderboard-school">${entry.school || 'Knox Grammar'}</div>
                    </div>
                    <div class="overall-score">
                        <div class="leaderboard-score">${(entry.overallScore || 0).toLocaleString()}</div>
                        <div class="level-badge">Level ${entry.level || 1}</div>
                    </div>`;
                
                list.appendChild(item);
            });
        }

        // Export functions for debugging (can remove in production)
        window.debugGameStats = function() {
            console.log('Current game stats:', {
                cooldowns: gameCooldowns,
                multipliers: gameMultipliers,
                globalLeaderboard: JSON.parse(localStorage.getItem('globalLeaderboard') || '[]')
            });
        };

        window.resetGameStats = function() {
            localStorage.removeItem('gameStats');
            localStorage.removeItem('globalLeaderboard');
            localStorage.removeItem('lastCooldownReset');
            gameCooldowns = {};
            gameMultipliers = {};
            alert('Game stats reset!');
        };
    </script>
</body>
</html>