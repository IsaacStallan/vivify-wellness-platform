<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Vivify</title>
    
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">

<!-- iOS PWA Support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="performance Hub">
<link rel="apple-touch-icon" href="/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">

<!-- Microsoft Tiles -->
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<meta name="msapplication-TileColor" content="#f39c12">

<!-- Theme Color -->
<meta name="theme-color" content="#f39c12">

<!-- Viewport for PWA -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<!-- Preload PWA installer script -->
<link rel="preload" href="/pwa-install.js" as="script">
<!-- CSS Loading Order Fix -->

<link rel="stylesheet" href="styles.css">

<!-- FOUC Prevention -->
<style>
    html { visibility: hidden; opacity: 0; }
    html.loaded { visibility: visible; opacity: 1; transition: opacity 0.3s ease; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.documentElement.classList.add('loaded');
    });
    window.addEventListener('load', function() {
        document.documentElement.classList.add('loaded');
    });
</script>
<script src="js/vivify-stats.js"></script>
<script src="js/leaderboard-system.js"></script>
</head>
<body>
    <div class="wrapper">
        <header>
            <nav>
                <div class="left-nav">
                    <div class="logo">
                        <a href="index.html"><h1>Vivify</h1></a>
                    </div>
                    <ul>
                        <li><a href="about.html" aria-label="About Us Page">About</a></li>
                    </ul>
                </div>
                <div class="right-nav">
                    <ul>
                        <li><a href="login.html" id="loginLink" aria-label="Login Page">Login</a></li>
                        <li><a href="signup.html" id="signupLink" aria-label="Sign Up Page">Sign Up</a></li>
                    </ul>
                </div>
            </nav>
        </header>

        <main>
            <section class="form-section">
                <div class="form-container">
                    <form id="resetPasswordForm">
                        <h1>Reset Your Password</h1>
                        <p>Please enter your new password below.</p>

                        <label for="password">New Password</label>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            required 
                            placeholder="Enter your new password" 
                            aria-label="New Password">
                        <p class="password-hint">Password must be at least 8 characters, include an uppercase letter, and a number.</p>

                        <label for="confirmPassword">Confirm Password</label>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            required 
                            placeholder="Confirm your new password" 
                            aria-label="Confirm Password">

                        <button type="submit">Reset Password</button>
                    </form>

                    <p id="message" style="display:none;"></p>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 Vivify. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resetPasswordForm = document.getElementById('resetPasswordForm');
            const messageElement = document.getElementById('message');
            
            // Get token from URL
            const token = window.location.pathname.split('/').pop();
            
            resetPasswordForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // Get form values
                const password = document.getElementById('password').value.trim();
                const confirmPassword = document.getElementById('confirmPassword').value.trim();
                
                // Validate passwords
                if (password !== confirmPassword) {
                    messageElement.textContent = 'Passwords do not match.';
                    messageElement.style.color = 'red';
                    messageElement.style.display = 'block';
                    return;
                }
                
                // Validate password complexity
                if (password.length < 8 || !/[A-Z]/.test(password) || !/\d/.test(password)) {
                    messageElement.textContent = 'Password must be at least 8 characters, include an uppercase letter, and a number.';
                    messageElement.style.color = 'red';
                    messageElement.style.display = 'block';
                    return;
                }
                
                try {
                    const response = await fetch(`/auth/reset-password/${token}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ password })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Password reset successful
                        messageElement.textContent = data.message || 'Password reset successful! Redirecting to login page...';
                        messageElement.style.color = 'green';
                        messageElement.style.display = 'block';
                        
                        // Redirect to login page after a delay
                        setTimeout(() => {
                            window.location.href = '/login.html?message=password-reset';
                        }, 3000);
                    } else {
                        // Display error message
                        messageElement.textContent = data.message || 'Failed to reset password. Please try again.';
                        messageElement.style.color = 'red';
                        messageElement.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Password reset error:', error);
                    messageElement.textContent = 'A network error occurred. Please try again.';
                    messageElement.style.color = 'red';
                    messageElement.style.display = 'block';
                }
            });
        });
    </script>

<!-- PWA Scripts -->


<script>
// Additional PWA features for each page
document.addEventListener('DOMContentLoaded', function() {
    // Add PWA-specific styles
    if (window.matchMedia('(display-mode: standalone)').matches) {
        document.body.classList.add('pwa-mode');
        
        // Hide address bar on mobile when in PWA mode
        window.scrollTo(0, 1);
    }
    
    // Handle network status
    function updateOnlineStatus() {
        const statusElement = document.getElementById('network-status');
        if (statusElement) {
            if (navigator.onLine) {
                statusElement.textContent = 'Online';
                statusElement.className = 'online';
            } else {
                statusElement.textContent = 'Offline';
                statusElement.className = 'offline';
            }
        }
    }
    
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();
    
    // Add network status indicator if it doesn't exist
    if (!document.getElementById('network-status')) {
        const statusDiv = document.createElement('div');
        statusDiv.id = 'network-status';
        statusDiv.style.cssText = `
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s ease;
        `;
        document.body.appendChild(statusDiv);
        updateOnlineStatus();
    }
});
</script>
<script src="class-management.js"></script> <script src="js/flexible-mobile-nav.js"></script> </body>
</html>
