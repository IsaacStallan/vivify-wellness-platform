<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Vivify</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
        }

        .form-section {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 6rem 1rem 2rem 1rem; /* Added top padding for header */
        }

        .form-container {
            background: linear-gradient(145deg, #1e1e1e 0%, #2a2a2a 100%);
            border: 1px solid #333;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            margin: auto;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-container h1 {
            color: #ffffff;
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0 0 0.5rem 0;
            text-align: center;
            letter-spacing: -0.02em;
        }

        .form-container > p {
            color: #a0a0a0;
            font-size: 0.95rem;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 0.6rem;
            font-size: 0.9rem;
            letter-spacing: 0.01em;
        }

        .form-group input {
            width: 100%;
            background: #333;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 0.9rem 1rem;
            color: #ffffff;
            font-size: 0.95rem;
            font-weight: 400;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #f39c12;
            background: #383838;
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
        }

        .form-group input::placeholder {
            color: #888;
            font-weight: 400;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: #000;
            border: none;
            border-radius: 10px;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 1.25rem 0;
            letter-spacing: 0.01em;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.4);
       }

       .submit-btn:active {
           transform: translateY(0);
       }

       .submit-btn:disabled {
           opacity: 0.6;
           cursor: not-allowed;
           transform: none;
           box-shadow: none;
       }

       .loading {
           opacity: 0.7;
           pointer-events: none;
       }

       .success-message {
           background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
           color: white;
           padding: 1rem;
           border-radius: 10px;
           margin: 1rem 0;
           text-align: center;
           font-weight: 500;
           border: 1px solid #2ecc71;
           font-size: 0.9rem;
       }

       .error-message {
           background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
           color: white;
           padding: 1rem;
           border-radius: 10px;
           margin: 1rem 0;
           text-align: center;
           font-weight: 500;
           border: 1px solid #e74c3c;
           font-size: 0.9rem;
       }

       .demo-accounts {
           background: linear-gradient(135deg, #2a2a2a 0%, #333 100%);
           border: 1px solid #444;
           border-radius: 12px;
           padding: 1.25rem;
           margin: 1.5rem 0;
       }

       .demo-accounts h3 {
           color: #f39c12;
           margin: 0 0 1rem 0;
           font-size: 1rem;
           font-weight: 600;
           text-align: center;
       }

       .demo-account {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 0.8rem;
           margin: 0.6rem 0;
           background: linear-gradient(135deg, #383838 0%, #444 100%);
           border: 1px solid #555;
           border-radius: 10px;
           cursor: pointer;
           transition: all 0.3s ease;
       }

       .demo-account:hover {
           background: linear-gradient(135deg, #444 0%, #555 100%);
           border-color: #f39c12;
           transform: translateY(-1px);
       }

       .demo-account span {
           color: #ddd;
           font-size: 0.8rem;
           font-weight: 400;
           flex: 1;
       }

       .demo-account button {
           background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
           color: #000;
           border: none;
           padding: 0.4rem 0.8rem;
           border-radius: 6px;
           font-size: 0.75rem;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.3s ease;
           margin-left: 0.8rem;
       }

       .demo-account button:hover {
           transform: translateY(-1px);
           box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
       }

       .role-badge {
           display: inline-block;
           padding: 0.2rem 0.6rem;
           border-radius: 12px;
           font-size: 0.7rem;
           font-weight: 600;
           margin-left: 0.5rem;
       }

       .role-student {
           background: #3498db;
           color: white;
       }

       .role-teacher {
           background: #9b59b6;
           color: white;
       }

       .role-admin {
           background: #e74c3c;
           color: white;
       }

       .form-footer {
           text-align: center;
           margin-top: 1.5rem;
           padding-top: 1.5rem;
           border-top: 1px solid #333;
       }

       .form-footer p {
           color: #a0a0a0;
           font-size: 0.9rem;
           margin: 0.6rem 0;
       }

       .form-footer a {
           color: #f39c12;
           text-decoration: none;
           font-weight: 600;
           transition: color 0.3s ease;
       }

       .form-footer a:hover {
           color: #e67e22;
       }

       @media (max-width: 768px) {
           .form-section {
               padding: 5rem 1rem 2rem 1rem;
               min-height: calc(100vh - 100px);
           }

           .form-container {
               padding: 2rem 1.5rem;
               margin: 1rem;
               border-radius: 16px;
               max-height: 85vh;
           }

           .form-container h1 {
               font-size: 1.8rem;
           }

           .submit-btn {
               padding: 0.9rem 1.25rem;
               font-size: 0.95rem;
           }

           .demo-account {
               flex-direction: column;
               text-align: center;
               gap: 0.8rem;
           }

           .demo-account button {
               margin-left: 0;
               width: 100%;
           }
       }

       @media (max-width: 480px) {
           .form-section {
               padding: 4rem 0.5rem 1rem 0.5rem;
           }

           .form-container {
               padding: 1.5rem 1rem;
               border-radius: 12px;
           }

           .form-container h1 {
               font-size: 1.6rem;
           }
       }
   </style>

<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">

<!-- iOS PWA Support -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Wellness Hub">
<link rel="apple-touch-icon" href="/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">

<!-- Microsoft Tiles -->
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<meta name="msapplication-TileColor" content="#f39c12">

<!-- Theme Color -->
<meta name="theme-color" content="#f39c12">

<!-- Viewport for PWA -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<!-- Preload PWA installer script -->
<link rel="preload" href="/pwa-install.js" as="script">
</head>
<body>
   <div class="wrapper">
       <header>
           <nav>
               <div class="left-nav">
                   <div class="logo">
                       <a href="index.html"><h1>Vivify</h1></a>
                   </div>
                   <ul>
                       <li><a href="about.html" aria-label="About Us Page">About</a></li>
                   </ul>
               </div>
               <div class="right-nav">
                   <ul>
                       <li><a href="login.html" id="loginLink" class="active" aria-label="Login Page">Login</a></li>
                       <li><a href="signup.html" id="signupLink" aria-label="Sign Up Page">Sign Up</a></li>
                   </ul>
               </div>
           </nav>
       </header>

       <main class="form-section">
           <div class="form-container">
               <h1>Welcome Back</h1>
               <p>Sign in to continue your wellness journey</p>

               <form id="loginForm">
                   <div class="form-group">
                       <label for="email">Email Address</label>
                       <input 
                           type="email" 
                           id="email" 
                           name="email" 
                           required 
                           placeholder="Enter your email" 
                           aria-label="Email">
                   </div>

                   <div class="form-group">
                       <label for="password">Password</label>
                       <input 
                           type="password" 
                           id="password" 
                           name="password" 
                           required 
                           placeholder="Enter your password" 
                           aria-label="Password">
                   </div>

                   <button type="submit" id="loginBtn" class="submit-btn">Sign In</button>
               </form>

               <div id="message" style="display:none;"></div>
               
               <!-- Demo accounts for testing -->
               <div class="demo-accounts">
                   <h3>🎯 Try Demo Accounts</h3>
                   
                   <!-- Student Demo Accounts -->
                   <div class="demo-account" onclick="fillDemoAccount('sarah.wilson@knox.nsw.edu.au', 'Sarah Wilson', 'student', { school: 'Knox Grammar School', yearLevel: 11 })">
                       <span>Sarah Wilson - Knox Grammar (Year 11) <span class="role-badge role-student">STUDENT</span></span>
                       <button>Login</button>
                   </div>
                   <div class="demo-account" onclick="fillDemoAccount('alex.chen@pymble.nsw.edu.au', 'Alex Chen', 'student', { school: 'Pymble Ladies College', yearLevel: 10 })">
                       <span>Alex Chen - Pymble Ladies' College (Year 10) <span class="role-badge role-student">STUDENT</span></span>
                       <button>Login</button>
                   </div>
                   
                   <!-- Teacher Demo Account -->
                   <div class="demo-account" onclick="fillDemoAccount('mr.smith@knox.nsw.edu.au', 'Mr. David Smith', 'teacher', { department: 'Mathematics', schoolCode: 'KGS001' })">
                       <span>Mr. Smith - Mathematics Teacher <span class="role-badge role-teacher">TEACHER</span></span>
                       <button>Login</button>
                   </div>
                   
                   <!-- Admin Demo Account -->
                   <div class="demo-account" onclick="fillDemoAccount('admin@knox.nsw.edu.au', 'Dr. Sarah Johnson', 'admin', { department: 'Wellness Coordinator', schoolCode: 'KGS001' })">
                       <span>Dr. Johnson - School Administrator <span class="role-badge role-admin">ADMIN</span></span>
                       <button>Login</button>
                   </div>
               </div>
               
               <div class="form-footer">
                   <p>Don't have an account? <a href="signup.html">Sign up here</a></p>
                   <p><a href="#" id="forgotPassword">Forgot your password?</a></p>
               </div>
           </div>
       </main>

       <footer>
           <p>&copy; 2025 Vivify. All rights reserved.</p>
       </footer>
   </div>

   <script>
       // Demo accounts for testing - Updated with roles
       const demoAccounts = [
           // Students
           {
               email: 'sarah.wilson@knox.nsw.edu.au',
               name: 'Sarah Wilson',
               role: 'student',
               school: 'Knox Grammar School',
               yearLevel: 11,
               classes: []
           },
           {
               email: 'alex.chen@pymble.nsw.edu.au',
               name: 'Alex Chen',
               role: 'student',
               school: 'Pymble Ladies\' College',
               yearLevel: 10,
               classes: []
           },
           // Teacher
           {
               email: 'mr.smith@knox.nsw.edu.au',
               name: 'Mr. David Smith',
               role: 'teacher',
               department: 'Mathematics',
               schoolCode: 'KGS001',
               classPermissions: []
           },
           // Admin
           {
               email: 'admin@knox.nsw.edu.au',
               name: 'Dr. Sarah Johnson',
               role: 'admin',
               department: 'Wellness Coordinator',
               schoolCode: 'KGS001',
               classPermissions: []
           }
       ];

       function fillDemoAccount(email, name, role, roleData) {
           document.getElementById('email').value = email;
           document.getElementById('password').value = 'Demo123';
           
           // Create complete demo profile
           const demoProfile = {
               id: Date.now() + Math.random(),
               name: name,
               email: email,
               role: role,
               joinDate: new Date().toISOString(),
               verified: true,
               ...roleData
           };
           
           // Store temporarily for login
           sessionStorage.setItem('pendingDemoProfile', JSON.stringify(demoProfile));
       }

       function showMessage(message, type = 'error') {
           const messageElement = document.getElementById('message');
           messageElement.textContent = message;
           messageElement.className = type === 'error' ? 'error-message' : 'success-message';
           messageElement.style.display = 'block';
           
           setTimeout(() => {
               messageElement.style.display = 'none';
           }, 5000);
       }

       document.addEventListener('DOMContentLoaded', function() {
           const loginForm = document.getElementById('loginForm');
           const loginBtn = document.getElementById('loginBtn');
           const forgotPasswordLink = document.getElementById('forgotPassword');
           
           // Check for URL parameters
           const urlParams = new URLSearchParams(window.location.search);
           if (urlParams.has('message')) {
               const message = urlParams.get('message');
               
               if (message === 'signup-success') {
                   showMessage('Account created successfully! You can now log in.', 'success');
               } else if (message === 'verified') {
                   showMessage('Email verified successfully! You can now log in.', 'success');
               } else if (message === 'password-reset') {
                   showMessage('Password reset successfully! You can now log in with your new password.', 'success');
               } else if (message === 'logout') {
                   showMessage('You have been logged out successfully.', 'success');
               }
           }

           loginForm.addEventListener('submit', async function(event) {
               event.preventDefault();

               const email = document.getElementById('email').value.trim();
               const password = document.getElementById('password').value.trim();

               if (!email || !password) {
                   showMessage('Please enter both email and password.');
                   return;
               }

               loginBtn.textContent = 'Signing In...';
               loginBtn.disabled = true;
               loginForm.classList.add('loading');

               try {
                   await new Promise(resolve => setTimeout(resolve, 1000));
                   
                   let userProfile = null;
                   
                   // Check for demo account login
                   const pendingDemo = sessionStorage.getItem('pendingDemoProfile');
                   if (pendingDemo && password === 'Demo123') {
                       userProfile = JSON.parse(pendingDemo);
                       sessionStorage.removeItem('pendingDemoProfile');
                   } else {
                       // Check registered users
                       const existingUsers = JSON.parse(localStorage.getItem('vivifyUsers') || '[]');
                       userProfile = existingUsers.find(user => user.email === email);
                       
                       if (!userProfile) {
                           throw new Error('Invalid email or password. Try a demo account or sign up for a new account.');
                       }
                   }
                   
                   if (userProfile) {
                       // Save user session
                       localStorage.setItem('userProfile', JSON.stringify(userProfile));
                       localStorage.setItem('userLoggedIn', 'true');
                       localStorage.setItem('userRole', userProfile.role);
                       localStorage.setItem('authToken', 'demo_token_' + Date.now());
                       
                       showMessage('Login successful! Redirecting...', 'success');
                       
                       // Role-based redirect
                       setTimeout(() => {
                           const redirectParam = urlParams.get('redirect');
                           let redirectTo;
                           
                           if (redirectParam) {
                               redirectTo = `${redirectParam}.html`;
                           } else {
                               // Default redirects based on role
                               switch (userProfile.role) {
                                   case 'teacher':
                                       redirectTo = 'teacher-dashboard.html';
                                       break;
                                   case 'admin':
                                       redirectTo = 'admin-dashboard.html';
                                       break;
                                   case 'student':
                                   default:
                                       redirectTo = 'dashboard.html';
                                       break;
                               }
                           }
                           
                           window.location.href = redirectTo;
                       }, 1500);
                   } else {
                       throw new Error('Invalid email or password.');
                   }
                   
               } catch (error) {
                   console.error('Login error:', error);
                   showMessage(error.message || 'Login failed. Please check your credentials.');
               } finally {
                   loginBtn.textContent = 'Sign In';
                   loginBtn.disabled = false;
                   loginForm.classList.remove('loading');
               }
           });
           
           forgotPasswordLink.addEventListener('click', function(e) {
               e.preventDefault();
               const email = prompt('Please enter your email address:');
               
               if (email && email.trim()) {
                   showMessage('Password reset instructions would be sent to ' + email.trim() + ' (demo mode)', 'success');
               }
           });
       });
   </script>

<!-- PWA Scripts -->
<script src="/pwa-install.js"></script>

<script>
// Additional PWA features for each page
document.addEventListener('DOMContentLoaded', function() {
    // Add PWA-specific styles
    if (window.matchMedia('(display-mode: standalone)').matches) {
        document.body.classList.add('pwa-mode');
        
        // Hide address bar on mobile when in PWA mode
        window.scrollTo(0, 1);
    }
    
    // Handle network status
    function updateOnlineStatus() {
        const statusElement = document.getElementById('network-status');
        if (statusElement) {
            if (navigator.onLine) {
                statusElement.textContent = 'Online';
                statusElement.className = 'online';
            } else {
                statusElement.textContent = 'Offline';
                statusElement.className = 'offline';
            }
        }
    }
    
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();
    
    // Add network status indicator if it doesn't exist
    if (!document.getElementById('network-status')) {
        const statusDiv = document.createElement('div');
        statusDiv.id = 'network-status';
        statusDiv.style.cssText = `
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            transition: all 0.3s ease;
        `;
        document.body.appendChild(statusDiv);
        updateOnlineStatus();
    }
});
</script>

<!-- Load class management for global functions -->
<script src="script.js"></script>
</body>
</html>